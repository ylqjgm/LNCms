# 核心模块功能概述

此文档为手动编写文档，用以提供 AI 对核心模块功能进行了解，文档将对核心模块功能进行详细说明。

## 模块概述

**Core** 为程序核心模块，负责提供整个项目业务逻辑处理、数据处理等核心功能。

## 开发技术

- **开发语言**: Golang 1.24+
- **开发框架**: Gin
- **数据库**: PostgreSQL
- **缓存**: Redis
- **API**: OpenAPI 3.1.1

## 模块通信

核心模块作为程序的基础模块，负责协调各模块之间的通信与交互。

### API 接口

- 对外提供 RESTful HTTP API 接口服务
- 所有 API 遵循 OpenAPI 3.1.1 规范
- 所有响应统一遵循 Envelope 响应格式
- 前端模块通过 RESTful HTTP API 接口与核心模块进行通信

### gRPC 通信

- 对外提供 gRPC 接口服务
- 存储模块、日志模块、采集模块通过 gRPC 接口与核心模块进行通信
- 模块间使用 gRPC 均支持双向通信

## 功能描述

### 1. 系统配置

#### 1.1 网站设置

对网站基础信息进行配置。

- 网站名称
- 网站地址
- 网站关键字
- 网站描述
- 版权申明
- 网站开关
- 关闭提示

#### 1.2 注册设置

对用户注册信息进行配置。

- 注册开关
- 验证码开关
- 用户密码要求
- 重复注册设置

#### 1.3 站群设置

对网站集群部署进行配置。

- 主站设置
- 集群管理

#### 1.4 积分设置

对网站通用积分进行配置。

- 积分名称
- 注册积分
- 登录积分
- 评论积分
- 充值积分
- 消费积分

#### 1.5 附件设置

对上传附件进行配置。

##### 1.5.1 存储渠道

对上传渠道进行配置。

- 渠道名称
- 存储类型（本地存储、存储模块存储、云存储服务器）
- 服务器配置（本地存储无效，存储模块存储则选择已注册的存储模块，云存储按照不同商家进行不同配置）

##### 1.5.2 图片附件

对图片附件进行设置。

- 附件开关
- 存储对象（选择存储渠道）
- 上传类型
- 上传大小
- 存储路径
- 转换格式
- 图片质量（转换后的图片质量）
- 水印开关
- 水印类型（文字、图片）
- 水印位置（左上、顶部、右上、右侧、右下、底部、左下、左侧、居中、平铺等）
- 水印透明度
- 图片略缩图

##### 1.5.3 音频附件

对音频附件进行设置。

- 附件开关
- 存储对象（选择存储渠道）
- 上传类型
- 上传大小
- 存储路径
- 转换格式
- 转码编码器
- 转码采样率
- 转码声道数
- 转码比特率
- 水印开关
- 水印音频（一段用作水印的音频文件）
- 水印位置（代表在上传的音频指定位置插入水印音频内容）

##### 1.5.4 视频附件

对视频附件进行设置。

- 附件开关
- 存储对象（选择存储渠道）
- 上传类型
- 上传大小
- 存储路径
- 转换类型
- 转码编码器
- 转码帧率
- 转码分辨率
- 转码比特率
- 水印开关
- 水印类型（文字、图片、视频）
- 水印位置（左上、顶部、右上、右侧、右下、底部、左下、左侧、居中、平铺等）
- 水印起始时间（在视频多长时间后添加水印）
- 水印显示时间（仅针对文字、图片，若为视频水印，则会完整插入视频片段）

#### 1.6 邮箱设置

对邮箱信息进行配置。

- SMTP服务器
- SMTP端口
- TLS开关
- 登录用户名
- 登录密码
- 发件人邮箱

#### 1.7 屏蔽设置

对网站进行信息屏蔽配置。

- 黑名单设置
- 禁用词汇列表

### 2. 模块管理

对模块进行管理。

- 模块注册
- 模块启用
- 模块禁用
- 模块检查

### 3. 上架设置

对网站内作品上架后的收费标准进行配置。

#### 3.1 付费设置

对读者阅读时的收费标准进行配置。
本部分内容为多设定模式，即可以进行添加、修改、删除。

- 内容类型（小说、漫画、音频、视频）
- 收费类型（按字数、按章节、按图片、按时长等计算）
- 收费标准（依据类型而决定，字数为每千字收费标准，章节为每章节收费标准，图片为每张图片收费标准，时长为每分钟收费标准，所有费用单位均为网站中的一个消费货币，可为小数点）

#### 3.2 收益设置

对作者收益进行配置。
此部分未包含的收益，可在作者奖励部分进行直接奖励。
本部分内容均为多设定模式，即每一种设定都是可以进行添加、修改、删除；意味着每一种收益设定均支持多条规则，可针对不同内容类型。

##### 3.2.1 全勤收益

针对作者全勤计算获取收益设定。

- 内容类型（小说、漫画、音频、视频）
- 全勤类型（连续计算、范围计算等）
- 全勤天数（若为连续计算，则表明必须在期限内必须每天更新，若为范围计算，则是在期限内进行更新数据计算）
- 更新数量（小说按字数，漫画按图片数，音频、视频按时长）
- 收益金额（达到全勤要求奖励多少消费货币）

##### 3.2.2 订阅收益

针对读者进行作品订阅获取收益设定。

- 内容类型（小说、漫画、音频、视频）
- 订阅起点（达到多少订阅后才开始进行收益计算）
- 收益金额（每一个订阅转换为多少网站消费货币）

##### 3.2.3 阅读收益

针对读者支付作品章节获取收益设定。

- 内容类型（小说、漫画、音频、视频）
- 收益比例（即用户付费金额与消费货币转换比例）

##### 3.2.4 收藏收益

针对用户收藏作品获取收益设定。

- 内容类型（小说、漫画、音频、视频）
- 收藏起点（达到多少收藏后才开始进行收益计算）
- 收益金额（每一个收藏转换为多少网站消费货币）

##### 3.2.5 票务收益

针对用户对作品投票获取收益设定。

- 内容类型（小说、漫画、音频、视频）
- 投票起点（达到多少投票后才开始进行收益计算）
- 收益比例（每张票据应对价格与消费货币转换比例）

##### 3.2.6 打赏收益

针对用户使用虚拟物品对作品打赏获取收益设定。

- 内容类型（小说、漫画、音频、视频）
- 收益比例（即虚拟物品对应价格与消费货币转换比例）

##### 3.2.7 新手鼓励

针对新作者进行的新手期收益设定。

- 内容类型（小说、漫画、音频、视频）
- 期限类型（按时间、按作品数量、按章节数量等）
- 期限数值（按时间则是天数）
- 收益类型（3.2.1至3.2.6所有类型）
- 收益激励（在原有数值上提升多少百分比）

**例子**:

> *收藏打赏*
> - 内容类型: 小说
> - 收藏起点: 1
> - 收益金额: 1
>
> *新手奖励*
> - 内容类型: 小说
> - 期限类型: 时间
> - 期限数值: 30
> - 收益类型: 收藏收益
> - 收益激励：10
>
> 作者每增加一个收藏，按照原来设定，可获得1消费货币。
> 同时，由于作者属于新手期，则在新手期的30天内，每获取1个收藏，除了获得原有的1消费货币外，还可额外获得10%的消费货币奖励，即0.1消费货币；
> 最终结果为，作者在新手激励期间，每获得一个收藏，最终可获得1.1个消费货币。

#### 3.3 结算设置

针对作者结算周期进行设置。

- 内容类型（小说、漫画、音频、视频）
- 结算类型（按周期结算、按最低支付金额结算）
- 结算时间（按周期结算时有效）
- 最低支付金额（按最低支付金额结算时有效，此处金额为消费货币）
- 结算比例（即每一元现实金额对应多少消费货币）

### 4. 权限管理

#### 4.1 角色管理

对网站管理角色进行管理，此角色均为管理角色。

- 角色名称
- 角色描述

#### 4.2 用户组管理

对网站用户组进行管理，此用户组均为前台角色。

- 用户组名称
- 用户组描述

#### 4.3 等级管理

对网站前台用户等级管理。

- 等级名称
- 等级描述
- 等级达成条件: 可选参数（积分、货币、充值数、消费数、评论数、阅读数）

#### 4.4 作者组管理

对网站作者组进行管理。

- 作者组名称
- 作者组描述
- 作者组所属类型

#### 4.5 作者等级管理

对网站作者等级管理。

- 作者等级名称
- 作者等级描述
- 作者等级达成条件: 可选参数（作品数、平均评分、推荐数、投票数、评论数、打赏数）

#### 4.6 权限管理

对各分组、等级进行权限管理，针对每一个组、等级，进行不同的权限选择，勾选权限则代表拥有此项权限，否则没有此权限。

- 权限名称
- 权限目标

### 5. 用户管理

可对网站用户进行管理。

- 用户添加
- 用户信息修改
- 用户状态管理
- 用户封禁管理
- 用户权限管理
- 用户审核
- 用户密码修改
- 用户删除

### 6. 作者管理

可对网站作者进行管理。

- 作者添加
- 作者信息修改
- 作者状态管理
- 作者封禁管理
- 作者审核
- 作者奖励
- 作者惩罚
- 作者删除

### 7. 内容管理

#### 7.1 分类管理

对分类进行管理。

- 分类添加（分类名称、分类描述、上级分类、分类类型、分类排序）
- 分类修改
- 分类删除

#### 7.2 地区管理

对地区进行管理。

- 地区添加（地区名称、上级地区、地区描述、地区排序）
- 地区修改
- 地区删除

#### 7.3 标签管理

对标签进行管理。

- 标签添加（标签名称、标签描述）
- 标签修改
- 标签删除

#### 7.4 小说管理

##### 7.4.1 小说信息管理

对小说基本信息管理。

- 小说名称
- 小说分类
- 小说标签
- 小说作者
- 小说评分
- 小说连载状态
- 小说作品状态
- 小说封面
- 小说简介

##### 7.4.2 小说分卷管理

对小说分卷信息管理。

- 分卷名称
- 分卷描述
- 分卷排序
- 分卷状态

##### 7.4.3 小说章节管理

对小说章节信息管理。

- 章节名称
- 所属分卷
- 章节内容
- 章节排序
- 章节状态

##### 7.4.4 小说章节附件管理

对小说章节附件进行管理。

- 附件上传
- 附件排序

#### 7.5 漫画管理

##### 7.5.1 漫画信息管理

对漫画基本信息管理。

- 漫画名称
- 漫画地区
- 漫画标签
- 漫画作者
- 漫画评分
- 漫画连载状态
- 漫画作品状态
- 漫画封面
- 漫画简介

##### 7.5.2 漫画章节管理

对漫画章节进行管理。

- 章节名称
- 章节描述
- 章节排序
- 章节状态

##### 7.5.3 漫画章节图片管理

对漫画章节图片进行管理。

- 图片上传
- 图片排序

#### 7.6 音频管理

##### 7.6.1 音频信息管理

对音频基本信息进行管理。

- 音频名称
- 音频分类
- 音频标签
- 音频主播
- 音频评分
- 音频连载状态
- 音频作品状态
- 音频封面
- 音频简介
- 音频时长

##### 7.6.2 音频分季管理

对音频分季进行管理。

- 分季名称
- 分季描述
- 分季状态
- 分季排序

##### 7.6.3 音频分集管理

对音频分集进行管理。

- 分集名称
- 分集描述
- 分集状态
- 分集排序

##### 7.6.4 音频文件管理

对音频文件进行管理。

- 文件上传
- 文件大小
- 文件时长
- 文件编码信息

#### 7.7 视频管理

##### 7.7.1 视频信息管理

对视频基本信息进行管理。

- 视频名称
- 视频分类
- 视频地区
- 视频标签
- 视频作者
- 视频演职员
- 视频评分
- 视频连载状态
- 视频作品状态
- 视频封面
- 视频简介
- 视频时长

##### 7.7.2 视频分季管理

对视频分季进行管理。

- 分季名称
- 分季描述
- 分季状态
- 分季排序

##### 7.7.3 视频分集管理

对视频分集进行管理。

- 分集名称
- 分集描述
- 分集状态
- 分集时长
- 分集排序

##### 7.7.4 视频文件管理

对视频文件进行管理。

- 视频上传
- 视频大小
- 视频时长
- 视频编码信息

### 8. 消费管理

#### 8.1 渠道管理

对充值渠道、提现渠道进行管理。

- 渠道添加
- 渠道配置
- 渠道删除

#### 8.2 虚拟物品管理

对网站内虚拟物品进行管理。

- 物品名称
- 物品描述
- 物品图片
- 物品价格
- 物品类型（勋章、头衔、打赏、特效等）
- 内容类型（小说、漫画、音频、视频，或通用）
- 过期时间

#### 8.3 票务管理

对网站内票据物品进行管理。

- 票务名称
- 票务描述
- 获取渠道（购买、自动获取等）
- 票务用途（打赏、投票等）
- 票务价格（代表票据在作者方所能替代的收益价格，若渠道为购买，同时也是购买的价格）
- 获取权限（针对哪些用户组可以获取）
- 获取时间（可为循环时间、间隔时间等）
- 过期时间

#### 8.4 退费管理

对用户提出的退费申请进行管理。

- 退费配置
- 退费查询
- 退费审核

#### 8.5 流水管理

对网站消费流水进行管理。

- 流水查询
- 流水统计

#### 8.6 作者收益管理

对网站内作者收益进行管理。

- 收益查询
- 收益统计
- 收益审核
- 收益支付

### 9. 互动管理

#### 9.1 评论管理

对网站内评论数据进行管理。

##### 9.1.1 小说评论

对小说类型评论数据进行管理。

- 小说评论
- 小说章节评论
- 小说章节段评

##### 9.1.2 漫画评论

对漫画类型评论数据进行管理。

- 漫画评论
- 漫画章节评论

##### 9.1.3 音频评论

对音频类型评论数据进行管理。

- 音频评论
- 音频分集评论

##### 9.1.4 视频评论

对视频类型评论数据进行管理。

- 视频评论
- 视频分集评论

#### 9.2 弹幕管理

对弹幕类评论进行管理。

- 漫画章节弹幕
- 视频弹幕

### 10. 管理中心

针对拥有管理权限的角色用户操作中心。

#### 10.1 组织架构

对网站管理进行组织架构管理，可按照内容类型进行划分，例如：小说部、漫画部、音频部等。
每一个部门根据角色权限定义，拥有一位部长类型角色，可进行组织架构管理。
例如：小说部部长，可以设定小说编辑一组、小说编辑二组等，并设定组长，组长等角色权限，均由管理员在权限管理处事先进行权限划分。

- 架构名称
- 所属上级
- 架构描述
- 架构负责人

#### 10.2 作者管理

针对该架构下所属作者进行管理。

- 作者审核（架构所属类型下所有作者申请均在此进行审核，如小说只出现在小说类型架构下）
- 作者划分（审核通过后，可将作者划归于下级架构中，如：小说编辑一组；编辑一组组长可将作者划归于小组中编辑名下）
- 作者奖励
- 作者惩罚

#### 10.3 作品管理

针对编辑名下作者提交的作品进行管理。

- 作品审核（依据作者等级，会出现基本信息审核、分卷/分季、章节/分集、附件等审核，所需审核内容，由作者等级进行确定）
- 作品隐藏（可针对作品基本信息、分卷/分季、章节/分集、附件等进行信息隐藏，隐藏后前台不会展示，作者根据隐藏说明进行修改后可由编辑重新显示）
- 作品封禁
- 作品上架（编辑可设定某作品进行上架，上架后发布的内容即为收费内容）
- 作品下架
- 作品推荐（编辑可将作品推荐至指定的推荐位）

#### 10.4 结算管理

针对编辑名下作者结算进行管理。

- 结算审核（根据系统设置的结算模式进行审核，若为周期结算，则自动生成收益结果提交审核，若为最低支付结算，则由作者提交结算审核，编辑审核完成后，组长层级会进行编辑汇总审核，部长进行小组汇总审核）
- 结算变更（编辑对作者结算进行变更，变更后由作者进行确认，确认后进入组长进行审核）
- 结算统计
- 结算查询

### 11. 备份恢复

#### 11.1 备份管理

可对网站数据进行备份管理。

##### 11.1.1 备份渠道

对备份的存储目标渠道进行设定。

- 渠道名称
- 渠道类型（本地存储、存储模块、云存储、FTP服务器、SMB共享服务器、Rsync同步服务器）
- 渠道配置（针对不同渠道进行配置，本地存储无效）

##### 11.1.2 自动备份

对网站数据进行自动备份，备份目标采用备份设定中的设定。

- 数据类型（数据备份、文件备份、选择备份、全量备份）
- 备份类型（一次性备份、定时备份）
- 定时设定（仅定时备份有效，以 Cron 格式设定）
- 备份渠道
- 存储路径
- 备份保留（可设定保留多少次备份数据）

#### 11.2 恢复管理

对网站进行数据恢复。

- 恢复类型（数据恢复、文件恢复、选择恢复、全量恢复）
- 来源渠道（选择备份渠道）
- 恢复目标（进行恢复目标设定，可依据恢复类型不同进行设定，如选择数据恢复，则可直接指定恢复的数据库目标或当前数据库；如文件类恢复，则可直接设定要恢复的数据库、存储目标等）