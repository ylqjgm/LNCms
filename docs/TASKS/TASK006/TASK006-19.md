# TASK006-19: 创建AuthorHandler接口和实现 - 作者登出API

## 任务信息

**任务编号**: TASK006-19  
**父任务**: TASK006  
**任务名称**: 创建AuthorHandler接口和实现 - 作者登出API  
**版本信息**: v1.2.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 20:48:19 CST

## 任务描述

扩展作者控制器，提供作者登出的HTTP API处理。包括：1) 扩展AuthorHandler接口（Logout方法）；2) 实现Logout方法（处理POST /api/v1/authors/logout请求）；3) 从请求头获取JWT token；4) 调用AuthService.AuthorLogout；5) 格式化响应（Envelope格式）。所有代码必须遵循API设计规范。参考TASK005-20用户登出API实现。

## 依赖任务

TASK006-18（创建AuthorHandler接口和实现 - 作者登录API）、TASK006-10（创建AuthService扩展 - 作者登录和登出）

## 实现指南

### 1. 扩展AuthorHandler接口

在 `internal/handler/author_handler.go` 文件中，扩展AuthorHandler接口：

```go
// AuthorHandler 作者控制器接口（扩展）
type AuthorHandler interface {
    Register(c *gin.Context)
    Login(c *gin.Context)
    
    // Logout 作者登出
    // POST /api/v1/authors/logout
    Logout(c *gin.Context)
}
```

### 2. 实现Logout方法

在authorHandler实现中添加Logout方法：

```go
// Logout 作者登出
// @Summary 作者登出
// @Description 作者登出接口，将token加入黑名单
// @Tags 作者管理
// @Accept json
// @Produce json
// @Security BearerAuth
// @Success 200 {object} response.Envelope
// @Failure 400 {object} response.Envelope
// @Failure 401 {object} response.Envelope
// @Failure 500 {object} response.Envelope
// @Router /api/v1/authors/logout [post]
func (h *authorHandler) Logout(c *gin.Context) {
    // 1. 从请求头获取JWT token
    authHeader := c.GetHeader("Authorization")
    if authHeader == "" {
        response.Unauthorized(c, "缺少认证信息", nil)
        return
    }
    
    // 提取token（格式：Bearer <token>）
    tokenParts := strings.Split(authHeader, " ")
    if len(tokenParts) != 2 || tokenParts[0] != "Bearer" {
        response.Unauthorized(c, "认证信息格式错误", nil)
        return
    }
    
    token := tokenParts[1]
    
    // 2. 调用AuthService.AuthorLogout
    if err := h.authService.AuthorLogout(c.Request.Context(), token); err != nil {
        response.InternalServerError(c, "登出失败", err)
        return
    }
    
    // 3. 格式化响应（Envelope格式）
    response.Success(c, http.StatusOK, map[string]string{
        "message": "登出成功",
    })
}
```

### 3. 注意事项

- **Token提取**：从Authorization请求头提取Bearer token
- **错误处理**：处理缺少token、格式错误等情况
- **响应格式**：使用Envelope格式返回响应
- **API文档**：添加Swagger注释，标记需要认证

## 验收标准

1. **接口扩展完整**
   - AuthorHandler接口包含Logout方法
   - 方法签名正确

2. **实现完整**
   - Logout方法正确实现
   - Token提取逻辑正确
   - 错误处理完善
   - 响应格式正确

3. **API规范**
   - 遵循OpenAPI 3.1.1规范
   - 使用Envelope响应格式
   - HTTP状态码使用正确

4. **代码规范**
   - 遵循Golang编码规范
   - 遵循API设计规范

## 相关文件

- `internal/handler/author_handler.go` - AuthorHandler接口和实现文件（需要扩展）
- `docs/TASKS/TASK005/TASK005-20.md` - 用户登出API实现参考
- `.cursor/rules/api-design.mdc` - API设计规范

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-03 20:48:19 CST

