# TASK006-17: 创建AuthorHandler接口和实现 - 作者注册API

## 任务信息

**任务编号**: TASK006-17  
**父任务**: TASK006  
**任务名称**: 创建AuthorHandler接口和实现 - 作者注册API  
**版本信息**: v1.2.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 20:48:19 CST

## 任务描述

创建作者控制器，提供作者注册的HTTP API处理。包括：1) 定义AuthorHandler接口；2) 实现Register方法（处理POST /api/v1/authors/register请求）；3) 实现请求参数绑定和验证；4) 调用AuthService.AuthorRegister；5) 格式化响应（Envelope格式）。所有代码必须遵循Golang编码规范和API设计规范，错误消息使用中文。参考TASK005-18用户注册API实现。

## 依赖任务

TASK006-11（创建AuthService扩展 - 作者注册）

## 实现指南

### 1. 定义AuthorHandler接口

在 `internal/handler/` 目录下创建 `author_handler.go` 文件，定义AuthorHandler接口：

```go
package handler

import (
    "github.com/gin-gonic/gin"
)

// AuthorHandler 作者控制器接口
// 提供作者管理的HTTP API处理
type AuthorHandler interface {
    // Register 作者注册
    // POST /api/v1/authors/register
    Register(c *gin.Context)
}
```

### 2. 实现AuthorHandler接口

在同一个文件中实现AuthorHandler接口：

```go
package handler

import (
    "net/http"
    
    "github.com/gin-gonic/gin"
    
    "yourproject/internal/dto"
    "yourproject/internal/service"
    "yourproject/pkg/response"
)

// authorHandler AuthorHandler的实现
type authorHandler struct {
    authService service.AuthService
}

// NewAuthorHandler 创建AuthorHandler实例
func NewAuthorHandler(authService service.AuthService) AuthorHandler {
    return &authorHandler{
        authService: authService,
    }
}

// Register 作者注册
// @Summary 作者注册
// @Description 作者注册接口，支持作者名、邮箱、密码、作者类型注册
// @Tags 作者管理
// @Accept json
// @Produce json
// @Param request body dto.AuthorRegisterRequest true "注册请求"
// @Success 201 {object} response.Envelope{data=dto.AuthorRegisterResponse}
// @Failure 400 {object} response.Envelope
// @Failure 422 {object} response.Envelope
// @Failure 500 {object} response.Envelope
// @Router /api/v1/authors/register [post]
func (h *authorHandler) Register(c *gin.Context) {
    // 1. 绑定请求参数
    var req dto.AuthorRegisterRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        response.BadRequest(c, "请求参数错误", err)
        return
    }
    
    // 2. 获取客户端IP和User-Agent
    req.IPAddress = c.ClientIP()
    req.UserAgent = c.GetHeader("User-Agent")
    
    // 3. 调用AuthService.AuthorRegister
    resp, err := h.authService.AuthorRegister(c.Request.Context(), &req)
    if err != nil {
        // 根据错误类型返回不同的HTTP状态码
        if strings.Contains(err.Error(), "已被使用") || strings.Contains(err.Error(), "已存在") {
            response.Conflict(c, err.Error(), nil)
            return
        }
        if strings.Contains(err.Error(), "密码强度") || strings.Contains(err.Error(), "验证失败") {
            response.UnprocessableEntity(c, err.Error(), nil)
            return
        }
        response.InternalServerError(c, "注册失败", err)
        return
    }
    
    // 4. 格式化响应（Envelope格式）
    response.Success(c, http.StatusCreated, resp)
}
```

### 3. 添加必要的导入

```go
package handler

import (
    "net/http"
    "strings"
    
    "github.com/gin-gonic/gin"
    
    "yourproject/internal/dto"
    "yourproject/internal/service"
    "yourproject/pkg/response"
)
```

### 4. 注意事项

- **请求验证**：使用Gin的binding标签进行参数验证
- **错误处理**：根据错误类型返回合适的HTTP状态码
- **响应格式**：使用Envelope格式返回响应
- **错误消息**：所有错误消息必须使用中文
- **API文档**：添加Swagger注释，支持API文档生成

## 验收标准

1. **接口定义完整**
   - AuthorHandler接口包含Register方法
   - 方法签名正确

2. **实现完整**
   - Register方法正确实现
   - 请求参数绑定和验证正确
   - 错误处理完善
   - 响应格式正确（Envelope格式）

3. **API规范**
   - 遵循OpenAPI 3.1.1规范
   - 使用Envelope响应格式
   - HTTP状态码使用正确

4. **错误处理**
   - 所有错误都被正确处理
   - 错误消息清晰、具体，使用中文

5. **代码规范**
   - 遵循Golang编码规范
   - 遵循API设计规范
   - 注释完整，使用中文

## 相关文件

- `internal/handler/author_handler.go` - AuthorHandler接口和实现文件（待创建）
- `internal/dto/auth_dto.go` - 认证DTO文件
- `docs/TASKS/TASK005/TASK005-18.md` - 用户注册API实现参考
- `.cursor/rules/coding-standards.mdc` - Golang编码规范
- `.cursor/rules/api-design.mdc` - API设计规范

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-03 20:48:19 CST

