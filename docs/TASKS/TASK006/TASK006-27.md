# TASK006-27: 配置作者管理API路由

## 任务信息

**任务编号**: TASK006-27  
**父任务**: TASK006  
**任务名称**: 配置作者管理API路由  
**版本信息**: v1.2.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 20:48:19 CST

## 任务描述

配置作者管理的API路由。包括：1) 在路由配置文件中定义作者管理路由；2) 配置公开路由（注册、登录）；3) 配置需要认证的路由（登出、作者信息查询等）；4) 配置需要管理员权限的路由（作者管理操作）；5) 配置JWT认证中间件和权限中间件（如果TASK004完成）。所有路由必须遵循OpenAPI 3.1.1规范，路径使用/api/v1/authors前缀。参考TASK005-28用户管理API路由配置。

## 依赖任务

TASK006-25（创建AuthorHandler接口和实现 - 作者删除API）、TASK006-26（扩展JWT认证中间件支持作者token）

## 实现指南

### 1. 创建或扩展路由配置文件

在 `internal/router/` 或 `internal/http/` 目录下创建或扩展路由配置文件，例如 `author_routes.go`：

```go
package router

import (
    "github.com/gin-gonic/gin"
    
    "yourproject/internal/handler"
    "yourproject/internal/middleware"
    "yourproject/internal/service"
)

// SetupAuthorRoutes 配置作者管理路由
func SetupAuthorRoutes(
    router *gin.RouterGroup,
    authorHandler handler.AuthorHandler,
    jwtService service.JWTService,
) {
    // 作者管理路由组
    authors := router.Group("/authors")
    {
        // 公开路由（无需认证）
        authors.POST("/register", authorHandler.Register)  // 作者注册
        authors.POST("/login", authorHandler.Login)         // 作者登录
        
        // 需要认证的路由（使用JWT认证中间件）
        authorsAuth := authors.Group("", middleware.JWTAuthMiddleware(jwtService))
        {
            authorsAuth.POST("/logout", authorHandler.Logout)           // 作者登出
            authorsAuth.GET("", authorHandler.GetAuthors)                // 获取作者列表
            authorsAuth.GET("/:id", authorHandler.GetAuthor)            // 获取作者详情
            
            // 需要管理员权限的路由（如果TASK004完成，添加权限中间件）
            authorsAdmin := authorsAuth.Group("")
            // 如果权限中间件已实现，添加：
            // authorsAdmin.Use(middleware.RequireAdmin())
            {
                authorsAdmin.POST("", authorHandler.CreateAuthor)                    // 创建作者
                authorsAdmin.PUT("/:id", authorHandler.UpdateAuthor)                // 更新作者
                authorsAdmin.DELETE("/:id", authorHandler.DeleteAuthor)             // 删除作者
                authorsAdmin.PUT("/:id/status", authorHandler.UpdateAuthorStatus)   // 更新作者状态
                authorsAdmin.PUT("/:id/ban", authorHandler.BanAuthor)              // 封禁作者
                authorsAdmin.PUT("/:id/unban", authorHandler.UnbanAuthor)           // 解封作者
                authorsAdmin.PUT("/:id/approve", authorHandler.ApproveAuthor)       // 审核通过作者
                authorsAdmin.PUT("/:id/reject", authorHandler.RejectAuthor)          // 审核拒绝作者
                authorsAdmin.PUT("/:id/reward", authorHandler.RewardAuthor)         // 奖励作者
                authorsAdmin.PUT("/:id/punish", authorHandler.PunishAuthor)         // 惩罚作者
            }
        }
    }
}
```

### 2. 在主路由文件中注册作者路由

在主路由文件（如 `router.go` 或 `routes.go`）中注册作者路由：

```go
package router

import (
    "github.com/gin-gonic/gin"
    
    "yourproject/internal/handler"
    "yourproject/internal/service"
)

// SetupRoutes 配置所有路由
func SetupRoutes(
    router *gin.Engine,
    userHandler handler.UserHandler,
    authorHandler handler.AuthorHandler,
    jwtService service.JWTService,
) {
    // API版本路由组
    v1 := router.Group("/api/v1")
    {
        // 用户管理路由
        SetupUserRoutes(v1, userHandler, jwtService)
        
        // 作者管理路由
        SetupAuthorRoutes(v1, authorHandler, jwtService)
    }
}
```

### 3. 路由路径规范

所有作者管理路由使用 `/api/v1/authors` 前缀：

- **公开路由**：
  - `POST /api/v1/authors/register` - 作者注册
  - `POST /api/v1/authors/login` - 作者登录

- **需要认证的路由**：
  - `POST /api/v1/authors/logout` - 作者登出
  - `GET /api/v1/authors` - 获取作者列表
  - `GET /api/v1/authors/{id}` - 获取作者详情

- **需要管理员权限的路由**：
  - `POST /api/v1/authors` - 创建作者
  - `PUT /api/v1/authors/{id}` - 更新作者
  - `DELETE /api/v1/authors/{id}` - 删除作者
  - `PUT /api/v1/authors/{id}/status` - 更新作者状态
  - `PUT /api/v1/authors/{id}/ban` - 封禁作者
  - `PUT /api/v1/authors/{id}/unban` - 解封作者
  - `PUT /api/v1/authors/{id}/approve` - 审核通过作者
  - `PUT /api/v1/authors/{id}/reject` - 审核拒绝作者
  - `PUT /api/v1/authors/{id}/reward` - 奖励作者
  - `PUT /api/v1/authors/{id}/punish` - 惩罚作者

### 4. 中间件配置

- **JWT认证中间件**：所有需要认证的路由使用JWTAuthMiddleware
- **权限中间件**：管理员操作路由使用权限中间件（如果TASK004完成）
- **CORS中间件**：如果需要跨域支持，添加CORS中间件
- **日志中间件**：添加请求日志中间件
- **限流中间件**：添加API限流中间件（可选）

### 5. 路由分组示例

```go
// SetupAuthorRoutes 配置作者管理路由（完整示例）
func SetupAuthorRoutes(
    router *gin.RouterGroup,
    authorHandler handler.AuthorHandler,
    jwtService service.JWTService,
) {
    authors := router.Group("/authors")
    {
        // 公开路由组
        public := authors.Group("")
        {
            public.POST("/register", authorHandler.Register)
            public.POST("/login", authorHandler.Login)
        }
        
        // 需要认证的路由组
        auth := authors.Group("", middleware.JWTAuthMiddleware(jwtService))
        {
            auth.POST("/logout", authorHandler.Logout)
            auth.GET("", authorHandler.GetAuthors)
            auth.GET("/:id", authorHandler.GetAuthor)
        }
        
        // 需要管理员权限的路由组
        admin := auth.Group("")
        // 如果权限中间件已实现：
        // admin.Use(middleware.RequireAdmin())
        {
            admin.POST("", authorHandler.CreateAuthor)
            admin.PUT("/:id", authorHandler.UpdateAuthor)
            admin.DELETE("/:id", authorHandler.DeleteAuthor)
            admin.PUT("/:id/status", authorHandler.UpdateAuthorStatus)
            admin.PUT("/:id/ban", authorHandler.BanAuthor)
            admin.PUT("/:id/unban", authorHandler.UnbanAuthor)
            admin.PUT("/:id/approve", authorHandler.ApproveAuthor)
            admin.PUT("/:id/reject", authorHandler.RejectAuthor)
            admin.PUT("/:id/reward", authorHandler.RewardAuthor)
            admin.PUT("/:id/punish", authorHandler.PunishAuthor)
        }
    }
}
```

### 6. 注意事项

- **路由前缀**：所有路由使用 `/api/v1/authors` 前缀
- **HTTP方法**：遵循RESTful规范（GET查询、POST创建、PUT更新、DELETE删除）
- **路径参数**：使用 `:id` 格式定义路径参数
- **中间件顺序**：认证中间件在权限中间件之前
- **路由分组**：按权限要求分组路由，便于管理和维护

## 验收标准

1. **路由配置完整**
   - 所有作者管理路由都已配置
   - 路由路径符合规范

2. **中间件配置**
   - JWT认证中间件正确配置
   - 权限中间件正确配置（如果可用）

3. **路由分组**
   - 公开路由、认证路由、管理员路由正确分组
   - 路由层次清晰

4. **API规范**
   - 遵循OpenAPI 3.1.1规范
   - 路由路径符合RESTful规范

5. **代码规范**
   - 遵循Golang编码规范
   - 代码结构清晰

## 相关文件

- `internal/router/author_routes.go` - 作者管理路由配置文件（待创建）
- `internal/router/router.go` - 主路由配置文件（需要扩展）
- `docs/TASKS/TASK005/TASK005-28.md` - 用户管理API路由配置参考
- `.cursor/rules/api-design.mdc` - API设计规范

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-03 20:48:19 CST

