# TASK006-20: 创建AuthorHandler接口和实现 - 作者列表和详情API

## 任务信息

**任务编号**: TASK006-20  
**父任务**: TASK006  
**任务名称**: 创建AuthorHandler接口和实现 - 作者列表和详情API  
**版本信息**: v1.2.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 20:48:19 CST

## 任务描述

扩展作者控制器，提供作者列表查询和详情查询的HTTP API处理。包括：1) 扩展AuthorHandler接口（GetAuthors、GetAuthor方法）；2) 实现GetAuthors方法（处理GET /api/v1/authors请求，支持分页、筛选、排序）；3) 实现GetAuthor方法（处理GET /api/v1/authors/{id}请求）；4) 调用AuthorService；5) 格式化响应（Envelope格式）。所有代码必须遵循API设计规范。参考TASK005-21用户列表和详情API实现。

## 依赖任务

TASK006-19（创建AuthorHandler接口和实现 - 作者登出API）、TASK006-13（创建AuthorService接口和实现 - 基础CRUD）

## 实现指南

### 1. 扩展AuthorHandler接口

在 `internal/handler/author_handler.go` 文件中，扩展AuthorHandler接口：

```go
// AuthorHandler 作者控制器接口（扩展）
type AuthorHandler interface {
    Register(c *gin.Context)
    Login(c *gin.Context)
    Logout(c *gin.Context)
    
    // GetAuthors 获取作者列表
    // GET /api/v1/authors
    GetAuthors(c *gin.Context)
    
    // GetAuthor 获取作者详情
    // GET /api/v1/authors/{id}
    GetAuthor(c *gin.Context)
}
```

### 2. 扩展authorHandler结构体

在authorHandler结构体中添加authorService依赖：

```go
// authorHandler AuthorHandler的实现
type authorHandler struct {
    authService  service.AuthService
    authorService service.AuthorService // 新增
}

// NewAuthorHandler 创建AuthorHandler实例（扩展）
func NewAuthorHandler(
    authService service.AuthService,
    authorService service.AuthorService, // 新增参数
) AuthorHandler {
    return &authorHandler{
        authService:  authService,
        authorService: authorService,
    }
}
```

### 3. 实现GetAuthors方法

在authorHandler实现中添加GetAuthors方法：

```go
// GetAuthors 获取作者列表
// @Summary 获取作者列表
// @Description 获取作者列表，支持分页、筛选、排序
// @Tags 作者管理
// @Accept json
// @Produce json
// @Param page query int false "页码" default(1)
// @Param limit query int false "每页数量" default(20)
// @Param author_name query string false "作者名筛选"
// @Param email query string false "邮箱筛选"
// @Param is_active query bool false "激活状态筛选"
// @Param author_type_ids query []int32 false "作者类型ID数组筛选"
// @Param sort_by query string false "排序字段" default(created_at)
// @Param sort_order query string false "排序方向" default(desc)
// @Success 200 {object} response.Envelope{data=dto.AuthorListResponse}
// @Failure 400 {object} response.Envelope
// @Failure 500 {object} response.Envelope
// @Router /api/v1/authors [get]
func (h *authorHandler) GetAuthors(c *gin.Context) {
    // 1. 绑定查询参数
    var params dto.AuthorQueryParams
    if err := c.ShouldBindQuery(&params); err != nil {
        response.BadRequest(c, "请求参数错误", err)
        return
    }
    
    // 2. 设置默认值
    if params.Page < 1 {
        params.Page = 1
    }
    if params.Limit < 1 {
        params.Limit = 20
    }
    if params.Limit > 100 {
        params.Limit = 100
    }
    
    // 3. 处理author_type_ids数组参数（从查询字符串解析）
    if authorTypeIDsStr := c.Query("author_type_ids"); authorTypeIDsStr != "" {
        // 解析数组参数（格式：1,2,3 或 [1,2,3]）
        // 这里需要实现数组解析逻辑
        // 暂时省略，后续可以扩展
    }
    
    // 4. 调用AuthorService.GetAuthors
    resp, err := h.authorService.GetAuthors(c.Request.Context(), &params)
    if err != nil {
        response.InternalServerError(c, "查询作者列表失败", err)
        return
    }
    
    // 5. 格式化响应（Envelope格式，带分页信息）
    response.SuccessWithPagination(c, http.StatusOK, resp.Authors, resp.Total, resp.Page, resp.Limit, resp.TotalPages)
}
```

### 4. 实现GetAuthor方法

在authorHandler实现中添加GetAuthor方法：

```go
// GetAuthor 获取作者详情
// @Summary 获取作者详情
// @Description 根据ID获取作者详细信息
// @Tags 作者管理
// @Accept json
// @Produce json
// @Param id path int true "作者ID"
// @Success 200 {object} response.Envelope{data=dto.AuthorInfo}
// @Failure 400 {object} response.Envelope
// @Failure 404 {object} response.Envelope
// @Failure 500 {object} response.Envelope
// @Router /api/v1/authors/{id} [get]
func (h *authorHandler) GetAuthor(c *gin.Context) {
    // 1. 获取路径参数
    authorID, err := strconv.ParseInt(c.Param("id"), 10, 64)
    if err != nil {
        response.BadRequest(c, "无效的作者ID", err)
        return
    }
    
    // 2. 调用AuthorService.GetAuthor
    author, err := h.authorService.GetAuthor(c.Request.Context(), authorID)
    if err != nil {
        if strings.Contains(err.Error(), "不存在") {
            response.NotFound(c, err.Error(), nil)
            return
        }
        response.InternalServerError(c, "查询作者失败", err)
        return
    }
    
    // 3. 格式化响应（Envelope格式）
    response.Success(c, http.StatusOK, author)
}
```

### 5. 添加必要的导入

```go
package handler

import (
    "net/http"
    "strconv"
    "strings"
    
    "github.com/gin-gonic/gin"
    
    "yourproject/internal/dto"
    "yourproject/internal/service"
    "yourproject/pkg/response"
)
```

### 6. 注意事项

- **分页参数**：验证分页参数，设置默认值和最大值
- **数组参数**：处理author_type_ids数组查询参数
- **错误处理**：根据错误类型返回合适的HTTP状态码
- **响应格式**：列表接口使用带分页的Envelope格式
- **API文档**：添加Swagger注释

## 验收标准

1. **接口扩展完整**
   - AuthorHandler接口包含GetAuthors和GetAuthor方法
   - 方法签名正确

2. **实现完整**
   - GetAuthors方法正确实现
   - GetAuthor方法正确实现
   - 分页参数处理正确
   - 数组参数处理正确
   - 错误处理完善

3. **API规范**
   - 遵循OpenAPI 3.1.1规范
   - 使用Envelope响应格式
   - 分页信息正确返回

4. **代码规范**
   - 遵循Golang编码规范
   - 遵循API设计规范

## 相关文件

- `internal/handler/author_handler.go` - AuthorHandler接口和实现文件（需要扩展）
- `docs/TASKS/TASK005/TASK005-21.md` - 用户列表和详情API实现参考
- `.cursor/rules/api-design.mdc` - API设计规范

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-03 20:48:19 CST

