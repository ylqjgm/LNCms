# TASK002-55: 基础数据初始化 - 系统配置

## 任务信息

**任务编号**: TASK002-55  
**父任务**: TASK002  
**任务名称**: 基础数据初始化 - 系统配置  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 22:13:54 CST

## 任务描述

编写系统配置的基础数据初始化脚本，使用 golang-migrate 工具创建系统配置表的初始化数据脚本。必须遵循 PostgreSQL 数据库设计规范。

## 依赖任务

TASK002-52（数据库迁移脚本 - 核心模块）

## 实现指南

### 1. 分析需求文档

阅读 `docs/Requirements/Core.md` 文档，了解系统配置的详细需求：
- 网站设置：网站名称、网站地址、网站关键字、网站描述等
- 注册设置：注册开关、验证码开关、密码要求等
- 站群设置：主站设置、集群节点等
- 积分设置：积分名称、注册积分、登录积分等
- 附件设置：存储渠道、图片附件、音频附件、视频附件等
- 邮箱设置：SMTP服务器、端口、认证信息等
- 屏蔽设置：黑名单、禁用词汇等

### 2. 创建初始化脚本文件

使用 golang-migrate 工具创建初始化脚本：
- 初始化脚本目录：`migrations/core/seeds/`
- 初始化脚本命名：`YYYYMMDDHHMMSS_seed_system_config.up.sql` 和 `YYYYMMDDHHMMSS_seed_system_config.down.sql`

### 3. 编写初始化脚本

#### 3.1 升级脚本（up.sql）

插入系统配置的默认数据：

```sql
-- 插入网站设置默认配置
INSERT INTO configs (config_key, config_value, config_type, description) VALUES
('site_name', 'LNCms', 'site', '网站名称'),
('site_url', 'http://localhost', 'site', '网站地址'),
('site_keywords', 'LNCms,内容管理系统', 'site', '网站关键字'),
('site_description', 'LNCms 是一个现代化的内容发布网站系统', 'site', '网站描述'),
('site_enabled', 'true', 'site', '网站开关');

-- 插入注册设置默认配置
INSERT INTO configs (config_key, config_value, config_type, description) VALUES
('register_enabled', 'true', 'register', '注册开关'),
('captcha_enabled', 'true', 'register', '验证码开关'),
('password_requirements', '{"min_length":8,"max_length":128,"require_uppercase":false,"require_lowercase":false,"require_number":false,"require_special":false}', 'register', '用户密码要求');

-- 插入积分设置默认配置
INSERT INTO configs (config_key, config_value, config_type, description) VALUES
('points_name', '积分', 'points', '积分名称'),
('register_points', '0', 'points', '注册积分'),
('login_points', '0', 'points', '登录积分'),
('comment_points', '0', 'points', '评论积分'),
('recharge_points_ratio', '1.0', 'points', '充值积分比例'),
('consume_points_ratio', '1.0', 'points', '消费积分比例');
```

#### 3.2 回滚脚本（down.sql）

删除系统配置的初始化数据：

```sql
-- 删除系统配置数据
DELETE FROM configs WHERE config_type IN ('site', 'register', 'cluster', 'points', 'attachment', 'email', 'shield');
```

### 4. 初始化脚本要求

- **幂等性**：初始化脚本应该是幂等的，可以安全地重复执行
- **使用 INSERT ... ON CONFLICT**：使用 `ON CONFLICT DO NOTHING` 或 `ON CONFLICT DO UPDATE` 确保幂等性
- **可回滚**：每个升级脚本必须有对应的回滚脚本
- **数据完整性**：确保插入的数据符合表约束和业务规则

### 5. 验证初始化脚本

- 使用 golang-migrate 工具验证初始化脚本语法
- 测试升级和回滚操作
- 确保所有配置数据都正确插入

## 验收标准

1. 初始化脚本文件命名符合 golang-migrate 规范
2. 所有系统配置的默认数据都包含在初始化脚本中
3. 初始化脚本遵循幂等性原则
4. 升级脚本和回滚脚本都正确编写
5. 初始化脚本可以成功执行，无错误
6. 回滚脚本可以成功执行，无错误
7. 插入的数据符合业务规则和表约束

## 相关文件

- `docs/Requirements/Core.md` - 核心模块需求文档
- `.cursor/rules/database.mdc` - PostgreSQL 数据库设计规范
- `docs/TASKS/TASK002/TASK002.md` - 主任务文档
- `docs/TASKS/TASK002/TASK002-01.md` - 系统配置表设计文档
- `docs/TASKS/TASK002/TASK002-52.md` - 数据库迁移脚本文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 22:13:54 CST

