# TASK002-60: 基础数据初始化 - 默认作者类型和作者等级

## 任务信息

**任务编号**: TASK002-60  
**父任务**: TASK002  
**任务名称**: 基础数据初始化 - 默认作者类型和作者等级  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 22:13:54 CST

## 任务描述

编写默认作者类型和作者等级的基础数据初始化脚本，使用 golang-migrate 工具创建作者类型表和作者等级表的初始化数据脚本。必须遵循 PostgreSQL 数据库设计规范。

## 依赖任务

TASK002-51（数据库迁移脚本 - 核心模块）

## 实现指南

### 1. 分析需求文档

阅读 `docs/Requirements/Core.md` 文档，了解作者管理的详细需求：
- 作者类型管理：小说作者、漫画作者、音频作者、视频作者等
- 作者等级管理：作者等级名称、作者等级描述、作者等级达成条件等
- 默认作者类型：novel（小说作者）、comic（漫画作者）、audio（音频作者）、video（视频作者）
- 默认作者等级：新手作者、初级作者、中级作者、高级作者、专家作者等

### 2. 创建初始化脚本文件

使用 golang-migrate 工具创建初始化脚本：
- 初始化脚本目录：`migrations/core/seeds/`
- 初始化脚本命名：`YYYYMMDDHHMMSS_seed_default_author_types_and_levels.up.sql` 和 `YYYYMMDDHHMMSS_seed_default_author_types_and_levels.down.sql`

### 3. 编写初始化脚本

#### 3.1 升级脚本（up.sql）

插入默认作者类型和作者等级数据：

```sql
-- 插入默认作者类型
INSERT INTO author_types (id, type_code, type_name, type_description, display_order, is_active, created_at) VALUES
(1, 'novel', '小说作者', '创作小说类内容的作者', 1, true, CURRENT_TIMESTAMP),
(2, 'comic', '漫画作者', '创作漫画类内容的作者', 2, true, CURRENT_TIMESTAMP),
(3, 'audio', '音频作者', '创作音频类内容的作者', 3, true, CURRENT_TIMESTAMP),
(4, 'video', '视频作者', '创作视频类内容的作者', 4, true, CURRENT_TIMESTAMP)
ON CONFLICT (type_code) DO NOTHING;

-- 插入默认作者等级
INSERT INTO author_levels (level_name, level_description, level_conditions, level_order, is_active, created_at) VALUES
('新手作者', '刚注册的作者，需要完成基础认证', '{"works_count": 0, "avg_rating": 0.0, "recommendations": 0, "votes": 0, "comments": 0, "rewards": 0}'::jsonb, 1, true, CURRENT_TIMESTAMP),
('初级作者', '已发布少量作品的作者', '{"works_count": 1, "avg_rating": 3.0, "recommendations": 10, "votes": 50, "comments": 20, "rewards": 0}'::jsonb, 2, true, CURRENT_TIMESTAMP),
('中级作者', '已发布一定数量作品并获得一定评价的作者', '{"works_count": 5, "avg_rating": 4.0, "recommendations": 100, "votes": 500, "comments": 100, "rewards": 10}'::jsonb, 3, true, CURRENT_TIMESTAMP),
('高级作者', '已发布较多作品并获得较高评价的作者', '{"works_count": 20, "avg_rating": 4.5, "recommendations": 500, "votes": 2000, "comments": 500, "rewards": 100}'::jsonb, 4, true, CURRENT_TIMESTAMP),
('专家作者', '已发布大量作品并获得极高评价的作者', '{"works_count": 50, "avg_rating": 4.8, "recommendations": 2000, "votes": 10000, "comments": 2000, "rewards": 1000}'::jsonb, 5, true, CURRENT_TIMESTAMP)
ON CONFLICT (level_name) DO NOTHING;
```

#### 3.2 回滚脚本（down.sql）

删除默认作者类型和作者等级数据：

```sql
-- 删除默认作者等级
DELETE FROM author_levels WHERE level_name IN ('新手作者', '初级作者', '中级作者', '高级作者', '专家作者');

-- 删除默认作者类型
DELETE FROM author_types WHERE type_code IN ('novel', 'comic', 'audio', 'video');
```

### 4. 初始化脚本要求

- **幂等性**：初始化脚本应该是幂等的，可以安全地重复执行
- **使用 INSERT ... ON CONFLICT**：使用 `ON CONFLICT DO NOTHING` 确保幂等性
- **可回滚**：每个升级脚本必须有对应的回滚脚本
- **数据完整性**：确保插入的数据符合表约束和业务规则
- **JSONB 格式**：作者等级的 level_conditions 字段使用 JSONB 格式存储

### 5. 验证初始化脚本

- 使用 golang-migrate 工具验证初始化脚本语法
- 测试升级和回滚操作
- 确保所有作者类型和作者等级数据都正确插入
- 验证 JSONB 数据格式正确

## 验收标准

1. 初始化脚本文件命名符合 golang-migrate 规范
2. 所有默认作者类型数据都包含在初始化脚本中（novel、comic、audio、video）
3. 所有默认作者等级数据都包含在初始化脚本中（新手作者、初级作者、中级作者、高级作者、专家作者）
4. 初始化脚本遵循幂等性原则
5. 升级脚本和回滚脚本都正确编写
6. 初始化脚本可以成功执行，无错误
7. 回滚脚本可以成功执行，无错误
8. 插入的数据符合业务规则和表约束
9. 作者等级的 level_conditions 字段使用正确的 JSONB 格式

## 相关文件

- `docs/Requirements/Core.md` - 核心模块需求文档
- `.cursor/rules/database.mdc` - PostgreSQL 数据库设计规范
- `docs/TASKS/TASK002/TASK002.md` - 主任务文档
- `docs/TASKS/TASK002/TASK002-05.md` - 作者类型表设计文档
- `docs/TASKS/TASK002/TASK002-06.md` - 作者等级表设计文档
- `docs/TASKS/TASK002/TASK002-51.md` - 数据库迁移脚本文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 22:13:54 CST
