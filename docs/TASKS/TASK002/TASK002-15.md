# TASK002-15: 数据库设计 - 核心模块 - 作者设置表

## 任务信息

**任务编号**: TASK002-15  
**父任务**: TASK002  
**任务名称**: 数据库设计 - 核心模块 - 作者设置表  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 22:13:54 CST

## 任务描述

设计核心模块的作者设置表（author_settings），用于存储作者个性化设置信息。必须遵循 PostgreSQL 数据库设计规范，包含完整的字段定义、约束、索引、注释等。

## 依赖任务

TASK002-13（作者表）

## 实现指南

### 1. 分析需求文档

阅读 `docs/Requirements/Core.md` 文档，了解作者管理的详细需求：
- 作者设置：作者个性化设置，包括通知设置、隐私设置、显示设置等
- 作者设置与作者表是一对一关系

### 2. 设计作者设置表结构

设计 `author_settings` 表，包含作者个性化设置信息：

```sql
CREATE TABLE author_settings (
    id BIGSERIAL PRIMARY KEY,
    author_id BIGINT NOT NULL UNIQUE,
    notification_settings JSONB,
    privacy_settings JSONB,
    display_settings JSONB,
    extra_settings JSONB,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_author_settings_author_id FOREIGN KEY (author_id) REFERENCES authors(id) ON DELETE CASCADE
);

-- 创建索引
CREATE INDEX idx_author_settings_author_id ON author_settings(author_id);
CREATE UNIQUE INDEX uk_author_settings_author_id ON author_settings(author_id);

-- 创建触发器自动更新 updated_at
CREATE OR REPLACE FUNCTION update_author_settings_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_author_settings_updated_at
    BEFORE UPDATE ON author_settings
    FOR EACH ROW
    EXECUTE FUNCTION update_author_settings_updated_at();

-- 添加表注释
COMMENT ON TABLE author_settings IS '作者设置表，存储作者个性化设置信息';
COMMENT ON COLUMN author_settings.id IS '作者设置ID，自增主键';
COMMENT ON COLUMN author_settings.author_id IS '作者ID，外键关联authors表，一对一关系';
COMMENT ON COLUMN author_settings.notification_settings IS '通知设置，JSONB格式，包含邮件通知、短信通知等设置';
COMMENT ON COLUMN author_settings.privacy_settings IS '隐私设置，JSONB格式，包含隐私保护相关设置';
COMMENT ON COLUMN author_settings.display_settings IS '显示设置，JSONB格式，包含界面显示相关设置';
COMMENT ON COLUMN author_settings.extra_settings IS '扩展设置，JSONB格式，存储其他个性化设置';
COMMENT ON COLUMN author_settings.created_at IS '创建时间，自动设置为当前时间';
COMMENT ON COLUMN author_settings.updated_at IS '更新时间，每次更新时自动更新';
```

### 3. 设计约束

- **主键约束**：`pk_author_settings` (id)
- **外键约束**：`fk_author_settings_author_id` (author_id) 关联 authors(id)，级联删除
- **唯一约束**：`uk_author_settings_author_id` (author_id) - 确保一个作者只有一条设置记录
- **非空约束**：author_id 必须非空

### 4. 设计索引

- **主键索引**：`pk_author_settings` (id) - 自动创建
- **外键索引**：`idx_author_settings_author_id` (author_id) - 用于快速查询作者的设置
- **唯一索引**：`uk_author_settings_author_id` (author_id) - 确保唯一性

### 5. 考虑性能优化

- 为 author_id 创建唯一索引，支持快速查询和确保一对一关系
- 外键约束使用 CASCADE 删除，确保数据一致性
- 使用触发器自动更新 updated_at 字段
- 使用 JSONB 类型存储设置，支持高效的 JSON 查询

## 验收标准

1. 表结构设计完整，包含所有必要字段
2. 所有字段都有适当的类型、约束和默认值
3. 外键约束正确，关联 authors 表
4. 唯一约束正确，确保一个作者只有一条设置记录
5. 索引设计合理，支持常用查询场景
6. 表注释和字段注释完整，使用中文
7. 触发器正确创建，自动更新 updated_at 字段
8. 表设计符合 PostgreSQL 数据库设计规范

## 相关文件

- `docs/Requirements/Core.md` - 核心模块需求文档
- `.cursor/rules/database.mdc` - PostgreSQL 数据库设计规范
- `docs/TASKS/TASK002/TASK002.md` - 主任务文档
- `docs/TASKS/TASK002/TASK002-13.md` - 作者表设计文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 22:13:54 CST

