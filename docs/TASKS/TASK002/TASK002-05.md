# TASK002-05: 数据库设计 - 核心模块 - 作者类型表

## 任务信息

**任务编号**: TASK002-05  
**父任务**: TASK002  
**任务名称**: 数据库设计 - 核心模块 - 作者类型表  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 22:13:54 CST

## 任务描述

设计核心模块的作者类型表（author_types），用于存储作者类型定义（小说作者、漫画作者、音频作者、视频作者等）。作者类型用于标识作者可以创作的内容类型，一个作者可以拥有多个类型。必须遵循 PostgreSQL 数据库设计规范，包含完整的字段定义、约束、索引、注释等。

## 依赖任务

无

## 实现指南

### 1. 分析需求文档

阅读 `docs/Requirements/Core.md` 文档，了解作者管理的详细需求：
- 系统支持多种内容类型：小说、漫画、音频、视频
- 一个作者可能同时创作多种类型的内容
- 需要支持按类型查询作者（如查询所有小说作者）
- 作者类型用于标识作者可以创作的内容类型

### 2. 设计作者类型表结构

设计 `author_types` 表，包含作者类型定义：

```sql
CREATE TABLE author_types (
    id INTEGER PRIMARY KEY,
    type_code VARCHAR(50) NOT NULL UNIQUE,
    type_name VARCHAR(100) NOT NULL,
    type_description TEXT,
    display_order INTEGER NOT NULL DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX idx_author_types_type_code ON author_types(type_code);
CREATE INDEX idx_author_types_display_order ON author_types(display_order);
CREATE INDEX idx_author_types_is_active ON author_types(is_active);
CREATE UNIQUE INDEX uk_author_types_type_code ON author_types(type_code);

-- 创建触发器自动更新 updated_at
CREATE OR REPLACE FUNCTION update_author_types_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_author_types_updated_at
    BEFORE UPDATE ON author_types
    FOR EACH ROW
    EXECUTE FUNCTION update_author_types_updated_at();

-- 添加表注释
COMMENT ON TABLE author_types IS '作者类型表，存储作者类型定义，用于查询和显示';
COMMENT ON COLUMN author_types.id IS '类型ID，主键，用于在authors表的author_type_ids数组中引用';
COMMENT ON COLUMN author_types.type_code IS '类型代码，唯一标识符，如novel、comic、audio、video';
COMMENT ON COLUMN author_types.type_name IS '类型名称，用于显示，如小说作者、漫画作者、音频作者、视频作者';
COMMENT ON COLUMN author_types.type_description IS '类型描述，说明该类型的用途和特点';
COMMENT ON COLUMN author_types.display_order IS '显示顺序，数字越小越靠前，用于排序';
COMMENT ON COLUMN author_types.is_active IS '是否启用，TRUE-启用，FALSE-禁用';
COMMENT ON COLUMN author_types.created_at IS '创建时间，自动设置为当前时间';
COMMENT ON COLUMN author_types.updated_at IS '更新时间，每次更新时自动更新';
```

### 3. 设计约束

- **主键约束**：`pk_author_types` (id)
- **唯一约束**：`uk_author_types_type_code` (type_code)
- **非空约束**：type_code、type_name 必须非空
- **默认值**：display_order 默认为 0，is_active 默认为 TRUE

### 4. 设计索引

- **主键索引**：`pk_author_types` (id) - 自动创建
- **唯一索引**：`uk_author_types_type_code` (type_code) - 确保类型代码唯一
- **普通索引**：`idx_author_types_type_code` (type_code) - 用于快速查询
- **普通索引**：`idx_author_types_display_order` (display_order) - 用于排序查询
- **普通索引**：`idx_author_types_is_active` (is_active) - 用于筛选启用的类型

### 5. 考虑性能优化

- 为 type_code 创建唯一索引，支持快速查询和唯一性检查
- 为 display_order 创建索引，支持排序查询
- 为 is_active 创建索引，支持状态筛选查询
- 使用触发器自动更新 updated_at 字段
- 使用 INTEGER 类型作为主键，便于在数组中使用

## 验收标准

1. 表结构设计完整，包含所有必要字段
2. 所有字段都有适当的类型、约束和默认值
3. 主键使用 INTEGER 类型，便于在数组中使用
4. 索引设计合理，支持常用查询场景
5. 表注释和字段注释完整，使用中文
6. 触发器正确创建，自动更新 updated_at 字段
7. 表设计符合 PostgreSQL 数据库设计规范

## 相关文件

- `docs/Requirements/Core.md` - 核心模块需求文档
- `.cursor/rules/database.mdc` - PostgreSQL 数据库设计规范
- `docs/TASKS/TASK002/TASK002.md` - 主任务文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 22:13:54 CST
