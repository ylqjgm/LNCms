# TASK004-22: 配置等级管理API路由

## 任务信息

**任务编号**: TASK004-22  
**父任务**: TASK004  
**任务名称**: 配置等级管理API路由  
**版本信息**: v1.1.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 15:25:47 CST

## 任务描述

配置等级管理的API路由。包括：1) 在路由配置文件中定义等级管理路由；2) 配置GET、POST、PUT、DELETE路由；3) 配置权限检查中间件（需要管理员权限）。所有路由必须遵循OpenAPI 3.1.1规范，路径使用/api/v1/前缀。

## 依赖任务

- TASK004-21: 创建LevelHandler接口和实现

## 实现指南

### 1. 路由配置文件结构

在 `internal/router/router.go` 或类似的路由配置文件中，定义等级管理路由：

```go
package router

import (
    "github.com/gin-gonic/gin"
    "yourproject/internal/pkg/handler"
    "yourproject/internal/middleware"
)

// SetupLevelRoutes 设置等级管理路由
func SetupLevelRoutes(r *gin.RouterGroup, levelHandler handler.LevelHandler) {
    levels := r.Group("/levels")
    {
        // 获取等级列表（需要管理员权限）
        levels.GET("", middleware.RequireAdmin(), levelHandler.GetAll)
        
        // 获取等级详情（需要管理员权限）
        levels.GET("/:id", middleware.RequireAdmin(), levelHandler.GetByID)
        
        // 创建等级（需要管理员权限）
        levels.POST("", middleware.RequireAdmin(), levelHandler.Create)
        
        // 更新等级（需要管理员权限）
        levels.PUT("/:id", middleware.RequireAdmin(), levelHandler.Update)
        
        // 删除等级（需要管理员权限）
        levels.DELETE("/:id", middleware.RequireAdmin(), levelHandler.Delete)
    }
}
```

### 2. 在主路由中注册

在 `internal/router/router.go` 的主路由配置中注册等级管理路由：

```go
// SetupRoutes 设置所有路由
func SetupRoutes(r *gin.Engine, deps *Dependencies) {
    // API v1 路由组
    v1 := r.Group("/api/v1")
    {
        // 等级管理路由
        SetupLevelRoutes(v1, deps.LevelHandler)
        
        // 其他路由...
    }
}
```

### 3. 路由路径规范

所有路由路径遵循以下规范：

- **基础路径**: `/api/v1/levels`
- **获取等级列表**: `GET /api/v1/levels`
- **获取等级详情**: `GET /api/v1/levels/:id`
- **创建等级**: `POST /api/v1/levels`
- **更新等级**: `PUT /api/v1/levels/:id`
- **删除等级**: `DELETE /api/v1/levels/:id`

### 4. 中间件配置

所有等级管理路由都需要管理员权限中间件：

```go
// 示例中间件配置（如果中间件尚未实现，需要先实现）
// middleware/auth.go
package middleware

import (
    "net/http"
    
    "github.com/gin-gonic/gin"
)

// RequireAdmin 要求管理员权限的中间件
func RequireAdmin() gin.HandlerFunc {
    return func(c *gin.Context) {
        // TODO: 实现管理员权限检查逻辑
        // 这里需要根据实际的认证和授权机制实现
        // 示例代码：
        // user := GetUserFromContext(c)
        // if user == nil || !user.IsAdmin() {
        //     response.Error(c, http.StatusForbidden, "FORBIDDEN", "需要管理员权限", nil)
        //     c.Abort()
        //     return
        // }
        c.Next()
    }
}
```

### 5. 路由文档注释

如果需要生成Swagger文档，路由配置应该包含相应的注释：

```go
// SetupLevelRoutes 设置等级管理路由
// @Summary 等级管理API
// @Description 等级管理的RESTful API接口
// @Tags 等级管理
// @Security BearerAuth
func SetupLevelRoutes(r *gin.RouterGroup, levelHandler handler.LevelHandler) {
    // ...
}
```

## 验收标准

1. **路由配置完整**
   - 所有等级管理路由都已配置
   - 路由路径符合规范（/api/v1/levels前缀）
   - HTTP方法正确（GET、POST、PUT、DELETE）

2. **中间件配置正确**
   - 所有路由都配置了管理员权限中间件
   - 中间件正确检查用户权限
   - 未授权访问返回适当的错误响应

3. **路由路径规范**
   - 路由路径遵循RESTful规范
   - 路径参数命名规范（:id）
   - 路径与Handler方法正确对应

4. **代码规范符合要求**
   - 代码通过golangci-lint检查
   - 代码注释完整，使用中文
   - 遵循Golang编码规范

5. **路由可访问性**
   - 所有路由可以正常访问
   - 路由与Handler正确绑定
   - 权限检查正常工作

## 相关文件

- `internal/router/router.go` - 路由配置文件
- `internal/middleware/auth.go` - 认证和授权中间件
- `internal/pkg/handler/level_handler.go` - 等级处理器
- `docs/TASKS/TASK004/TASK004-21.md` - 创建LevelHandler接口任务文档
- `.cursor/rules/api-design.mdc` - API设计规范
- `docs/TASKS/TASK004/TASK004.md` - 主任务文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.1.0  
**最后更新**: 2026-01-03 15:25:47 CST

