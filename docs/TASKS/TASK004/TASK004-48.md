# TASK004-48: 配置权限管理API路由

## 任务信息

**任务编号**: TASK004-48  
**父任务**: TASK004  
**任务名称**: 配置权限管理API路由  
**版本信息**: v1.1.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 15:00:00 CST

## 任务描述

配置权限管理的API路由。包括：1) 在路由配置文件中定义权限管理路由；2) 配置GET /api/v1/permissions路由（获取权限列表）；3) 配置GET /api/v1/permissions/groups/{group_id}路由（获取组权限）；4) 配置PUT /api/v1/permissions/groups/{group_id}路由（更新组权限，需要管理员权限）；5) 配置权限检查中间件（更新组权限需要管理员权限）。所有路由必须遵循OpenAPI 3.1.1规范。

## 依赖任务

- TASK004-47: 创建PermissionHandler接口和实现

## 实现指南

### 1. 参考路由配置文件

查看项目中的路由配置文件，了解路由配置方式：
- 路由配置文件通常位于 `internal/pkg/router/router.go` 或类似位置
- 参考其他模块的路由配置方式（如角色管理路由）

### 2. 在路由配置文件中添加权限管理路由

在路由配置文件中添加权限管理路由：

```go
package router

import (
    "github.com/gin-gonic/gin"
    "yourproject/internal/pkg/handler"
    "yourproject/internal/pkg/middleware"
)

// SetupPermissionRoutes 配置权限管理路由
func SetupPermissionRoutes(r *gin.RouterGroup, permissionHandler handler.PermissionHandler, authMiddleware gin.HandlerFunc, adminMiddleware gin.HandlerFunc) {
    // 权限管理路由组
    permissionGroup := r.Group("/permissions")
    {
        // GET /api/v1/permissions - 获取权限列表（需要认证）
        permissionGroup.GET("", authMiddleware, permissionHandler.GetPermissions)
        
        // GET /api/v1/permissions/groups/:group_id - 获取用户组权限列表（需要认证）
        permissionGroup.GET("/groups/:group_id", authMiddleware, permissionHandler.GetGroupPermissions)
        
        // PUT /api/v1/permissions/groups/:group_id - 更新用户组权限（需要管理员权限）
        permissionGroup.PUT("/groups/:group_id", authMiddleware, adminMiddleware, permissionHandler.UpdateGroupPermissions)
    }
}
```

### 3. 在主路由文件中注册权限管理路由

在主路由文件中调用SetupPermissionRoutes：

```go
// 在主路由配置文件中
func SetupRoutes(r *gin.Engine, deps *Dependencies) {
    // API v1路由组
    v1 := r.Group("/api/v1")
    {
        // 权限管理路由
        SetupPermissionRoutes(
            v1,
            deps.PermissionHandler,
            deps.AuthMiddleware,
            deps.AdminMiddleware,
        )
        
        // 其他模块路由...
    }
}
```

### 4. 配置中间件

确保中间件正确配置：

```go
// 认证中间件 - 验证用户是否已登录
authMiddleware := middleware.AuthMiddleware()

// 管理员权限中间件 - 验证用户是否有管理员权限
adminMiddleware := middleware.AdminMiddleware()
```

### 5. 路由路径规范

确保路由路径符合OpenAPI 3.1.1规范：
- 使用RESTful风格
- 路径参数使用 `:param` 格式
- 路径使用小写字母和下划线
- 所有路由使用 `/api/v1` 前缀

### 6. HTTP方法规范

确保使用正确的HTTP方法：
- GET - 获取资源
- POST - 创建资源
- PUT - 更新资源
- DELETE - 删除资源

### 7. 权限检查规范

确保权限检查正确配置：
- 获取权限列表：需要认证（authMiddleware）
- 获取用户组权限：需要认证（authMiddleware）
- 更新用户组权限：需要管理员权限（authMiddleware + adminMiddleware）

### 8. 代码规范要求

- 路由配置清晰，易于维护
- 使用路由组组织相关路由
- 中间件配置正确
- 路由注释完整，使用中文
- 遵循RESTful API设计规范

## 验收标准

1. **路由配置完整**
   - 所有权限管理路由都已配置
   - 路由路径正确，符合OpenAPI 3.1.1规范
   - HTTP方法使用正确

2. **中间件配置正确**
   - 认证中间件正确配置
   - 管理员权限中间件正确配置
   - 权限检查逻辑正确

3. **路由路径规范**
   - 所有路由使用 `/api/v1` 前缀
   - 路径参数格式正确
   - 路径命名符合RESTful规范

4. **代码规范符合要求**
   - 代码通过golangci-lint检查
   - 代码注释完整，使用中文
   - 遵循Golang编码规范
   - 路由组织清晰

5. **功能正确性**
   - 所有路由都能正确访问
   - 中间件正确拦截未授权请求
   - 权限检查正确执行

## 相关文件

- `internal/pkg/router/router.go` - 路由配置文件
- `internal/pkg/handler/permission_handler.go` - 权限处理器
- `internal/pkg/middleware/auth_middleware.go` - 认证中间件
- `internal/pkg/middleware/admin_middleware.go` - 管理员权限中间件
- `docs/TASKS/TASK004/TASK004-47.md` - 创建PermissionHandler接口任务文档
- `.cursor/rules/api-design.mdc` - API设计规范
- `docs/TASKS/TASK004/TASK004.md` - 主任务文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.1.0  
**最后更新**: 2026-01-03 15:00:00 CST

