# TASK004-37: 配置作者等级管理API路由

## 任务信息

**任务编号**: TASK004-37  
**父任务**: TASK004  
**任务名称**: 配置作者等级管理API路由  
**版本信息**: v1.1.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 15:34:33 CST

## 任务描述

配置作者等级管理的API路由。包括：1) 在路由配置文件中定义作者等级管理路由；2) 配置GET、POST、PUT、DELETE路由；3) 配置权限检查中间件（需要管理员权限）。所有路由必须遵循OpenAPI 3.1.1规范，路径使用/api/v1/前缀。

## 依赖任务

- TASK004-36: 创建AuthorLevelHandler接口和实现

## 实现指南

### 1. 路由配置文件结构

在 `internal/router/router.go` 或类似的路由配置文件中，定义作者等级管理路由：

```go
package router

import (
    "github.com/gin-gonic/gin"
    "yourproject/internal/pkg/handler"
    "yourproject/internal/middleware"
)

// SetupAuthorLevelRoutes 设置作者等级管理路由
func SetupAuthorLevelRoutes(r *gin.RouterGroup, authorLevelHandler handler.AuthorLevelHandler) {
    authorLevels := r.Group("/author-levels")
    {
        // 获取作者等级列表（需要管理员权限）
        authorLevels.GET("", middleware.RequireAdmin(), authorLevelHandler.GetAll)
        
        // 获取作者等级详情（需要管理员权限）
        authorLevels.GET("/:id", middleware.RequireAdmin(), authorLevelHandler.GetByID)
        
        // 创建作者等级（需要管理员权限）
        authorLevels.POST("", middleware.RequireAdmin(), authorLevelHandler.Create)
        
        // 更新作者等级（需要管理员权限）
        authorLevels.PUT("/:id", middleware.RequireAdmin(), authorLevelHandler.Update)
        
        // 删除作者等级（需要管理员权限）
        authorLevels.DELETE("/:id", middleware.RequireAdmin(), authorLevelHandler.Delete)
    }
}
```

### 2. 在主路由中注册

在 `internal/router/router.go` 的主路由配置中注册作者等级管理路由：

```go
// SetupRoutes 设置所有路由
func SetupRoutes(r *gin.Engine, deps *Dependencies) {
    // API v1 路由组
    v1 := r.Group("/api/v1")
    {
        // 作者等级管理路由
        SetupAuthorLevelRoutes(v1, deps.AuthorLevelHandler)
        
        // 其他路由...
    }
}
```

### 3. 路由路径规范

所有路由路径遵循以下规范：

- **基础路径**: `/api/v1/author-levels`
- **获取作者等级列表**: `GET /api/v1/author-levels`
- **获取作者等级详情**: `GET /api/v1/author-levels/:id`
- **创建作者等级**: `POST /api/v1/author-levels`
- **更新作者等级**: `PUT /api/v1/author-levels/:id`
- **删除作者等级**: `DELETE /api/v1/author-levels/:id`

### 4. 中间件配置

所有作者等级管理路由都需要管理员权限中间件：

```go
// 示例中间件配置（如果中间件尚未实现，需要先实现）
// middleware/auth.go
package middleware

import (
    "net/http"
    
    "github.com/gin-gonic/gin"
)

// RequireAdmin 要求管理员权限的中间件
func RequireAdmin() gin.HandlerFunc {
    return func(c *gin.Context) {
        // 从上下文获取用户信息
        user, exists := c.Get("user")
        if !exists {
            c.JSON(http.StatusUnauthorized, gin.H{
                "error": "未授权",
            })
            c.Abort()
            return
        }
        
        // 检查用户是否为管理员
        // 这里需要根据实际的用户模型和权限检查逻辑实现
        // if !user.IsAdmin() {
        //     c.JSON(http.StatusForbidden, gin.H{
        //         "error": "权限不足",
        //     })
        //     c.Abort()
        //     return
        // }
        
        c.Next()
    }
}
```

### 5. 路由分组和中间件顺序

确保中间件按正确顺序执行：

```go
// SetupAuthorLevelRoutes 设置作者等级管理路由
func SetupAuthorLevelRoutes(r *gin.RouterGroup, authorLevelHandler handler.AuthorLevelHandler) {
    // 所有作者等级管理路由都需要管理员权限
    authorLevels := r.Group("/author-levels")
    authorLevels.Use(middleware.RequireAdmin()) // 在路由组级别应用中间件
    {
        authorLevels.GET("", authorLevelHandler.GetAll)
        authorLevels.GET("/:id", authorLevelHandler.GetByID)
        authorLevels.POST("", authorLevelHandler.Create)
        authorLevels.PUT("/:id", authorLevelHandler.Update)
        authorLevels.DELETE("/:id", authorLevelHandler.Delete)
    }
}
```

### 6. 代码规范要求

- 路由路径使用小写字母和连字符（kebab-case）
- 所有路由使用/api/v1前缀
- 使用适当的HTTP方法（GET、POST、PUT、DELETE）
- 配置权限检查中间件
- 路由组织清晰，职责单一

## 验收标准

1. **路由配置完整**
   - 定义了所有必需的路由：GET、POST、PUT、DELETE
   - 路由路径符合规范（/api/v1/author-levels）
   - 路由与Handler方法正确对应

2. **中间件配置正确**
   - 所有路由都配置了管理员权限中间件
   - 中间件按正确顺序执行

3. **路由组织清晰**
   - 路由分组合理
   - 路由代码结构清晰，易于维护

4. **代码规范符合要求**
   - 代码通过golangci-lint检查，无错误和警告
   - 代码注释完整，使用中文
   - 遵循Golang编码规范
   - 遵循OpenAPI 3.1.1规范

5. **功能正确性**
   - 所有路由可以正常访问
   - 权限检查正常工作
   - 路由与Handler正确绑定

## 相关文件

- `internal/router/router.go` - 路由配置文件
- `internal/pkg/handler/author_level_handler.go` - 作者等级处理器
- `internal/middleware/auth.go` - 权限检查中间件
- `docs/TASKS/TASK004/TASK004-36.md` - 创建AuthorLevelHandler任务文档
- `.cursor/rules/golang.mdc` - Golang编码规范
- `.cursor/rules/api-design.mdc` - API设计规范
- `docs/TASKS/TASK004/TASK004.md` - 主任务文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.1.0  
**最后更新**: 2026-01-03 15:34:33 CST

