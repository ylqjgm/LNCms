# TASK004-11: 创建UserGroupService接口和实现

## 任务信息

**任务编号**: TASK004-11  
**父任务**: TASK004  
**任务名称**: 创建UserGroupService接口和实现  
**版本信息**: v1.1.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 14:54:20 CST

## 任务描述

创建UserGroupService接口和实现，提供用户组的业务逻辑处理。包括：1) 定义UserGroupService接口；2) 实现用户组的创建、查询、更新、删除方法；3) 实现业务逻辑处理（输入验证、业务规则验证等）。所有代码必须遵循Golang编码规范，错误消息使用中文。

## 依赖任务

- TASK004-09: 实现UserGroupRepository接口和实现

## 实现指南

### 1. 定义UserGroupService接口

在 `internal/pkg/service/user_group_service.go` 文件中定义接口：

```go
package service

import (
    "context"
    "yourproject/internal/pkg/model"
)

// UserGroupService 用户组服务接口
type UserGroupService interface {
    // GetByID 根据ID获取用户组
    GetByID(ctx context.Context, id int64) (*model.UserGroup, error)
    
    // GetAll 获取所有用户组
    GetAll(ctx context.Context) ([]*model.UserGroup, error)
    
    // Create 创建用户组
    Create(ctx context.Context, req *CreateUserGroupRequest) (*model.UserGroup, error)
    
    // Update 更新用户组
    Update(ctx context.Context, id int64, req *UpdateUserGroupRequest) (*model.UserGroup, error)
    
    // Delete 删除用户组
    Delete(ctx context.Context, id int64) error
}

// CreateUserGroupRequest 创建用户组请求
type CreateUserGroupRequest struct {
    GroupName        string  `json:"group_name" binding:"required,min=1,max=100"`
    GroupDescription *string `json:"group_description,omitempty"`
    IsActive         bool    `json:"is_active"`
}

// UpdateUserGroupRequest 更新用户组请求
type UpdateUserGroupRequest struct {
    GroupName        string  `json:"group_name" binding:"required,min=1,max=100"`
    GroupDescription *string `json:"group_description,omitempty"`
    IsActive         bool    `json:"is_active"`
}
```

### 2. 实现userGroupService结构体

在同一个文件中实现用户组服务：

```go
import (
    "context"
    "fmt"
    "yourproject/internal/pkg/model"
    "yourproject/internal/pkg/repository"
)

// userGroupService 用户组服务实现
type userGroupService struct {
    userGroupRepo repository.UserGroupRepository
}

// NewUserGroupService 创建用户组服务实例
func NewUserGroupService(userGroupRepo repository.UserGroupRepository) UserGroupService {
    return &userGroupService{
        userGroupRepo: userGroupRepo,
    }
}
```

### 3. 实现GetByID方法

实现根据ID获取用户组的方法：

```go
// GetByID 根据ID获取用户组
func (s *userGroupService) GetByID(ctx context.Context, id int64) (*model.UserGroup, error) {
    if id <= 0 {
        return nil, fmt.Errorf("用户组ID无效")
    }
    
    userGroup, err := s.userGroupRepo.GetByID(ctx, id)
    if err != nil {
        return nil, fmt.Errorf("获取用户组失败: %w", err)
    }
    
    return userGroup, nil
}
```

### 4. 实现GetAll方法

实现获取所有用户组的方法：

```go
// GetAll 获取所有用户组
func (s *userGroupService) GetAll(ctx context.Context) ([]*model.UserGroup, error) {
    userGroups, err := s.userGroupRepo.GetAll(ctx)
    if err != nil {
        return nil, fmt.Errorf("获取用户组列表失败: %w", err)
    }
    
    return userGroups, nil
}
```

### 5. 实现Create方法

实现创建用户组的方法，包含输入验证和业务规则验证：

```go
// Create 创建用户组
func (s *userGroupService) Create(ctx context.Context, req *CreateUserGroupRequest) (*model.UserGroup, error) {
    // 输入验证
    if err := s.validateCreateRequest(req); err != nil {
        return nil, err
    }
    
    // 检查用户组名称是否已存在
    existing, err := s.userGroupRepo.GetByGroupName(ctx, req.GroupName)
    if err == nil && existing != nil {
        return nil, fmt.Errorf("用户组名称已存在")
    }
    
    // 创建用户组
    userGroup := &model.UserGroup{
        GroupName:        req.GroupName,
        GroupDescription: req.GroupDescription,
        IsActive:         req.IsActive,
    }
    
    if err := s.userGroupRepo.Create(ctx, userGroup); err != nil {
        return nil, fmt.Errorf("创建用户组失败: %w", err)
    }
    
    return userGroup, nil
}

// validateCreateRequest 验证创建请求
func (s *userGroupService) validateCreateRequest(req *CreateUserGroupRequest) error {
    if req == nil {
        return fmt.Errorf("请求参数不能为空")
    }
    if req.GroupName == "" {
        return fmt.Errorf("用户组名称不能为空")
    }
    if len(req.GroupName) > 100 {
        return fmt.Errorf("用户组名称长度不能超过100个字符")
    }
    return nil
}
```

### 6. 实现Update方法

实现更新用户组的方法：

```go
// Update 更新用户组
func (s *userGroupService) Update(ctx context.Context, id int64, req *UpdateUserGroupRequest) (*model.UserGroup, error) {
    if id <= 0 {
        return nil, fmt.Errorf("用户组ID无效")
    }
    
    // 输入验证
    if err := s.validateUpdateRequest(req); err != nil {
        return nil, err
    }
    
    // 检查用户组是否存在
    userGroup, err := s.userGroupRepo.GetByID(ctx, id)
    if err != nil {
        return nil, fmt.Errorf("用户组不存在")
    }
    
    // 检查用户组名称是否与其他用户组重复
    existing, err := s.userGroupRepo.GetByGroupName(ctx, req.GroupName)
    if err == nil && existing != nil && existing.ID != id {
        return nil, fmt.Errorf("用户组名称已存在")
    }
    
    // 更新用户组
    userGroup.GroupName = req.GroupName
    userGroup.GroupDescription = req.GroupDescription
    userGroup.IsActive = req.IsActive
    
    if err := s.userGroupRepo.Update(ctx, userGroup); err != nil {
        return nil, fmt.Errorf("更新用户组失败: %w", err)
    }
    
    return userGroup, nil
}

// validateUpdateRequest 验证更新请求
func (s *userGroupService) validateUpdateRequest(req *UpdateUserGroupRequest) error {
    if req == nil {
        return fmt.Errorf("请求参数不能为空")
    }
    if req.GroupName == "" {
        return fmt.Errorf("用户组名称不能为空")
    }
    if len(req.GroupName) > 100 {
        return fmt.Errorf("用户组名称长度不能超过100个字符")
    }
    return nil
}
```

### 7. 实现Delete方法

实现删除用户组的方法：

```go
// Delete 删除用户组
func (s *userGroupService) Delete(ctx context.Context, id int64) error {
    if id <= 0 {
        return fmt.Errorf("用户组ID无效")
    }
    
    // 检查用户组是否存在
    _, err := s.userGroupRepo.GetByID(ctx, id)
    if err != nil {
        return fmt.Errorf("用户组不存在")
    }
    
    // 删除用户组
    if err := s.userGroupRepo.Delete(ctx, id); err != nil {
        return fmt.Errorf("删除用户组失败: %w", err)
    }
    
    return nil
}
```

### 8. 代码规范要求

- 所有错误消息使用中文
- 实现输入验证和业务规则验证
- 使用context.Context传递上下文
- 所有方法都有清晰的注释（使用中文）
- 业务逻辑与数据访问分离

## 验收标准

1. **接口定义完整**
   - UserGroupService接口包含所有必需的方法
   - 请求结构体定义完整，包含验证标签
   - 接口注释完整，使用中文

2. **业务逻辑实现完整**
   - 所有接口方法都有对应的实现
   - 实现了输入验证逻辑
   - 实现了业务规则验证（如用户组名称唯一性检查等）
   - 错误处理正确，错误消息使用中文

3. **代码规范符合要求**
   - 代码通过golangci-lint检查，无错误和警告
   - 代码注释完整，使用中文
   - 遵循Golang编码规范
   - 业务逻辑与数据访问层分离

4. **功能正确性**
   - GetByID方法正确处理参数验证和错误
   - GetAll方法正确返回用户组列表
   - Create方法正确验证输入并创建用户组
   - Update方法正确验证输入并更新用户组
   - Delete方法正确验证并删除用户组

## 相关文件

- `internal/pkg/service/user_group_service.go` - 用户组服务接口和实现
- `internal/pkg/repository/user_group_repository.go` - 用户组仓储接口
- `docs/TASKS/TASK004/TASK004-09.md` - 实现UserGroupRepository接口任务文档
- `.cursor/rules/golang.mdc` - Golang编码规范
- `docs/TASKS/TASK004/TASK004.md` - 主任务文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.1.0  
**最后更新**: 2026-01-03 14:54:20 CST

