# TASK004-26: 创建AuthorTypeService接口和实现

## 任务信息

**任务编号**: TASK004-26  
**父任务**: TASK004  
**任务名称**: 创建AuthorTypeService接口和实现  
**版本信息**: v1.1.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 15:25:47 CST

## 任务描述

创建AuthorTypeService接口和实现，提供作者类型的业务逻辑处理。包括：1) 定义AuthorTypeService接口；2) 实现作者类型的创建、查询、更新、删除方法；3) 实现业务逻辑处理（输入验证、业务规则验证、显示顺序管理等）。所有代码必须遵循Golang编码规范，错误消息使用中文。

## 依赖任务

- TASK004-24: 实现AuthorTypeRepository接口和实现

## 实现指南

### 1. 定义AuthorTypeService接口

在 `internal/pkg/service/author_type_service.go` 文件中定义接口：

```go
package service

import (
    "context"
    "yourproject/internal/pkg/model"
)

// AuthorTypeService 作者类型服务接口
type AuthorTypeService interface {
    // GetByID 根据ID获取作者类型
    GetByID(ctx context.Context, id int64) (*model.AuthorType, error)
    
    // GetAll 获取所有作者类型
    GetAll(ctx context.Context) ([]*model.AuthorType, error)
    
    // Create 创建作者类型
    Create(ctx context.Context, req *CreateAuthorTypeRequest) (*model.AuthorType, error)
    
    // Update 更新作者类型
    Update(ctx context.Context, id int64, req *UpdateAuthorTypeRequest) (*model.AuthorType, error)
    
    // Delete 删除作者类型
    Delete(ctx context.Context, id int64) error
}

// CreateAuthorTypeRequest 创建作者类型请求
type CreateAuthorTypeRequest struct {
    Code      string  `json:"code" binding:"required,min=1,max=50"`
    Name      string  `json:"name" binding:"required,min=1,max=100"`
    Description *string `json:"description,omitempty"`
    SortOrder  int     `json:"sort_order"`
}

// UpdateAuthorTypeRequest 更新作者类型请求
type UpdateAuthorTypeRequest struct {
    Code      string  `json:"code" binding:"required,min=1,max=50"`
    Name      string  `json:"name" binding:"required,min=1,max=100"`
    Description *string `json:"description,omitempty"`
    SortOrder  int     `json:"sort_order"`
}
```

### 2. 实现authorTypeService结构体

在同一个文件中实现作者类型服务：

```go
import (
    "context"
    "fmt"
    "yourproject/internal/pkg/model"
    "yourproject/internal/pkg/repository"
)

// authorTypeService 作者类型服务实现
type authorTypeService struct {
    authorTypeRepo repository.AuthorTypeRepository
}

// NewAuthorTypeService 创建作者类型服务实例
func NewAuthorTypeService(authorTypeRepo repository.AuthorTypeRepository) AuthorTypeService {
    return &authorTypeService{
        authorTypeRepo: authorTypeRepo,
    }
}
```

### 3. 实现GetByID方法

实现根据ID获取作者类型的方法：

```go
// GetByID 根据ID获取作者类型
func (s *authorTypeService) GetByID(ctx context.Context, id int64) (*model.AuthorType, error) {
    if id <= 0 {
        return nil, fmt.Errorf("作者类型ID无效")
    }
    
    authorType, err := s.authorTypeRepo.GetByID(ctx, id)
    if err != nil {
        return nil, fmt.Errorf("获取作者类型失败: %w", err)
    }
    
    return authorType, nil
}
```

### 4. 实现GetAll方法

实现获取所有作者类型的方法：

```go
// GetAll 获取所有作者类型
func (s *authorTypeService) GetAll(ctx context.Context) ([]*model.AuthorType, error) {
    authorTypes, err := s.authorTypeRepo.GetAll(ctx)
    if err != nil {
        return nil, fmt.Errorf("获取作者类型列表失败: %w", err)
    }
    
    return authorTypes, nil
}
```

### 5. 实现Create方法

实现创建作者类型的方法，包含输入验证：

```go
// Create 创建作者类型
func (s *authorTypeService) Create(ctx context.Context, req *CreateAuthorTypeRequest) (*model.AuthorType, error) {
    // 输入验证
    if req == nil {
        return nil, fmt.Errorf("请求参数不能为空")
    }
    
    if req.Code == "" {
        return nil, fmt.Errorf("作者类型代码不能为空")
    }
    
    if req.Name == "" {
        return nil, fmt.Errorf("作者类型名称不能为空")
    }
    
    // 检查代码是否已存在
    existing, err := s.authorTypeRepo.GetByCode(ctx, req.Code)
    if err == nil && existing != nil {
        return nil, fmt.Errorf("作者类型代码已存在")
    }
    
    // 创建作者类型
    authorType := &model.AuthorType{
        Code:        req.Code,
        Name:        req.Name,
        Description: req.Description,
        SortOrder:   req.SortOrder,
    }
    
    if err := s.authorTypeRepo.Create(ctx, authorType); err != nil {
        return nil, fmt.Errorf("创建作者类型失败: %w", err)
    }
    
    return authorType, nil
}
```

### 6. 实现Update方法

实现更新作者类型的方法，包含输入验证：

```go
// Update 更新作者类型
func (s *authorTypeService) Update(ctx context.Context, id int64, req *UpdateAuthorTypeRequest) (*model.AuthorType, error) {
    if id <= 0 {
        return nil, fmt.Errorf("作者类型ID无效")
    }
    
    if req == nil {
        return nil, fmt.Errorf("请求参数不能为空")
    }
    
    if req.Code == "" {
        return nil, fmt.Errorf("作者类型代码不能为空")
    }
    
    if req.Name == "" {
        return nil, fmt.Errorf("作者类型名称不能为空")
    }
    
    // 检查作者类型是否存在
    existing, err := s.authorTypeRepo.GetByID(ctx, id)
    if err != nil {
        return nil, fmt.Errorf("作者类型不存在")
    }
    
    // 如果代码变更，检查新代码是否已存在
    if existing.Code != req.Code {
        codeExists, err := s.authorTypeRepo.GetByCode(ctx, req.Code)
        if err == nil && codeExists != nil {
            return nil, fmt.Errorf("作者类型代码已存在")
        }
    }
    
    // 更新作者类型
    existing.Code = req.Code
    existing.Name = req.Name
    existing.Description = req.Description
    existing.SortOrder = req.SortOrder
    
    if err := s.authorTypeRepo.Update(ctx, existing); err != nil {
        return nil, fmt.Errorf("更新作者类型失败: %w", err)
    }
    
    return existing, nil
}
```

### 7. 实现Delete方法

实现删除作者类型的方法：

```go
// Delete 删除作者类型
func (s *authorTypeService) Delete(ctx context.Context, id int64) error {
    if id <= 0 {
        return fmt.Errorf("作者类型ID无效")
    }
    
    // 检查作者类型是否存在
    _, err := s.authorTypeRepo.GetByID(ctx, id)
    if err != nil {
        return fmt.Errorf("作者类型不存在")
    }
    
    // 删除作者类型
    if err := s.authorTypeRepo.Delete(ctx, id); err != nil {
        return fmt.Errorf("删除作者类型失败: %w", err)
    }
    
    return nil
}
```

### 8. 代码规范要求

- 所有错误消息使用中文
- 实现输入验证
- 实现业务规则验证（代码唯一性检查等）
- 显示顺序管理功能通过sort_order字段实现

## 验收标准

1. **接口定义完整**
   - AuthorTypeService接口包含所有必需的方法
   - 接口注释完整，使用中文
   - 请求结构体定义完整

2. **方法实现完整**
   - 所有接口方法都有对应的实现
   - GetByID方法正确实现
   - GetAll方法正确实现
   - Create方法正确实现，包含输入验证和代码唯一性检查
   - Update方法正确实现，包含输入验证和代码唯一性检查
   - Delete方法正确实现

3. **输入验证正确**
   - 验证请求参数不能为空
   - 验证代码不能为空
   - 验证名称不能为空
   - 验证ID有效性

4. **业务规则验证正确**
   - 创建时检查代码唯一性
   - 更新时检查代码唯一性（如果代码变更）
   - 删除前检查记录是否存在

5. **错误处理正确**
   - 所有错误都使用中文错误消息
   - 错误消息清晰、具体
   - 正确包装和返回错误

6. **代码规范符合要求**
   - 代码通过golangci-lint检查
   - 代码注释完整，使用中文
   - 遵循Golang编码规范

## 相关文件

- `internal/pkg/service/author_type_service.go` - 作者类型服务接口和实现
- `internal/pkg/repository/author_type_repository.go` - 作者类型仓储接口
- `docs/TASKS/TASK004/TASK004-24.md` - 实现AuthorTypeRepository接口任务文档
- `.cursor/rules/golang.mdc` - Golang编码规范
- `docs/TASKS/TASK004/TASK004.md` - 主任务文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.1.0  
**最后更新**: 2026-01-03 15:25:47 CST

