# TASK004-36: 创建AuthorLevelHandler接口和实现

## 任务信息

**任务编号**: TASK004-36  
**父任务**: TASK004  
**任务名称**: 创建AuthorLevelHandler接口和实现  
**版本信息**: v1.1.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 15:34:33 CST

## 任务描述

创建AuthorLevelHandler接口和实现，提供作者等级的HTTP API处理。包括：1) 定义AuthorLevelHandler接口；2) 实现作者等级的创建、查询、更新、删除HTTP处理函数；3) 实现请求参数绑定和响应格式化（Envelope格式）。所有代码必须遵循Golang编码规范和API设计规范，错误消息使用中文。

## 依赖任务

- TASK004-34: 创建AuthorLevelService接口和实现

## 实现指南

### 1. 定义AuthorLevelHandler接口

在 `internal/pkg/handler/author_level_handler.go` 文件中定义接口：

```go
package handler

import (
    "github.com/gin-gonic/gin"
)

// AuthorLevelHandler 作者等级处理器接口
type AuthorLevelHandler interface {
    // GetByID 根据ID获取作者等级
    GetByID(c *gin.Context)
    
    // GetAll 获取所有作者等级
    GetAll(c *gin.Context)
    
    // Create 创建作者等级
    Create(c *gin.Context)
    
    // Update 更新作者等级
    Update(c *gin.Context)
    
    // Delete 删除作者等级
    Delete(c *gin.Context)
}
```

### 2. 实现authorLevelHandler结构体

在同一个文件中实现作者等级处理器：

```go
import (
    "net/http"
    "strconv"
    
    "github.com/gin-gonic/gin"
    "yourproject/internal/pkg/service"
    "yourproject/pkg/response"
)

// authorLevelHandler 作者等级处理器实现
type authorLevelHandler struct {
    authorLevelService service.AuthorLevelService
}

// NewAuthorLevelHandler 创建作者等级处理器实例
func NewAuthorLevelHandler(authorLevelService service.AuthorLevelService) AuthorLevelHandler {
    return &authorLevelHandler{
        authorLevelService: authorLevelService,
    }
}
```

### 3. 实现GetByID方法

实现根据ID获取作者等级的HTTP处理函数：

```go
// GetByID 根据ID获取作者等级
// @Summary 获取作者等级详情
// @Description 根据作者等级ID获取作者等级详细信息
// @Tags 作者等级管理
// @Accept json
// @Produce json
// @Param id path int true "作者等级ID"
// @Success 200 {object} response.Envelope "成功响应"
// @Failure 400 {object} response.Envelope "请求参数错误"
// @Failure 404 {object} response.Envelope "作者等级不存在"
// @Failure 500 {object} response.Envelope "服务器内部错误"
// @Router /api/v1/author-levels/{id} [get]
func (h *authorLevelHandler) GetByID(c *gin.Context) {
    idStr := c.Param("id")
    id, err := strconv.ParseInt(idStr, 10, 64)
    if err != nil {
        response.Error(c, http.StatusBadRequest, "INVALID_PARAM", "作者等级ID无效", nil)
        return
    }
    
    authorLevel, err := h.authorLevelService.GetByID(c.Request.Context(), id)
    if err != nil {
        if err.Error() == "作者等级不存在" {
            response.Error(c, http.StatusNotFound, "AUTHOR_LEVEL_NOT_FOUND", "作者等级不存在", nil)
            return
        }
        response.Error(c, http.StatusInternalServerError, "INTERNAL_ERROR", "获取作者等级失败", nil)
        return
    }
    
    response.Success(c, http.StatusOK, authorLevel)
}
```

### 4. 实现GetAll方法

实现获取所有作者等级的HTTP处理函数：

```go
// GetAll 获取所有作者等级
// @Summary 获取作者等级列表
// @Description 获取所有作者等级列表
// @Tags 作者等级管理
// @Accept json
// @Produce json
// @Success 200 {object} response.Envelope "成功响应"
// @Failure 500 {object} response.Envelope "服务器内部错误"
// @Router /api/v1/author-levels [get]
func (h *authorLevelHandler) GetAll(c *gin.Context) {
    authorLevels, err := h.authorLevelService.GetAll(c.Request.Context())
    if err != nil {
        response.Error(c, http.StatusInternalServerError, "INTERNAL_ERROR", "获取作者等级列表失败", nil)
        return
    }
    
    response.Success(c, http.StatusOK, authorLevels)
}
```

### 5. 实现Create方法

实现创建作者等级的HTTP处理函数：

```go
// Create 创建作者等级
// @Summary 创建作者等级
// @Description 创建新的作者等级
// @Tags 作者等级管理
// @Accept json
// @Produce json
// @Param request body service.CreateAuthorLevelRequest true "创建作者等级请求"
// @Success 201 {object} response.Envelope "成功响应"
// @Failure 400 {object} response.Envelope "请求参数错误"
// @Failure 409 {object} response.Envelope "作者等级名称已存在"
// @Failure 500 {object} response.Envelope "服务器内部错误"
// @Router /api/v1/author-levels [post]
func (h *authorLevelHandler) Create(c *gin.Context) {
    var req service.CreateAuthorLevelRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        response.Error(c, http.StatusBadRequest, "INVALID_PARAM", "请求参数错误", err.Error())
        return
    }
    
    authorLevel, err := h.authorLevelService.Create(c.Request.Context(), &req)
    if err != nil {
        if err.Error() == "作者等级名称已存在" {
            response.Error(c, http.StatusConflict, "AUTHOR_LEVEL_NAME_EXISTS", "作者等级名称已存在", nil)
            return
        }
        response.Error(c, http.StatusInternalServerError, "INTERNAL_ERROR", "创建作者等级失败", nil)
        return
    }
    
    response.Success(c, http.StatusCreated, authorLevel)
}
```

### 6. 实现Update方法

实现更新作者等级的HTTP处理函数：

```go
// Update 更新作者等级
// @Summary 更新作者等级
// @Description 更新作者等级信息
// @Tags 作者等级管理
// @Accept json
// @Produce json
// @Param id path int true "作者等级ID"
// @Param request body service.UpdateAuthorLevelRequest true "更新作者等级请求"
// @Success 200 {object} response.Envelope "成功响应"
// @Failure 400 {object} response.Envelope "请求参数错误"
// @Failure 404 {object} response.Envelope "作者等级不存在"
// @Failure 409 {object} response.Envelope "作者等级名称已存在"
// @Failure 500 {object} response.Envelope "服务器内部错误"
// @Router /api/v1/author-levels/{id} [put]
func (h *authorLevelHandler) Update(c *gin.Context) {
    idStr := c.Param("id")
    id, err := strconv.ParseInt(idStr, 10, 64)
    if err != nil {
        response.Error(c, http.StatusBadRequest, "INVALID_PARAM", "作者等级ID无效", nil)
        return
    }
    
    var req service.UpdateAuthorLevelRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        response.Error(c, http.StatusBadRequest, "INVALID_PARAM", "请求参数错误", err.Error())
        return
    }
    
    authorLevel, err := h.authorLevelService.Update(c.Request.Context(), id, &req)
    if err != nil {
        if err.Error() == "作者等级不存在" {
            response.Error(c, http.StatusNotFound, "AUTHOR_LEVEL_NOT_FOUND", "作者等级不存在", nil)
            return
        }
        if err.Error() == "作者等级名称已存在" {
            response.Error(c, http.StatusConflict, "AUTHOR_LEVEL_NAME_EXISTS", "作者等级名称已存在", nil)
            return
        }
        response.Error(c, http.StatusInternalServerError, "INTERNAL_ERROR", "更新作者等级失败", nil)
        return
    }
    
    response.Success(c, http.StatusOK, authorLevel)
}
```

### 7. 实现Delete方法

实现删除作者等级的HTTP处理函数：

```go
// Delete 删除作者等级
// @Summary 删除作者等级
// @Description 删除指定的作者等级
// @Tags 作者等级管理
// @Accept json
// @Produce json
// @Param id path int true "作者等级ID"
// @Success 200 {object} response.Envelope "成功响应"
// @Failure 400 {object} response.Envelope "请求参数错误"
// @Failure 404 {object} response.Envelope "作者等级不存在"
// @Failure 500 {object} response.Envelope "服务器内部错误"
// @Router /api/v1/author-levels/{id} [delete]
func (h *authorLevelHandler) Delete(c *gin.Context) {
    idStr := c.Param("id")
    id, err := strconv.ParseInt(idStr, 10, 64)
    if err != nil {
        response.Error(c, http.StatusBadRequest, "INVALID_PARAM", "作者等级ID无效", nil)
        return
    }
    
    err = h.authorLevelService.Delete(c.Request.Context(), id)
    if err != nil {
        if err.Error() == "作者等级不存在" {
            response.Error(c, http.StatusNotFound, "AUTHOR_LEVEL_NOT_FOUND", "作者等级不存在", nil)
            return
        }
        response.Error(c, http.StatusInternalServerError, "INTERNAL_ERROR", "删除作者等级失败", nil)
        return
    }
    
    response.Success(c, http.StatusOK, nil)
}
```

### 8. 代码规范要求

- 所有错误消息使用中文
- 使用Envelope格式返回响应
- 使用适当的HTTP状态码
- 实现请求参数验证
- 使用Swagger注释（OpenAPI 3.1.1规范）
- 所有方法都有清晰的注释（使用中文）

## 验收标准

1. **接口定义完整**
   - AuthorLevelHandler接口包含所有必需的方法：GetByID、GetAll、Create、Update、Delete
   - 接口注释完整，使用中文

2. **实现完整**
   - authorLevelHandler结构体正确实现AuthorLevelHandler接口
   - 所有接口方法都有对应的实现
   - 使用Envelope格式返回响应
   - 使用适当的HTTP状态码

3. **错误处理正确**
   - 所有错误都使用中文错误消息
   - 使用Envelope格式返回错误响应
   - 错误代码符合API设计规范
   - 错误消息清晰，包含上下文信息

4. **代码规范符合要求**
   - 代码通过golangci-lint检查，无错误和警告
   - 代码注释完整，使用中文
   - 遵循Golang编码规范
   - 遵循API设计规范
   - 包含Swagger注释

5. **功能正确性**
   - GetByID方法正确处理HTTP请求
   - GetAll方法正确处理HTTP请求
   - Create方法正确处理HTTP请求（包括参数验证）
   - Update方法正确处理HTTP请求（包括参数验证）
   - Delete方法正确处理HTTP请求

## 相关文件

- `internal/pkg/handler/author_level_handler.go` - 作者等级处理器接口和实现
- `internal/pkg/service/author_level_service.go` - 作者等级服务接口
- `pkg/response/response.go` - 响应格式化工具
- `docs/TASKS/TASK004/TASK004-34.md` - 创建AuthorLevelService任务文档
- `.cursor/rules/golang.mdc` - Golang编码规范
- `.cursor/rules/api-design.mdc` - API设计规范
- `docs/TASKS/TASK004/TASK004.md` - 主任务文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.1.0  
**最后更新**: 2026-01-03 15:34:33 CST

