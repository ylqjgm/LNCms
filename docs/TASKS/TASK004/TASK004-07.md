# TASK004-07: 配置角色管理API路由

## 任务信息

**任务编号**: TASK004-07  
**父任务**: TASK004  
**任务名称**: 配置角色管理API路由  
**版本信息**: v1.1.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 14:54:20 CST

## 任务描述

配置角色管理的API路由。包括：1) 在路由配置文件中定义角色管理路由；2) 配置GET、POST、PUT、DELETE路由；3) 配置权限检查中间件（需要管理员权限）。所有路由必须遵循OpenAPI 3.1.1规范，路径使用/api/v1/前缀。

## 依赖任务

- TASK004-06: 创建RoleHandler接口和实现

## 实现指南

### 1. 路由配置文件结构

在 `internal/router/router.go` 或类似的路由配置文件中，定义角色管理路由：

```go
package router

import (
    "github.com/gin-gonic/gin"
    "yourproject/internal/pkg/handler"
    "yourproject/internal/middleware"
)

// SetupRoleRoutes 设置角色管理路由
func SetupRoleRoutes(r *gin.RouterGroup, roleHandler handler.RoleHandler) {
    roles := r.Group("/roles")
    {
        // 获取角色列表（需要管理员权限）
        roles.GET("", middleware.RequireAdmin(), roleHandler.GetAll)
        
        // 获取角色详情（需要管理员权限）
        roles.GET("/:id", middleware.RequireAdmin(), roleHandler.GetByID)
        
        // 创建角色（需要管理员权限）
        roles.POST("", middleware.RequireAdmin(), roleHandler.Create)
        
        // 更新角色（需要管理员权限）
        roles.PUT("/:id", middleware.RequireAdmin(), roleHandler.Update)
        
        // 删除角色（需要管理员权限）
        roles.DELETE("/:id", middleware.RequireAdmin(), roleHandler.Delete)
    }
}
```

### 2. 在主路由中注册

在 `internal/router/router.go` 的主路由配置中注册角色管理路由：

```go
// SetupRoutes 设置所有路由
func SetupRoutes(r *gin.Engine, deps *Dependencies) {
    // API v1 路由组
    v1 := r.Group("/api/v1")
    {
        // 角色管理路由
        SetupRoleRoutes(v1, deps.RoleHandler)
        
        // 其他路由...
    }
}
```

### 3. 路由路径规范

所有路由路径遵循以下规范：

- **基础路径**: `/api/v1/roles`
- **获取角色列表**: `GET /api/v1/roles`
- **获取角色详情**: `GET /api/v1/roles/:id`
- **创建角色**: `POST /api/v1/roles`
- **更新角色**: `PUT /api/v1/roles/:id`
- **删除角色**: `DELETE /api/v1/roles/:id`

### 4. 中间件配置

所有角色管理路由都需要管理员权限中间件：

```go
// 示例中间件配置（如果中间件尚未实现，需要先实现）
// middleware/auth.go
package middleware

import (
    "net/http"
    
    "github.com/gin-gonic/gin"
)

// RequireAdmin 要求管理员权限的中间件
func RequireAdmin() gin.HandlerFunc {
    return func(c *gin.Context) {
        // TODO: 实现管理员权限检查逻辑
        // 这里需要根据实际的认证和授权机制实现
        // 示例代码：
        // user := GetUserFromContext(c)
        // if user == nil || !user.IsAdmin() {
        //     response.Error(c, http.StatusForbidden, "FORBIDDEN", "需要管理员权限", nil)
        //     c.Abort()
        //     return
        // }
        c.Next()
    }
}
```

### 5. 路由文档注释

如果需要生成Swagger文档，路由配置应该包含相应的注释：

```go
// SetupRoleRoutes 设置角色管理路由
// @Summary 角色管理API
// @Description 角色管理的RESTful API接口
// @Tags 角色管理
// @Security BearerAuth
func SetupRoleRoutes(r *gin.RouterGroup, roleHandler handler.RoleHandler) {
    // ...
}
```

## 验收标准

1. **路由配置完整**
   - 所有角色管理路由都已配置
   - 路由路径符合规范（/api/v1/roles前缀）
   - HTTP方法正确（GET、POST、PUT、DELETE）

2. **中间件配置正确**
   - 所有路由都配置了管理员权限中间件
   - 中间件正确检查用户权限
   - 未授权访问返回适当的错误响应

3. **路由路径规范**
   - 路由路径遵循RESTful规范
   - 路径参数命名规范（:id）
   - 路径与Handler方法正确对应

4. **代码规范符合要求**
   - 代码通过golangci-lint检查
   - 代码注释完整，使用中文
   - 遵循Golang编码规范

5. **路由可访问性**
   - 所有路由可以正常访问
   - 路由与Handler正确绑定
   - 权限检查正常工作

## 相关文件

- `internal/router/router.go` - 路由配置文件
- `internal/middleware/auth.go` - 认证和授权中间件
- `internal/pkg/handler/role_handler.go` - 角色处理器
- `docs/TASKS/TASK004/TASK004-06.md` - 创建RoleHandler接口任务文档
- `.cursor/rules/api-design.mdc` - API设计规范
- `docs/TASKS/TASK004/TASK004.md` - 主任务文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.1.0  
**最后更新**: 2026-01-03 14:54:20 CST

