# TASK007-45: 创建ComicService接口和实现 - 状态管理

## 任务信息

**任务编号**: TASK007-45  
**父任务**: TASK007  
**任务名称**: 创建ComicService接口和实现 - 状态管理  
**版本信息**: v1.2.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 23:43:24 CST

## 任务描述

扩展漫画服务，提供漫画状态管理功能。包括：1) 扩展ComicService接口（UpdateStatus等方法）；2) 实现状态更新（草稿、审核中、已发布、已下架等）。所有代码必须遵循Golang编码规范，错误消息使用中文。

## 依赖任务

TASK007-44（创建ComicService接口和实现 - 基础CRUD）

## 实现指南

### 1. 扩展ComicService接口

在 `internal/service/comic_service.go` 文件中扩展ComicService接口，添加状态管理方法：

```go
// ComicService 漫画服务接口
// 提供漫画管理的业务逻辑
type ComicService interface {
    // ... 基础CRUD方法（已在TASK007-44中定义）
    
    // UpdateStatus 更新漫画状态
    UpdateStatus(ctx context.Context, id int64, status string) error
}
```

### 2. 实现状态管理方法

在 `comic_service.go` 文件中扩展 `comicService` 结构体，添加状态管理方法实现：

```go
// UpdateStatus 更新漫画状态
func (s *comicService) UpdateStatus(ctx context.Context, id int64, status string) error {
    if id <= 0 {
        return errors.New("漫画ID无效")
    }
    
    // 验证状态
    validStatuses := []string{"draft", "reviewing", "published", "archived"}
    isValid := false
    for _, validStatus := range validStatuses {
        if status == validStatus {
            isValid = true
            break
        }
    }
    if !isValid {
        return errors.New("无效的漫画状态")
    }
    
    // 检查漫画是否存在
    _, err := s.comicRepo.GetByID(ctx, id)
    if err != nil {
        return errors.New("漫画不存在")
    }
    
    // 更新状态
    if err := s.comicRepo.UpdateStatus(ctx, id, status); err != nil {
        return fmt.Errorf("更新漫画状态失败: %w", err)
    }
    
    return nil
}
```

### 3. 注意事项

- **状态验证**：更新状态前验证状态值是否有效
- **错误处理**：所有错误消息必须使用中文
- **存在性检查**：更新前检查漫画是否存在

## 验收标准

1. **接口扩展完整**
   - ComicService接口已扩展状态管理方法
   - 方法签名正确，参数和返回值类型正确

2. **状态管理实现**
   - UpdateStatus方法能正确更新漫画状态
   - 状态验证逻辑正确
   - 错误处理完善

3. **错误处理**
   - 所有错误消息使用中文
   - 错误处理完整、清晰

4. **代码规范**
   - 遵循Golang编码规范
   - 代码注释完整（使用中文）

## 相关文件

- `docs/TASKS/TASK007/TASK007-44.md` - ComicService基础CRUD实现文档
- `docs/TASKS/TASK007/TASK007-26.md` - ComicRepository实现文档
- `docs/TASKS/TASK007/TASK007-41.md` - NovelService状态管理实现参考
- `.cursor/rules/coding-standards.mdc` - Golang编码规范
- `internal/service/comic_service.go` - ComicService接口和实现文件（待扩展）

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-03 23:43:24 CST

