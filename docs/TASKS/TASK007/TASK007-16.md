# TASK007-16: 创建VideoSeason模型

## 任务信息

**任务编号**: TASK007-16  
**父任务**: TASK007  
**任务名称**: 创建VideoSeason模型  
**版本信息**: v1.2.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 23:05:05 CST

## 任务描述

创建视频分季管理的GORM模型，定义视频分季表结构。包括：1) 创建VideoSeason模型，定义字段（包含video_id、name、description、sort_order、status等）；2) 添加模型标签和索引定义；3) 添加表注释和字段注释。所有代码必须遵循Golang编码规范。

## 依赖任务

TASK007-15（创建Video模型）

## 实现指南

### 1. 参考数据库设计文档

阅读 `docs/TASKS/TASK002/` 文档，了解video_seasons表的完整设计：
- 表结构：id、video_id、name、description、sort_order、status、created_at、updated_at
- 外键关联：video_id 关联 videos 表
- 索引：video_id、sort_order、status、复合索引 (video_id, sort_order)

### 2. 创建VideoSeason模型文件

在 `internal/models/` 目录下创建 `video_season.go` 文件，定义VideoSeason模型：

```go
package models

import (
    "time"
    "gorm.io/gorm"
)

// VideoSeason 视频分季模型
// 存储视频作品的分季信息，用于组织和管理视频分集
// 一个视频作品可以包含多个分季，每个分季包含多个分集
type VideoSeason struct {
    ID          int64          `gorm:"primaryKey;column:id;type:BIGSERIAL" json:"id"`
    VideoID     int64          `gorm:"column:video_id;type:BIGINT;not null;index:idx_video_seasons_video_id;index:idx_video_seasons_video_sort" json:"video_id"`
    Name        string         `gorm:"column:name;type:VARCHAR(200);not null" json:"name"`
    Description *string        `gorm:"column:description;type:TEXT" json:"description,omitempty"`
    SortOrder   int            `gorm:"column:sort_order;type:INTEGER;not null;default:0;index:idx_video_seasons_sort_order;index:idx_video_seasons_video_sort" json:"sort_order"`
    Status      string         `gorm:"column:status;type:VARCHAR(50);not null;default:'draft';index:idx_video_seasons_status" json:"status"`
    CreatedAt   time.Time      `gorm:"column:created_at;type:TIMESTAMPTZ;default:CURRENT_TIMESTAMP" json:"created_at"`
    UpdatedAt   time.Time      `gorm:"column:updated_at;type:TIMESTAMPTZ;default:CURRENT_TIMESTAMP" json:"updated_at"`
    
    // 关联关系
    Video  *Video  `gorm:"foreignKey:VideoID;references:ID" json:"video,omitempty"`
}

// TableName 指定表名
func (VideoSeason) TableName() string {
    return "video_seasons"
}

// BeforeCreate 创建前钩子
func (vs *VideoSeason) BeforeCreate(tx *gorm.DB) error {
    now := time.Now()
    if vs.CreatedAt.IsZero() {
        vs.CreatedAt = now
    }
    if vs.UpdatedAt.IsZero() {
        vs.UpdatedAt = now
    }
    return nil
}

// BeforeUpdate 更新前钩子
func (vs *VideoSeason) BeforeUpdate(tx *gorm.DB) error {
    vs.UpdatedAt = time.Now()
    return nil
}
```

### 3. 添加模型注释

在模型文件中添加详细的中文注释，说明每个字段的用途：

```go
// VideoSeason 视频分季模型
// 存储视频作品的分季信息，用于组织和管理视频分集
// 一个视频作品可以包含多个分季，每个分季包含多个分集
type VideoSeason struct {
    // ID 分季ID，自增主键
    ID int64 `gorm:"primaryKey;column:id;type:BIGSERIAL" json:"id"`
    
    // VideoID 视频ID，外键关联videos表，必填字段
    VideoID int64 `gorm:"column:video_id;type:BIGINT;not null;index:idx_video_seasons_video_id;index:idx_video_seasons_video_sort" json:"video_id"`
    
    // Name 分季名称，必填字段，最大长度200字符
    Name string `gorm:"column:name;type:VARCHAR(200);not null" json:"name"`
    
    // Description 分季描述，说明分季的内容和特点，可选字段
    Description *string `gorm:"column:description;type:TEXT" json:"description,omitempty"`
    
    // SortOrder 排序顺序，数字越小越靠前，用于排序显示，默认值为0
    SortOrder int `gorm:"column:sort_order;type:INTEGER;not null;default:0;index:idx_video_seasons_sort_order;index:idx_video_seasons_video_sort" json:"sort_order"`
    
    // Status 分季状态：draft-草稿、published-已发布、archived-已归档
    // 必须符合检查约束，默认值为draft
    Status string `gorm:"column:status;type:VARCHAR(50);not null;default:'draft';index:idx_video_seasons_status" json:"status"`
    
    // CreatedAt 创建时间，自动设置为当前时间
    CreatedAt time.Time `gorm:"column:created_at;type:TIMESTAMPTZ;default:CURRENT_TIMESTAMP" json:"created_at"`
    
    // UpdatedAt 更新时间，每次更新时自动更新
    UpdatedAt time.Time `gorm:"column:updated_at;type:TIMESTAMPTZ;default:CURRENT_TIMESTAMP" json:"updated_at"`
    
    // 关联关系
    // Video 视频作品信息，外键关联videos表
    Video *Video `gorm:"foreignKey:VideoID;references:ID" json:"video,omitempty"`
}
```

### 4. 定义模型方法

为VideoSeason模型添加常用的辅助方法：

```go
// IsPublished 检查分季是否已发布
func (vs *VideoSeason) IsPublished() bool {
    return vs.Status == "published"
}

// ValidateStatus 验证状态值是否有效
func (vs *VideoSeason) ValidateStatus() bool {
    validStatuses := []string{"draft", "published", "archived"}
    for _, validStatus := range validStatuses {
        if vs.Status == validStatus {
            return true
        }
    }
    return false
}
```

### 5. 注意事项

- **字段类型映射**：确保GORM标签中的类型与PostgreSQL数据库类型一致
- **索引定义**：在GORM标签中定义索引，包括video_id、sort_order、status，以及复合索引 (video_id, sort_order)
- **外键关联**：使用GORM的foreignKey和references标签定义与Video的关联关系
- **JSON标签**：所有字段都应有JSON标签，可选字段使用omitempty
- **指针类型**：可选字段（如Description）使用指针类型，支持NULL值
- **时间字段**：使用time.Time类型，支持PostgreSQL的TIMESTAMPTZ类型
- **默认值**：在GORM标签中设置默认值，与数据库设计保持一致
- **检查约束**：status字段需要在应用层进行验证，确保符合数据库约束
- **排序字段**：sort_order用于控制分季的显示顺序

## 验收标准

1. **模型结构完整**
   - VideoSeason模型包含所有必需字段
   - 字段类型与数据库设计一致
   - GORM标签正确配置

2. **索引定义正确**
   - 普通索引：video_id、sort_order、status
   - 复合索引：video_id + sort_order
   - 索引名称与数据库设计一致

3. **关联关系正确**
   - Video外键关联关系正确

4. **模型方法完整**
   - IsPublished方法实现正确
   - ValidateStatus方法实现正确

5. **注释完整**
   - 模型注释使用中文
   - 字段注释使用中文
   - 方法注释使用中文

6. **代码规范**
   - 遵循Golang编码规范
   - 遵循GORM最佳实践
   - 错误消息使用中文（如适用）

## 相关文件

- `docs/TASKS/TASK002/` - 视频分季表数据库设计文档
- `docs/TASKS/TASK007/TASK007-15.md` - Video模型实现参考
- `.cursor/rules/coding-standards.mdc` - Golang编码规范
- `.cursor/rules/database.mdc` - PostgreSQL数据库设计规范
- `internal/models/video_season.go` - VideoSeason模型文件（待创建）

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-03 23:05:05 CST

