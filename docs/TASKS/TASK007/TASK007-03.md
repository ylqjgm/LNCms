# TASK007-03: 创建Tag模型

## 任务信息

**任务编号**: TASK007-03  
**父任务**: TASK007  
**任务名称**: 创建Tag模型  
**版本信息**: v1.2.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 22:52:51 CST

## 任务描述

创建标签管理的GORM模型，定义标签表结构。包括：1) 创建Tag模型，定义字段（包含tag_name、tag_description、is_active等）；2) 添加模型标签和索引定义；3) 添加表注释和字段注释。所有代码必须遵循Golang编码规范。标签为简单结构，不支持树形。

## 依赖任务

无

## 实现指南

### 1. 参考数据库设计文档

阅读 `docs/TASKS/TASK002/TASK002-18.md` 文档，了解tags表的完整设计：
- 表结构：id、tag_name、tag_description、is_active、created_at、updated_at
- 唯一约束：tag_name 必须唯一
- 索引：tag_name（唯一索引）、is_active

### 2. 创建Tag模型文件

在 `internal/models/` 目录下创建 `tag.go` 文件，定义Tag模型：

```go
package models

import (
    "time"
    "gorm.io/gorm"
)

// Tag 标签模型
// 存储内容标签信息，标签为通用标签，可用于小说、漫画、音频、视频等多种内容类型
// 标签为简单结构，不支持树形结构
type Tag struct {
    ID              int64          `gorm:"primaryKey;column:id;type:BIGSERIAL" json:"id"`
    TagName         string         `gorm:"column:tag_name;type:VARCHAR(100);not null;uniqueIndex:uk_tags_tag_name" json:"tag_name"`
    TagDescription  *string        `gorm:"column:tag_description;type:TEXT" json:"tag_description,omitempty"`
    IsActive        bool           `gorm:"column:is_active;type:BOOLEAN;default:true;index:idx_tags_is_active" json:"is_active"`
    CreatedAt       time.Time      `gorm:"column:created_at;type:TIMESTAMPTZ;default:CURRENT_TIMESTAMP" json:"created_at"`
    UpdatedAt       time.Time      `gorm:"column:updated_at;type:TIMESTAMPTZ;default:CURRENT_TIMESTAMP" json:"updated_at"`
}

// TableName 指定表名
func (Tag) TableName() string {
    return "tags"
}

// BeforeCreate 创建前钩子
func (t *Tag) BeforeCreate(tx *gorm.DB) error {
    now := time.Now()
    if t.CreatedAt.IsZero() {
        t.CreatedAt = now
    }
    if t.UpdatedAt.IsZero() {
        t.UpdatedAt = now
    }
    return nil
}

// BeforeUpdate 更新前钩子
func (t *Tag) BeforeUpdate(tx *gorm.DB) error {
    t.UpdatedAt = time.Now()
    return nil
}
```

### 3. 添加模型注释

在模型文件中添加详细的中文注释，说明每个字段的用途：

```go
// Tag 标签模型
// 存储内容标签信息，标签为通用标签，可用于小说、漫画、音频、视频等多种内容类型
// 标签为简单结构，不支持树形结构
type Tag struct {
    // ID 标签ID，自增主键
    ID int64 `gorm:"primaryKey;column:id;type:BIGSERIAL" json:"id"`
    
    // TagName 标签名称，唯一标识符，必填字段，必须唯一
    TagName string `gorm:"column:tag_name;type:VARCHAR(100);not null;uniqueIndex:uk_tags_tag_name" json:"tag_name"`
    
    // TagDescription 标签描述，说明标签的用途和含义，可选字段
    TagDescription *string `gorm:"column:tag_description;type:TEXT" json:"tag_description,omitempty"`
    
    // IsActive 是否启用，TRUE-启用，FALSE-禁用，默认值为TRUE
    IsActive bool `gorm:"column:is_active;type:BOOLEAN;default:true;index:idx_tags_is_active" json:"is_active"`
    
    // CreatedAt 创建时间，自动设置为当前时间
    CreatedAt time.Time `gorm:"column:created_at;type:TIMESTAMPTZ;default:CURRENT_TIMESTAMP" json:"created_at"`
    
    // UpdatedAt 更新时间，每次更新时自动更新
    UpdatedAt time.Time `gorm:"column:updated_at;type:TIMESTAMPTZ;default:CURRENT_TIMESTAMP" json:"updated_at"`
}
```

### 4. 定义模型方法

为Tag模型添加常用的辅助方法：

```go
// IsValid 检查标签是否有效（启用状态）
func (t *Tag) IsValid() bool {
    return t.IsActive
}

// HasDescription 检查是否有标签描述
func (t *Tag) HasDescription() bool {
    return t.TagDescription != nil && *t.TagDescription != ""
}
```

### 5. 注意事项

- **字段类型映射**：确保GORM标签中的类型与PostgreSQL数据库类型一致
- **唯一索引**：tag_name字段使用uniqueIndex标签定义唯一索引
- **索引定义**：在GORM标签中定义索引，包括唯一索引和普通索引
- **JSON标签**：所有字段都应有JSON标签，可选字段使用omitempty
- **指针类型**：可选字段（如TagDescription）使用指针类型，支持NULL值
- **时间字段**：使用time.Time类型，支持PostgreSQL的TIMESTAMPTZ类型
- **默认值**：在GORM标签中设置默认值，与数据库设计保持一致
- **简单结构**：标签不支持树形结构，没有parent_id字段

## 验收标准

1. **模型结构完整**
   - Tag模型包含所有必需字段
   - 字段类型与数据库设计一致
   - GORM标签正确配置

2. **索引定义正确**
   - 唯一索引：tag_name
   - 普通索引：is_active
   - 索引名称与数据库设计一致

3. **唯一约束正确**
   - tag_name字段使用uniqueIndex标签，确保唯一性

4. **模型方法完整**
   - IsValid方法实现正确
   - HasDescription方法实现正确

5. **注释完整**
   - 模型注释使用中文
   - 字段注释使用中文
   - 方法注释使用中文

6. **代码规范**
   - 遵循Golang编码规范
   - 遵循GORM最佳实践
   - 错误消息使用中文（如适用）

## 相关文件

- `docs/TASKS/TASK002/TASK002-18.md` - 标签表数据库设计文档
- `docs/TASKS/TASK007/TASK007-01.md` - Category模型实现参考
- `.cursor/rules/coding-standards.mdc` - Golang编码规范
- `.cursor/rules/database.mdc` - PostgreSQL数据库设计规范
- `internal/models/tag.go` - Tag模型文件（待创建）

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-03 22:52:51 CST

