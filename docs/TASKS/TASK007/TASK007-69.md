# TASK007-69: 创建VideoHandler接口和实现 - 创建、更新和删除API

## 任务信息

**任务编号**: TASK007-69  
**父任务**: TASK007  
**任务名称**: 创建VideoHandler接口和实现 - 创建、更新和删除API  
**版本信息**: v1.2.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-04 00:01:47 CST

## 任务描述

扩展视频控制器，提供视频创建、更新、状态管理和删除的HTTP API处理。包括：1) 扩展VideoHandler接口；2) 实现CreateVideo、UpdateVideo、UpdateVideoStatus、DeleteVideo方法；3) 调用VideoService；4) 格式化响应（Envelope格式）。所有代码必须遵循API设计规范。

## 依赖任务

TASK007-68（创建VideoHandler接口和实现 - 列表和详情API）、TASK007-51（创建VideoService接口和实现 - 基础CRUD）、TASK007-52（创建VideoService接口和实现 - 状态和时长管理）

## 实现指南

### 1. 扩展VideoHandler接口

在 `internal/handler/video_handler.go` 文件中扩展VideoHandler接口：

```go
// VideoHandler 视频控制器接口
// 提供视频管理的HTTP API处理
type VideoHandler interface {
    // GetVideos 获取视频列表（支持分页、筛选、排序）
    GetVideos(c *gin.Context)
    
    // GetVideo 根据ID获取视频
    GetVideo(c *gin.Context)
    
    // CreateVideo 创建视频（需要作者或管理员权限）
    CreateVideo(c *gin.Context)
    
    // UpdateVideo 更新视频（需要作者或管理员权限）
    UpdateVideo(c *gin.Context)
    
    // UpdateVideoStatus 更新视频状态（需要作者或管理员权限）
    UpdateVideoStatus(c *gin.Context)
    
    // DeleteVideo 删除视频（需要作者或管理员权限）
    DeleteVideo(c *gin.Context)
}
```

### 2. 定义请求结构体

在同一个文件中添加请求结构体：

```go
// CreateVideoRequest 创建视频请求
type CreateVideoRequest struct {
    Title        string   `json:"title" binding:"required"`
    Description  *string  `json:"description,omitempty"`
    AuthorID     int64    `json:"author_id" binding:"required"`
    CategoryIDs  []int64  `json:"category_ids,omitempty"`
    RegionID     *int64   `json:"region_id,omitempty"`
    TagIDs       []int64  `json:"tag_ids,omitempty"`
    CoverURL     *string  `json:"cover_url,omitempty"`
    Status       string   `json:"status"`
    SerialStatus string   `json:"serial_status"`
    Rating       float64  `json:"rating"`
    IsActive     *bool    `json:"is_active"`
}

// UpdateVideoRequest 更新视频请求
type UpdateVideoRequest struct {
    Title        string   `json:"title" binding:"required"`
    Description  *string  `json:"description,omitempty"`
    AuthorID     int64    `json:"author_id" binding:"required"`
    CategoryIDs  []int64  `json:"category_ids,omitempty"`
    RegionID     *int64   `json:"region_id,omitempty"`
    TagIDs       []int64  `json:"tag_ids,omitempty"`
    CoverURL     *string  `json:"cover_url,omitempty"`
    Status       string   `json:"status"`
    SerialStatus string   `json:"serial_status"`
    Rating       float64  `json:"rating"`
    IsActive     *bool    `json:"is_active"`
}

// UpdateVideoStatusRequest 更新视频状态请求
type UpdateVideoStatusRequest struct {
    Status string `json:"status" binding:"required"`
}
```

### 3. 实现CreateVideo、UpdateVideo、UpdateVideoStatus、DeleteVideo方法

参考ComicHandler的实现方式，实现视频的创建、更新、状态管理和删除方法。实现逻辑与ComicHandler类似，但调用VideoService的方法。

### 4. 添加必要的导入

确保文件包含以下导入：

```go
package handler

import (
    "errors"
    "fmt"
    "net/http"
    "strconv"
    
    "github.com/gin-gonic/gin"
    
    "yourproject/internal/models"
    "yourproject/internal/repository"
    "yourproject/internal/response"
    "yourproject/internal/service"
)
```

### 5. 注意事项

- **API规范**：所有API必须遵循OpenAPI 3.1.1规范
- **响应格式**：所有响应必须使用Envelope格式
- **权限验证**：创建、更新、删除操作需要作者或管理员权限（参考NovelHandler的实现）
- **资源权限**：作者只能操作自己的视频，管理员可以操作所有视频
- **参数验证**：使用Gin的binding进行请求参数验证
- **错误处理**：所有错误消息必须使用中文
- **JWT认证**：从JWT token中获取用户ID和角色信息

## 验收标准

1. **接口扩展完整**
   - VideoHandler接口包含CreateVideo、UpdateVideo、UpdateVideoStatus和DeleteVideo方法
   - 方法签名正确

2. **请求处理完整**
   - CreateVideo方法正确创建视频
   - UpdateVideo方法正确更新视频
   - UpdateVideoStatus方法正确更新视频状态
   - DeleteVideo方法正确删除视频
   - 权限验证正确

3. **权限控制**
   - 创建操作需要作者或管理员权限
   - 更新操作需要作者或管理员权限
   - 状态更新操作需要作者或管理员权限
   - 删除操作需要作者或管理员权限
   - 作者只能操作自己的视频
   - 管理员可以操作所有视频

4. **响应格式**
   - 所有响应使用Envelope格式
   - 成功响应格式正确
   - 错误响应格式正确

5. **错误处理**
   - 所有错误消息使用中文
   - HTTP状态码使用正确
   - 错误代码定义清晰

6. **代码规范**
   - 遵循Golang编码规范
   - 遵循API设计规范
   - 代码注释完整（使用中文）

## 相关文件

- `docs/TASKS/TASK007/TASK007-68.md` - VideoHandler列表和详情API实现文档
- `docs/TASKS/TASK007/TASK007-51.md` - VideoService实现文档
- `docs/TASKS/TASK007/TASK007-52.md` - VideoService状态和时长管理实现文档
- `docs/TASKS/TASK007/TASK007-63.md` - ComicHandler创建和更新API实现参考
- `.cursor/rules/api-design.mdc` - API设计规范
- `.cursor/rules/coding-standards.mdc` - Golang编码规范
- `internal/handler/video_handler.go` - VideoHandler接口和实现文件（待扩展）

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-04 00:01:47 CST

