# TASK003-70: 实现检查模块健康状态API（GET）

## 任务信息

**任务编号**: TASK003-70  
**父任务**: TASK003  
**任务名称**: 实现检查模块健康状态API（GET）  
**版本信息**: v2.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 14:22:42 CST

## 任务描述

实现检查模块健康状态API接口。包括：1) 实现 GET /api/v1/modules/{module_id}/health 端点；2) 实现请求处理和响应构建；3) 遵循OpenAPI 3.1.1规范和Envelope响应格式。所有错误消息必须使用中文。

## 依赖任务

- TASK003-59: 编写模块健康检查单元测试

## 实现指南

### 1. 定义响应结构体

在 `internal/api/v1/dto/module_dto.go` 文件中定义健康状态响应结构体：

```go
// ModuleHealthResponse 模块健康状态响应
type ModuleHealthResponse struct {
    ModuleID    string `json:"module_id"`     // 模块ID
    Status      string `json:"status"`        // 健康状态（SERVING/NOT_SERVING/UNKNOWN）
    CheckedAt   string `json:"checked_at"`     // 检查时间
}
```

### 2. 实现CheckModuleHealth方法

在 `internal/api/v1/handler/module_handler.go` 文件中实现CheckModuleHealth方法：

```go
// CheckModuleHealth 检查模块健康状态
// @Summary 检查模块健康状态
// @Description 检查指定模块的健康状态
// @Tags 模块管理
// @Accept json
// @Produce json
// @Param module_id path string true "模块ID"
// @Success 200 {object} response.Envelope{data=dto.ModuleHealthResponse} "成功响应"
// @Failure 404 {object} response.Envelope "模块不存在"
// @Failure 500 {object} response.Envelope "服务器错误"
// @Router /api/v1/modules/{module_id}/health [get]
func (h *ModuleHandler) CheckModuleHealth(c *gin.Context) {
    ctx := c.Request.Context()
    moduleID := c.Param("module_id")
    
    if moduleID == "" {
        response.Error(c, http.StatusBadRequest, "INVALID_PARAM", "模块ID不能为空", nil)
        return
    }
    
    // 从服务层检查模块健康状态
    status, err := h.moduleService.CheckModuleHealth(ctx, moduleID)
    if err != nil {
        if errors.Is(err, repository.ErrNotFound) {
            response.Error(c, http.StatusNotFound, "MODULE_NOT_FOUND", "模块不存在", err)
            return
        }
        response.Error(c, http.StatusInternalServerError, "HEALTH_CHECK_FAILED", "检查模块健康状态失败", err)
        return
    }
    
    // 转换为响应结构体
    healthResp := dto.ModuleHealthResponse{
        ModuleID:  moduleID,
        Status:    status.String(),
        CheckedAt: time.Now().Format("2006-01-02 15:04:05"),
    }
    
    // 返回成功响应
    response.Success(c, healthResp)
}
```

### 3. 注册路由

在 `internal/api/v1/router/router.go` 文件中注册路由：

```go
// RegisterModuleRoutes 注册模块相关路由
func RegisterModuleRoutes(r *gin.RouterGroup, moduleHandler *handler.ModuleHandler) {
    modules := r.Group("/modules")
    {
        modules.GET("", moduleHandler.GetModuleList)
        modules.GET("/:module_id", moduleHandler.GetModuleDetail)
        modules.POST("", moduleHandler.RegisterModule)
        modules.PUT("/:module_id/enable", moduleHandler.EnableModule)
        modules.PUT("/:module_id/disable", moduleHandler.DisableModule)
        modules.GET("/:module_id/health", moduleHandler.CheckModuleHealth)
    }
}
```

## 验收标准

1. **API端点正确实现**
   - GET /api/v1/modules/{module_id}/health 端点正确实现
   - 路由正确注册

2. **响应格式符合要求**
   - 响应使用Envelope格式
   - data字段包含ModuleHealthResponse结构体

3. **错误处理正确**
   - 模块ID为空时返回400错误
   - 模块不存在时返回404错误
   - 所有错误消息使用中文

4. **代码规范符合要求**
   - 代码通过golangci-lint检查，无错误和警告
   - 代码注释完整，使用中文
   - 遵循Golang编码规范和API设计规范

## 相关文件

- `internal/api/v1/handler/module_handler.go` - 模块处理器实现
- `internal/api/v1/dto/module_dto.go` - 模块DTO定义
- `internal/api/v1/router/router.go` - 路由注册
- `internal/pkg/service/module_service.go` - ModuleService接口和实现
- `docs/Requirements/Core.md` - 核心模块需求文档
- `.cursor/rules/api.mdc` - API设计规范
- `.cursor/rules/golang.mdc` - Golang编码规范

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 2.0.0  
**最后更新**: 2026-01-03 14:22:42 CST

