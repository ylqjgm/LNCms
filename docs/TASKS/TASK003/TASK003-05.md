# TASK003-05: 模块管理数据库模型和仓储层实现

## 任务信息

**任务编号**: TASK003-05  
**父任务**: TASK003  
**任务名称**: 模块管理数据库模型和仓储层实现  
**版本信息**: v1.1.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 21:30:48 CST

## 任务描述

创建模块管理的GORM模型和仓储层实现。包括：1) 创建Module模型，定义模块表结构（id、module_id、module_name、module_type、module_url、module_status、health_check_url、config_data、last_health_check、created_at、updated_at）；2) 实现ModuleRepository接口，提供模块的CRUD操作（Create、GetByID、GetByModuleID、List、Update、Delete）；3) 实现模块类型和状态枚举定义；4) 编写单元测试验证仓储层功能。所有代码必须遵循Golang编码规范和PostgreSQL数据库设计规范。

## 依赖任务

无

## 实现指南

### 1. 创建Module模型

在 `internal/pkg/model/module.go` 文件中创建Module结构体：

```go
package model

import (
    "time"
    "gorm.io/datatypes"
)

// ModuleType 模块类型
type ModuleType string

const (
    ModuleTypeStorage ModuleType = "storage"
    ModuleTypeLog     ModuleType = "log"
    ModuleTypeCrawler ModuleType = "crawler"
)

// ModuleStatus 模块状态
type ModuleStatus string

const (
    ModuleStatusActive   ModuleStatus = "active"
    ModuleStatusInactive ModuleStatus = "inactive"
)

// Module 模块模型
type Module struct {
    ID              int64          `gorm:"primaryKey;autoIncrement" json:"id"`
    ModuleID        string         `gorm:"type:varchar(100);not null;uniqueIndex:uk_modules_module_id" json:"module_id"`
    ModuleName      string         `gorm:"type:varchar(100);not null" json:"module_name"`
    ModuleType      ModuleType     `gorm:"type:varchar(50);not null" json:"module_type"`
    ModuleURL       string         `gorm:"type:varchar(500);not null" json:"module_url"`
    ModuleStatus    ModuleStatus   `gorm:"type:varchar(20);default:'inactive'" json:"module_status"`
    HealthCheckURL  *string        `gorm:"type:varchar(500)" json:"health_check_url,omitempty"`
    ConfigData      datatypes.JSON `gorm:"type:jsonb" json:"config_data,omitempty"`
    LastHealthCheck *time.Time     `gorm:"type:timestamptz" json:"last_health_check,omitempty"`
    CreatedAt       time.Time      `gorm:"type:timestamptz;default:current_timestamp" json:"created_at"`
    UpdatedAt       time.Time      `gorm:"type:timestamptz;default:current_timestamp" json:"updated_at"`
}

// TableName 指定表名
func (Module) TableName() string {
    return "modules"
}
```

### 2. 创建ModuleRepository接口

在 `internal/pkg/repository/module_repository.go` 文件中定义接口和实现：

```go
package repository

import (
    "context"
    "yourproject/internal/pkg/model"
)

// ModuleRepository 模块仓储接口
type ModuleRepository interface {
    // Create 创建模块
    Create(ctx context.Context, module *model.Module) error
    
    // GetByID 根据ID获取模块
    GetByID(ctx context.Context, id int64) (*model.Module, error)
    
    // GetByModuleID 根据模块ID获取模块
    GetByModuleID(ctx context.Context, moduleID string) (*model.Module, error)
    
    // List 获取模块列表（支持分页）
    List(ctx context.Context, page, limit int) ([]*model.Module, int64, error)
    
    // Update 更新模块
    Update(ctx context.Context, module *model.Module) error
    
    // Delete 删除模块
    Delete(ctx context.Context, id int64) error
}
```

## 验收标准

1. Module模型正确定义，包含所有必需字段和GORM标签
2. ModuleRepository接口完整实现，支持所有CRUD操作和分页查询
3. 单元测试通过，覆盖所有仓储层方法
4. 代码通过golangci-lint检查
5. 代码注释完整，使用中文

## 相关文件

- `internal/pkg/model/module.go` - 模块模型定义
- `internal/pkg/repository/module_repository.go` - 模块仓储层实现
- `internal/pkg/repository/module_repository_test.go` - 模块仓储层单元测试
- `docs/Requirements/Core.md` - 核心模块需求文档

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 21:30:48 CST

