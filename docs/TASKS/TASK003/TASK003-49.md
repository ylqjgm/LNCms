# TASK003-49: 创建Module模型

## 任务信息

**任务编号**: TASK003-49  
**父任务**: TASK003  
**任务名称**: 创建Module模型  
**版本信息**: v2.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-03 14:06:02 CST

## 任务描述

创建模块管理的GORM模型，定义模块表结构。包括：1) 创建Module模型，定义字段（id、module_id、module_name、module_type、module_url、module_status、health_check_url、config_data、last_health_check、created_at、updated_at）；2) 添加模型标签和索引定义；3) 添加表注释。所有代码必须遵循Golang编码规范和PostgreSQL数据库设计规范。

## 依赖任务

无

## 实现指南

### 1. 创建Module模型

在 `internal/pkg/model/module.go` 文件中创建Module结构体：

```go
package model

import (
    "time"
    "gorm.io/datatypes"
)

// Module 模块模型
type Module struct {
    ID              int64          `gorm:"primaryKey;autoIncrement" json:"id"`
    ModuleID        string         `gorm:"type:varchar(100);not null;uniqueIndex:uk_modules_module_id" json:"module_id"`
    ModuleName      string         `gorm:"type:varchar(200);not null" json:"module_name"`
    ModuleType      string         `gorm:"type:varchar(50);not null;index:idx_modules_module_type" json:"module_type"`
    ModuleURL       string         `gorm:"type:varchar(500);not null" json:"module_url"`
    ModuleStatus    string         `gorm:"type:varchar(20);not null;default:'inactive';index:idx_modules_module_status" json:"module_status"`
    HealthCheckURL  string         `gorm:"type:varchar(500)" json:"health_check_url"`
    ConfigData      datatypes.JSON `gorm:"type:jsonb" json:"config_data"`
    LastHealthCheck *time.Time     `gorm:"type:timestamptz" json:"last_health_check"`
    CreatedAt       time.Time      `gorm:"type:timestamptz;default:current_timestamp" json:"created_at"`
    UpdatedAt       time.Time      `gorm:"type:timestamptz;default:current_timestamp" json:"updated_at"`
}

// TableName 指定表名
func (Module) TableName() string {
    return "modules"
}
```

### 2. 添加模型注释

在模型定义后添加注释说明：

```go
// Module 模块模型
// 用于存储系统模块信息，包括模块标识、名称、类型、URL、状态、健康检查URL、配置数据等
// 表名: modules
// 索引:
//   - uk_modules_module_id (module_id字段唯一索引)
//   - idx_modules_module_type (module_type字段索引)
//   - idx_modules_module_status (module_status字段索引)
type Module struct {
    // ID 主键，自增
    ID int64 `gorm:"primaryKey;autoIncrement" json:"id"`
    
    // ModuleID 模块标识，唯一索引，用于标识模块
    ModuleID string `gorm:"type:varchar(100);not null;uniqueIndex:uk_modules_module_id" json:"module_id"`
    
    // ModuleName 模块名称
    ModuleName string `gorm:"type:varchar(200);not null" json:"module_name"`
    
    // ModuleType 模块类型，索引，用于分类查询
    ModuleType string `gorm:"type:varchar(50);not null;index:idx_modules_module_type" json:"module_type"`
    
    // ModuleURL 模块URL地址
    ModuleURL string `gorm:"type:varchar(500);not null" json:"module_url"`
    
    // ModuleStatus 模块状态，索引，默认值为inactive
    ModuleStatus string `gorm:"type:varchar(20);not null;default:'inactive';index:idx_modules_module_status" json:"module_status"`
    
    // HealthCheckURL 健康检查URL地址
    HealthCheckURL string `gorm:"type:varchar(500)" json:"health_check_url"`
    
    // ConfigData 配置数据，JSONB格式，存储模块的配置信息
    ConfigData datatypes.JSON `gorm:"type:jsonb" json:"config_data"`
    
    // LastHealthCheck 最后健康检查时间
    LastHealthCheck *time.Time `gorm:"type:timestamptz" json:"last_health_check"`
    
    // CreatedAt 创建时间，自动设置为当前时间
    CreatedAt time.Time `gorm:"type:timestamptz;default:current_timestamp" json:"created_at"`
    
    // UpdatedAt 更新时间，自动设置为当前时间
    UpdatedAt time.Time `gorm:"type:timestamptz;default:current_timestamp" json:"updated_at"`
}
```

### 3. 验证模型定义

确保模型定义符合以下要求：

- 主键字段使用 `bigserial` 类型（GORM会自动映射）
- 字符串字段使用 `varchar` 类型，设置合适的长度限制
- JSON字段使用 `jsonb` 类型
- 时间字段使用 `timestamptz` 类型
- 唯一索引使用 `uniqueIndex` 标签
- 普通索引使用 `index` 标签
- 所有字段都有JSON标签

### 4. 数据库迁移脚本（参考）

虽然此任务不要求创建迁移脚本，但可以参考以下SQL语句进行数据库表创建：

```sql
CREATE TABLE modules (
    id BIGSERIAL PRIMARY KEY,
    module_id VARCHAR(100) NOT NULL,
    module_name VARCHAR(200) NOT NULL,
    module_type VARCHAR(50) NOT NULL,
    module_url VARCHAR(500) NOT NULL,
    module_status VARCHAR(20) NOT NULL DEFAULT 'inactive',
    health_check_url VARCHAR(500),
    config_data JSONB,
    last_health_check TIMESTAMPTZ,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uk_modules_module_id UNIQUE (module_id)
);

CREATE INDEX idx_modules_module_type ON modules(module_type);
CREATE INDEX idx_modules_module_status ON modules(module_status);

COMMENT ON TABLE modules IS '模块管理表，存储系统模块信息';
COMMENT ON COLUMN modules.id IS '主键，自增';
COMMENT ON COLUMN modules.module_id IS '模块标识，唯一';
COMMENT ON COLUMN modules.module_name IS '模块名称';
COMMENT ON COLUMN modules.module_type IS '模块类型';
COMMENT ON COLUMN modules.module_url IS '模块URL地址';
COMMENT ON COLUMN modules.module_status IS '模块状态：active、inactive';
COMMENT ON COLUMN modules.health_check_url IS '健康检查URL地址';
COMMENT ON COLUMN modules.config_data IS '配置数据，JSONB格式';
COMMENT ON COLUMN modules.last_health_check IS '最后健康检查时间';
COMMENT ON COLUMN modules.created_at IS '创建时间';
COMMENT ON COLUMN modules.updated_at IS '更新时间';
```

## 验收标准

1. **模型定义正确**
   - Module模型正确创建
   - 所有字段定义正确
   - 字段类型符合PostgreSQL数据库设计规范

2. **索引定义正确**
   - 主键索引正确（GORM自动创建）
   - 唯一索引正确（module_id字段）
   - 普通索引正确（module_type、module_status字段）

3. **GORM标签正确**
   - 所有字段都有正确的GORM标签
   - JSON标签正确
   - 字段约束正确（NOT NULL、DEFAULT等）

4. **代码规范符合要求**
   - 代码通过golangci-lint检查，无错误和警告
   - 代码注释完整，使用中文
   - 遵循Golang编码规范
   - 遵循PostgreSQL数据库设计规范

## 相关文件

- `internal/pkg/model/module.go` - Module模型定义
- `docs/Requirements/Core.md` - 核心模块需求文档
- `.cursor/rules/golang.mdc` - Golang编码规范
- `.cursor/rules/database.mdc` - PostgreSQL数据库设计规范

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 2.0.0  
**最后更新**: 2026-01-03 14:06:02 CST

