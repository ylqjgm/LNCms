# TASK001-33: 实现请求ID中间件

## 任务信息

**任务编号**: TASK001-33  
**父任务**: TASK001  
**任务名称**: 实现请求ID中间件  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 21:44:12 CST

## 任务描述

实现请求ID中间件，为每个HTTP请求生成唯一的请求ID（UUID），将请求ID设置到响应头和context中，便于请求追踪和日志关联。

## 依赖任务

- TASK001-02: 初始化Go模块和依赖管理

## 实现指南

### 1. 创建请求ID中间件文件

创建 `internal/http/middleware/request_id.go` 文件，实现请求ID中间件。

### 2. 实现RequestIDMiddleware函数

实现 `RequestIDMiddleware` 函数：

```go
// RequestIDMiddleware 请求ID中间件
func RequestIDMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        // 从请求头获取X-Request-ID（如果存在）
        requestID := c.GetHeader("X-Request-ID")
        
        // 如果不存在，生成新的UUID
        if requestID == "" {
            requestID = uuid.New().String()
        }
        
        // 将请求ID设置到context中
        c.Set("request_id", requestID)
        
        // 将请求ID设置到响应头
        c.Header("X-Request-ID", requestID)
        
        // 继续处理请求
        c.Next()
    }
}
```

### 3. 从请求头获取X-Request-ID

从请求头获取X-Request-ID（如果存在），支持分布式追踪。

### 4. 生成新的UUID

如果请求头中不存在请求ID，生成新的UUID v4格式的请求ID。

### 5. 将请求ID设置到context中

将请求ID设置到context中（c.Set），供后续中间件和处理器使用。

### 6. 将请求ID设置到响应头

将请求ID设置到响应头（X-Request-ID），便于客户端追踪请求。

### 7. 使用github.com/google/uuid生成UUID

使用github.com/google/uuid生成UUID v4格式的请求ID。

### 8. 调用c.Next()继续处理请求

调用c.Next()继续处理请求，确保请求流程正常进行。

## 验收标准

1. **可以为每个请求生成唯一的请求ID**
   - 每个请求都有唯一的请求ID
   - 请求ID格式正确（UUID v4）

2. **请求ID可以正确设置到context和响应头**
   - context中可以正确获取请求ID
   - 响应头中包含X-Request-ID
   - 请求ID值一致

3. **请求ID格式正确（UUID v4）**
   - 请求ID符合UUID v4格式
   - 请求ID唯一性保证

4. **支持从请求头获取请求ID**
   - 如果请求头中存在X-Request-ID，复用该ID
   - 支持分布式追踪场景

## 相关文件

- `internal/http/middleware/request_id.go` - 请求ID中间件实现文件

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 21:44:12 CST

