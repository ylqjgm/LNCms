# TASK001-03: 定义配置结构体

## 任务信息

**任务编号**: TASK001-03  
**父任务**: TASK001  
**任务名称**: 定义配置结构体  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 21:44:12 CST

## 任务描述

定义所有配置项的结构体，包括服务器配置、数据库配置、Redis配置、Elasticsearch配置、日志配置等。所有配置结构体应包含适当的标签和注释。

## 依赖任务

- TASK001-02: 初始化Go模块和依赖管理

## 实现指南

### 1. 创建配置结构体文件

创建 `internal/config/config.go` 文件，定义所有配置结构体。

### 2. 定义ServerConfig结构体

定义服务器配置结构体：

```go
// ServerConfig 服务器配置
type ServerConfig struct {
    HTTPPort int    `mapstructure:"http_port" json:"http_port"`     // HTTP端口
    GRPCPort int    `mapstructure:"grpc_port" json:"grpc_port"`     // gRPC端口
    Mode     string `mapstructure:"mode" json:"mode"`                // 运行模式：dev、test、prod
}
```

### 3. 定义DatabaseConfig结构体

定义数据库配置结构体：

```go
// DatabaseConfig 数据库配置
type DatabaseConfig struct {
    Host            string        `mapstructure:"host" json:"host"`                         // 数据库主机
    Port            int           `mapstructure:"port" json:"port"`                         // 数据库端口
    User            string        `mapstructure:"user" json:"user"`                         // 数据库用户名
    Password        string        `mapstructure:"password" json:"password"`                 // 数据库密码
    Database        string        `mapstructure:"database" json:"database"`                // 数据库名称
    MaxOpenConns    int           `mapstructure:"max_open_conns" json:"max_open_conns"`     // 最大打开连接数
    MaxIdleConns    int           `mapstructure:"max_idle_conns" json:"max_idle_conns"`     // 最大空闲连接数
    ConnMaxLifetime time.Duration `mapstructure:"conn_max_lifetime" json:"conn_max_lifetime"` // 连接最大生存时间
}
```

### 4. 定义RedisConfig结构体

定义Redis配置结构体：

```go
// RedisConfig Redis配置
type RedisConfig struct {
    Host     string `mapstructure:"host" json:"host"`         // Redis主机
    Port     int    `mapstructure:"port" json:"port"`        // Redis端口
    Password string `mapstructure:"password" json:"password"` // Redis密码
    DB       int    `mapstructure:"db" json:"db"`             // 数据库编号
    PoolSize int    `mapstructure:"pool_size" json:"pool_size"` // 连接池大小
}
```

### 5. 定义ElasticsearchConfig结构体

定义Elasticsearch配置结构体：

```go
// ElasticsearchConfig Elasticsearch配置
type ElasticsearchConfig struct {
    URLs        []string `mapstructure:"urls" json:"urls"`               // Elasticsearch URL列表
    Username    string   `mapstructure:"username" json:"username"`       // 用户名
    Password    string   `mapstructure:"password" json:"password"`       // 密码
    IndexPrefix string   `mapstructure:"index_prefix" json:"index_prefix"` // 索引前缀
}
```

### 6. 定义LogConfig结构体

定义日志配置结构体：

```go
// LogConfig 日志配置
type LogConfig struct {
    Level  string `mapstructure:"level" json:"level"`   // 日志级别：debug、info、warn、error
    Output string `mapstructure:"output" json:"output"` // 输出方式：stdout、file
    Path   string `mapstructure:"path" json:"path"`     // 日志文件路径
    Format string `mapstructure:"format" json:"format"` // 日志格式：json、text
}
```

### 7. 定义Config根结构体

定义根配置结构体，包含所有子配置：

```go
// Config 应用配置
type Config struct {
    Server       ServerConfig       `mapstructure:"server" json:"server"`
    Database     DatabaseConfig     `mapstructure:"database" json:"database"`
    Redis        RedisConfig        `mapstructure:"redis" json:"redis"`
    Elasticsearch ElasticsearchConfig `mapstructure:"elasticsearch" json:"elasticsearch"`
    Log          LogConfig          `mapstructure:"log" json:"log"`
}
```

### 8. 添加结构体标签

为所有字段添加 `mapstructure` 和 `json` 标签：
- `mapstructure` 标签用于viper配置加载
- `json` 标签用于JSON序列化

### 9. 添加中文注释

为所有结构体和字段添加中文注释，说明字段的用途和取值范围。

## 验收标准

1. **所有配置结构体已定义**
   - ServerConfig结构体已定义
   - DatabaseConfig结构体已定义
   - RedisConfig结构体已定义
   - ElasticsearchConfig结构体已定义
   - LogConfig结构体已定义
   - Config根结构体已定义

2. **结构体字段包含适当的标签**
   - 所有字段都有mapstructure标签
   - 所有字段都有json标签
   - 标签值正确对应配置项名称

3. **所有结构体和字段都有中文注释**
   - 结构体有中文注释说明用途
   - 字段有中文注释说明含义和取值范围

4. **配置结构体可以正确序列化和反序列化**
   - 可以正确序列化为JSON
   - 可以正确从JSON反序列化
   - 可以正确从mapstructure映射

## 相关文件

- `internal/config/config.go` - 配置结构体定义文件

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 21:44:12 CST
