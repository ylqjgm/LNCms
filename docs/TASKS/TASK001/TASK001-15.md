# TASK001-15: 实现Redis连接初始化

## 任务信息

**任务编号**: TASK001-15  
**父任务**: TASK001  
**任务名称**: 实现Redis连接初始化  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 21:44:12 CST

## 任务描述

实现Redis缓存连接初始化功能，使用go-redis建立Redis连接，处理连接错误，返回可用的Redis客户端实例。

## 依赖任务

- TASK001-14: 定义Redis连接配置结构体

## 实现指南

### 1. 创建Redis连接初始化文件

创建 `internal/cache/redis.go` 文件，实现Redis连接初始化功能。

### 2. 实现NewRedis函数

实现 `NewRedis` 函数，初始化Redis连接：

```go
// NewRedis 创建Redis缓存连接
func NewRedis(config *RedisConfig) (*redis.Client, error) {
    // 构建Redis连接选项
    opts := &redis.Options{
        Addr:         fmt.Sprintf("%s:%d", config.Host, config.Port),
        Password:     config.Password,
        DB:           config.DB,
        PoolSize:     config.PoolSize,
        MinIdleConns: config.MinIdleConns,
        MaxConnAge:   config.MaxConnAge,
        DialTimeout:  config.DialTimeout,
        ReadTimeout:  config.ReadTimeout,
        WriteTimeout: config.WriteTimeout,
    }
    
    // 创建Redis客户端
    client := redis.NewClient(opts)
    
    // 测试连接
    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
    defer cancel()
    
    if err := client.Ping(ctx).Err(); err != nil {
        return nil, fmt.Errorf("Redis连接测试失败: %w", err)
    }
    
    return client, nil
}
```

### 3. 使用github.com/redis/go-redis/v9客户端

导入并使用github.com/redis/go-redis/v9客户端：

```go
import (
    "github.com/redis/go-redis/v9"
)
```

### 4. 构建Redis连接选项

构建Redis连接选项（redis.Options），包含所有配置参数。

### 5. 使用redis.NewClient创建客户端

使用redis.NewClient创建Redis客户端实例。

### 6. 处理连接错误

处理连接错误，返回清晰的错误信息（中文）：

```go
if err != nil {
    return nil, fmt.Errorf("Redis连接失败: %w", err)
}
```

### 7. 返回*redis.Client实例

返回*redis.Client实例，供后续使用。

### 8. 实现连接测试功能

实现连接测试功能（ping Redis），确保连接可用：

```go
ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
defer cancel()

if err := client.Ping(ctx).Err(); err != nil {
    return nil, fmt.Errorf("Redis连接测试失败: %w", err)
}
```

## 验收标准

1. **可以成功建立Redis连接**
   - 使用正确的连接参数
   - 连接选项配置正确
   - 连接成功建立

2. **连接错误处理正确**
   - 连接失败时返回错误
   - 错误信息清晰且使用中文
   - 错误信息包含上下文

3. **返回的Redis客户端实例可用**
   - 返回*redis.Client实例
   - 实例可以正常使用
   - 可以执行Redis操作

4. **连接测试功能正常**
   - ping Redis成功
   - 连接测试失败时返回错误
   - 错误信息清晰

## 相关文件

- `internal/cache/redis.go` - Redis连接初始化实现文件

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 21:44:12 CST

