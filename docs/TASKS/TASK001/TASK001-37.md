# TASK001-37: 初始化gRPC服务器

## 任务信息

**任务编号**: TASK001-37  
**父任务**: TASK001  
**任务名称**: 初始化gRPC服务器  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 21:44:12 CST

## 任务描述

初始化gRPC服务器，创建gRPC服务器实例，配置服务器选项（如最大接收消息大小、最大发送消息大小等），为后续服务注册做准备。

## 依赖任务

- TASK001-07: 实现配置合并逻辑

## 实现指南

### 1. 创建gRPC服务器初始化文件

创建 `internal/grpc/server.go` 文件，实现gRPC服务器初始化功能。

### 2. 实现NewGRPCServer函数

实现 `NewGRPCServer` 函数，初始化gRPC服务器：

```go
// NewGRPCServer 创建gRPC服务器
func NewGRPCServer(config *config.Config) (*grpc.Server, error) {
    // 配置服务器选项
    opts := []grpc.ServerOption{
        grpc.MaxRecvMsgSize(4 * 1024 * 1024), // 最大接收消息大小：4MB
        grpc.MaxSendMsgSize(4 * 1024 * 1024), // 最大发送消息大小：4MB
    }
    
    // 从配置读取服务器参数（如需要）
    if config.Server.GRPCMaxRecvMsgSize > 0 {
        opts = append(opts, grpc.MaxRecvMsgSize(config.Server.GRPCMaxRecvMsgSize))
    }
    
    // 创建服务器实例
    server := grpc.NewServer(opts...)
    
    return server, nil
}
```

### 3. 使用grpc.NewServer创建服务器实例

使用grpc.NewServer创建服务器实例，配置服务器选项。

### 4. 配置服务器选项

配置服务器选项（grpc.MaxRecvMsgSize、grpc.MaxSendMsgSize等）：
- 最大接收消息大小：默认4MB
- 最大发送消息大小：默认4MB
- 其他选项（如需要）

### 5. 从配置读取服务器参数

从配置读取服务器参数（如需要），支持动态配置消息大小限制。

### 6. 返回*grpc.Server实例

返回*grpc.Server实例，供后续服务注册和拦截器注册使用。

### 7. 实现服务器配置验证

实现服务器配置验证，确保配置参数有效。

## 验收标准

1. **gRPC服务器可以成功初始化**
   - 服务器实例创建成功
   - 服务器选项配置正确

2. **服务器选项配置正确**
   - 最大接收消息大小设置正确
   - 最大发送消息大小设置正确
   - 其他选项配置正确

3. **服务器配置验证正常**
   - 配置参数验证通过
   - 无效配置返回错误

4. **返回的服务器实例可用**
   - 返回*grpc.Server实例
   - 实例可以正常使用
   - 可以注册服务和拦截器

## 相关文件

- `internal/grpc/server.go` - gRPC服务器初始化实现文件

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 21:44:12 CST

