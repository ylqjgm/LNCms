# TASK001: 项目初始化和基础框架搭建

## 任务信息

**任务编号**: TASK001  
**任务名称**: 项目初始化和基础框架搭建  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 20:56:43 CST

## 任务描述

完成项目初始化工作，包括项目结构搭建、基础配置文件创建、开发环境配置、依赖管理配置等。建立Go模块、配置PostgreSQL数据库连接、配置Redis缓存连接、配置Elasticsearch全文搜索连接。搭建基础框架，包括HTTP服务器、gRPC服务器框架、中间件框架、错误处理框架等。

这是项目的基础设施任务，为后续所有任务提供基础支撑。

## 技术栈

- **开发语言**: Golang 1.24+
- **开发框架**: Gin
- **数据库**: PostgreSQL
- **缓存**: Redis
- **全文搜索**: Elasticsearch
- **API 规范**: OpenAPI 3.1.1

## 子任务列表

> **注意**: 本任务已按照"一个任务仅操作一个功能"的标准进行细化拆分。每个任务专注于一个数据库表的设计或一个功能模块的迁移脚本/初始化脚本。

任务已细化为44个独立功能任务，每个任务只完成一个独立功能点，可以独立测试和验证。任务按功能模块组织如下：

### 基础层（2个任务）

##### TASK001-01: 创建项目目录结构

**任务编号**: TASK001-01  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: 无

**任务描述**: 创建标准的Go项目目录结构，包括cmd/、internal/、pkg/、api/、config/、migrations/、scripts/、test/等目录。确保目录结构清晰，符合Go项目最佳实践。

**详细文档**: [TASK001-01.md](TASK001-01.md)

---

##### TASK001-02: 初始化Go模块和依赖管理

**任务编号**: TASK001-02  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-01

**任务描述**: 创建go.mod文件，定义模块路径，添加基础依赖包。包括Gin框架、GORM、go-redis、Elasticsearch客户端、gRPC等核心依赖。

**详细文档**: [TASK001-02.md](TASK001-02.md)

---

### 配置层（6个任务）

##### TASK001-03: 定义配置结构体

**任务编号**: TASK001-03  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-02

**任务描述**: 定义所有配置项的结构体，包括服务器配置、数据库配置、Redis配置、Elasticsearch配置、日志配置等。所有配置结构体应包含适当的标签和注释。

**详细文档**: [TASK001-03.md](TASK001-03.md)

---

##### TASK001-04: 实现环境变量读取功能

**任务编号**: TASK001-04  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-03

**任务描述**: 实现从环境变量读取配置的功能，支持通过os.Getenv读取环境变量，并将环境变量值映射到配置结构体。

**详细文档**: [TASK001-04.md](TASK001-04.md)

---

##### TASK001-05: 实现配置文件读取功能

**任务编号**: TASK001-05  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-03

**任务描述**: 实现从配置文件（YAML/JSON）读取配置的功能，使用viper库支持多种配置文件格式，支持配置文件热加载。

**详细文档**: [TASK001-05.md](TASK001-05.md)

---

##### TASK001-06: 实现配置验证功能

**任务编号**: TASK001-06  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-03

**任务描述**: 实现配置验证功能，验证配置项的必填性、格式正确性、数值范围等。验证失败时返回清晰的错误信息。

**详细文档**: [TASK001-06.md](TASK001-06.md)

---

##### TASK001-07: 实现配置合并逻辑

**任务编号**: TASK001-07  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-04、TASK001-05、TASK001-06

**任务描述**: 实现配置合并逻辑，支持环境变量优先于配置文件，配置文件优先于默认值的优先级规则。合并后的配置应通过验证。

**详细文档**: [TASK001-07.md](TASK001-07.md)

---

##### TASK001-08: 创建.env.example模板文件

**任务编号**: TASK001-08  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-03

**任务描述**: 创建.env.example文件作为配置模板，包含所有可配置的环境变量及其说明。该文件应包含合理的默认值和注释说明。

**详细文档**: [TASK001-08.md](TASK001-08.md)

---

### 数据连接层（13个任务）

#### PostgreSQL数据库连接（5个任务）

##### TASK001-09: 定义PostgreSQL连接配置结构体

**任务编号**: TASK001-09  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-03

**任务描述**: 定义PostgreSQL数据库连接配置结构体，包含主机、端口、用户名、密码、数据库名、连接池参数等配置项。

**详细文档**: [TASK001-09.md](TASK001-09.md)

---

##### TASK001-10: 实现PostgreSQL连接初始化

**任务编号**: TASK001-10  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-09

**任务描述**: 实现PostgreSQL数据库连接初始化功能，使用GORM建立数据库连接，处理连接错误，返回可用的数据库连接实例。

**详细文档**: [TASK001-10.md](TASK001-10.md)

---

##### TASK001-11: 实现PostgreSQL连接池配置

**任务编号**: TASK001-11  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-10

**任务描述**: 实现PostgreSQL数据库连接池配置功能，设置最大打开连接数、最大空闲连接数、连接最大生存时间等参数，优化数据库连接性能。

**详细文档**: [TASK001-11.md](TASK001-11.md)

---

##### TASK001-12: 实现PostgreSQL健康检查功能

**任务编号**: TASK001-12  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-10

**任务描述**: 实现PostgreSQL数据库健康检查功能，通过ping数据库或执行简单查询来检查数据库连接是否正常，返回健康状态和错误信息。

**详细文档**: [TASK001-12.md](TASK001-12.md)

---

##### TASK001-13: 实现PostgreSQL连接重试机制

**任务编号**: TASK001-13  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-10

**任务描述**: 实现PostgreSQL数据库连接重试机制，在连接失败时自动重试，支持配置重试次数、重试间隔等参数，提高系统容错能力。

**详细文档**: [TASK001-13.md](TASK001-13.md)

---

#### Redis缓存连接（5个任务）

##### TASK001-14: 定义Redis连接配置结构体

**任务编号**: TASK001-14  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-03

**任务描述**: 定义Redis缓存连接配置结构体，包含主机、端口、密码、数据库编号、连接池参数等配置项。

**详细文档**: [TASK001-14.md](TASK001-14.md)

---

##### TASK001-15: 实现Redis连接初始化

**任务编号**: TASK001-15  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-14

**任务描述**: 实现Redis缓存连接初始化功能，使用go-redis建立Redis连接，处理连接错误，返回可用的Redis客户端实例。

**详细文档**: [TASK001-15.md](TASK001-15.md)

---

##### TASK001-16: 实现Redis连接池配置

**任务编号**: TASK001-16  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-15

**任务描述**: 实现Redis缓存连接池配置功能，设置连接池大小、最小空闲连接数、连接最大生存时间等参数，优化Redis连接性能。

**详细文档**: [TASK001-16.md](TASK001-16.md)

---

##### TASK001-17: 实现Redis健康检查功能

**任务编号**: TASK001-17  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-15

**任务描述**: 实现Redis缓存健康检查功能，通过ping Redis来检查Redis连接是否正常，返回健康状态和错误信息。

**详细文档**: [TASK001-17.md](TASK001-17.md)

---

##### TASK001-18: 实现Redis基础缓存操作封装

**任务编号**: TASK001-18  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-15

**任务描述**: 实现Redis基础缓存操作封装，提供Get、Set、Delete、Exists等常用缓存操作的封装函数，简化缓存使用，统一错误处理。

**详细文档**: [TASK001-18.md](TASK001-18.md)

---

#### Elasticsearch搜索连接（3个任务）

##### TASK001-19: 定义Elasticsearch连接配置结构体

**任务编号**: TASK001-19  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-03

**任务描述**: 定义Elasticsearch搜索连接配置结构体，包含URL列表、用户名、密码、索引前缀等配置项。

**详细文档**: [TASK001-19.md](TASK001-19.md)

---

##### TASK001-20: 实现Elasticsearch连接初始化

**任务编号**: TASK001-20  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-19

**任务描述**: 实现Elasticsearch搜索连接初始化功能，使用olivere/elastic建立Elasticsearch连接，处理连接错误，返回可用的Elasticsearch客户端实例。

**详细文档**: [TASK001-20.md](TASK001-20.md)

---

##### TASK001-21: 实现Elasticsearch健康检查功能

**任务编号**: TASK001-21  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-20

**任务描述**: 实现Elasticsearch搜索健康检查功能，通过检查集群健康状态来验证Elasticsearch连接是否正常，返回健康状态和错误信息。

**详细文档**: [TASK001-21.md](TASK001-21.md)

---

### 框架层（6个任务）

##### TASK001-22: 定义错误类型结构体

**任务编号**: TASK001-22  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-02

**任务描述**: 定义应用错误类型结构体，包括AppError（应用错误）、ValidationError（验证错误）、NotFoundError（资源不存在错误）、UnauthorizedError（未授权错误）等常见错误类型。

**详细文档**: [TASK001-22.md](TASK001-22.md)

---

##### TASK001-23: 定义错误码常量

**任务编号**: TASK001-23  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-22

**任务描述**: 定义错误码常量体系，包括系统错误（1000-1999）、业务错误（2000-2999）、第三方服务错误（3000-3999）等错误码范围，为每个错误码提供清晰的说明。

**详细文档**: [TASK001-23.md](TASK001-23.md)

---

##### TASK001-24: 实现错误包装函数

**任务编号**: TASK001-24  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-22

**任务描述**: 实现错误包装函数，使用fmt.Errorf和%w动词包装错误，保留错误链，提供错误类型判断函数，支持错误链的遍历和查找。

**详细文档**: [TASK001-24.md](TASK001-24.md)

---

##### TASK001-25: 定义Envelope响应结构体

**任务编号**: TASK001-25  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-22

**任务描述**: 定义Envelope响应格式结构体，包括Meta（元数据）、Data（数据）、Errors（错误）、Links（链接）等部分，符合OpenAPI 3.1.1规范和项目API设计规范。

**详细文档**: [TASK001-25.md](TASK001-25.md)

---

##### TASK001-26: 实现错误响应构建函数

**任务编号**: TASK001-26  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-25、TASK001-23

**任务描述**: 实现错误响应构建函数，将错误转换为Envelope格式，包含meta、errors字段，支持单个错误和多个错误（如验证错误），错误消息使用中文。

**详细文档**: [TASK001-26.md](TASK001-26.md)

---

##### TASK001-27: 实现错误码到HTTP状态码映射

**任务编号**: TASK001-27  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-23

**任务描述**: 实现错误码到HTTP状态码的映射功能，根据错误码自动确定对应的HTTP状态码，用于构建正确的HTTP响应。

**详细文档**: [TASK001-27.md](TASK001-27.md)

---

### HTTP层（9个任务）

##### TASK001-28: 初始化Gin引擎

**任务编号**: TASK001-28  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-07

**任务描述**: 初始化Gin HTTP框架引擎，配置Gin的运行模式（debug、release等），设置基本的引擎配置，为后续路由注册做准备。

**详细文档**: [TASK001-28.md](TASK001-28.md)

---

##### TASK001-29: 实现路由注册机制

**任务编号**: TASK001-29  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-28

**任务描述**: 实现路由注册机制，提供统一的路由注册接口，支持路由分组、版本控制（/api/v1/...），便于后续API路由的注册和管理。

**详细文档**: [TASK001-29.md](TASK001-29.md)

---

##### TASK001-30: 实现中间件链注册机制

**任务编号**: TASK001-30  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-28

**任务描述**: 实现中间件链注册机制，支持中间件的链式注册和优先级控制，提供统一的中间件管理接口，便于中间件的添加和移除。

**详细文档**: [TASK001-30.md](TASK001-30.md)

---

##### TASK001-31: 实现Envelope响应封装中间件

**任务编号**: TASK001-31  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-25、TASK001-30

**任务描述**: 实现Envelope响应封装中间件，自动将响应数据封装为Envelope格式，设置Meta字段（success、code、message、timestamp、request_id等），确保所有API响应符合Envelope格式。

**详细文档**: [TASK001-31.md](TASK001-31.md)

---

##### TASK001-32: 实现健康检查端点

**任务编号**: TASK001-32  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-12、TASK001-17、TASK001-21、TASK001-29

**任务描述**: 实现健康检查端点（/health），检查数据库、Redis、Elasticsearch等服务的健康状态，返回系统整体健康状态，用于监控和负载均衡。

**详细文档**: [TASK001-32.md](TASK001-32.md)

---

##### TASK001-33: 实现请求ID中间件

**任务编号**: TASK001-33  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-02

**任务描述**: 实现请求ID中间件，为每个HTTP请求生成唯一的请求ID（UUID），将请求ID设置到响应头和context中，便于请求追踪和日志关联。

**详细文档**: [TASK001-33.md](TASK001-33.md)

---

##### TASK001-34: 实现日志中间件

**任务编号**: TASK001-34  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-33

**任务描述**: 实现日志中间件，记录HTTP请求和响应的详细信息，包括请求方法、路径、参数、响应状态码、响应时间等，便于问题排查和性能分析。

**详细文档**: [TASK001-34.md](TASK001-34.md)

---

##### TASK001-35: 实现错误恢复中间件

**任务编号**: TASK001-35  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-22、TASK001-26

**任务描述**: 实现错误恢复中间件，捕获HTTP处理过程中的panic，将panic转换为错误响应，防止服务崩溃，提高系统稳定性。

**详细文档**: [TASK001-35.md](TASK001-35.md)

---

##### TASK001-36: 实现CORS中间件

**任务编号**: TASK001-36  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-28

**任务描述**: 实现CORS（跨域资源共享）中间件，配置允许的源、方法、头部等CORS策略，支持跨域请求，确保前端可以正常访问API。

**详细文档**: [TASK001-36.md](TASK001-36.md)

---

### gRPC层（6个任务）

##### TASK001-37: 初始化gRPC服务器

**任务编号**: TASK001-37  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-07

**任务描述**: 初始化gRPC服务器，创建gRPC服务器实例，配置服务器选项（如最大接收消息大小、最大发送消息大小等），为后续服务注册做准备。

**详细文档**: [TASK001-37.md](TASK001-37.md)

---

##### TASK001-38: 实现服务注册机制

**任务编号**: TASK001-38  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-37

**任务描述**: 实现gRPC服务注册机制，提供统一的服务注册接口，支持将gRPC服务注册到服务器，便于后续业务服务的注册和管理。

**详细文档**: [TASK001-38.md](TASK001-38.md)

---

##### TASK001-39: 实现认证拦截器

**任务编号**: TASK001-39  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-37

**任务描述**: 实现gRPC认证拦截器，在gRPC请求处理前进行身份认证，验证请求的认证信息（如Token、API Key等），认证失败时返回相应的错误。

**详细文档**: [TASK001-39.md](TASK001-39.md)

---

##### TASK001-40: 实现日志拦截器

**任务编号**: TASK001-40  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-37

**任务描述**: 实现gRPC日志拦截器，记录gRPC请求和响应的详细信息，包括方法名、请求参数、响应结果、处理时间等，便于问题排查和性能分析。

**详细文档**: [TASK001-40.md](TASK001-40.md)

---

##### TASK001-41: 实现错误处理拦截器

**任务编号**: TASK001-41  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-22、TASK001-27

**任务描述**: 实现gRPC错误处理拦截器，统一处理gRPC请求中的错误，将应用错误转换为gRPC标准错误，确保错误响应格式统一。

**详细文档**: [TASK001-41.md](TASK001-41.md)

---

##### TASK001-42: 实现健康检查服务

**任务编号**: TASK001-42  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-38、TASK001-12、TASK001-17、TASK001-21

**任务描述**: 实现gRPC健康检查服务，实现gRPC标准的健康检查服务接口，检查系统健康状态，用于服务发现和负载均衡。

**详细文档**: [TASK001-42.md](TASK001-42.md)

---

### 入口层（2个任务）

##### TASK001-43: 创建主程序入口

**任务编号**: TASK001-43  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-07、TASK001-10、TASK001-15、TASK001-20、TASK001-29、TASK001-38

**任务描述**: 创建cmd/core/main.go主程序入口，整合所有组件（配置、数据库、Redis、Elasticsearch、HTTP服务器、gRPC服务器），实现服务器启动逻辑。

**详细文档**: [TASK001-43.md](TASK001-43.md)

---

##### TASK001-44: 实现优雅关闭机制

**任务编号**: TASK001-44  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**依赖任务**: TASK001-43

**任务描述**: 实现优雅关闭机制，监听系统信号（SIGINT、SIGTERM），在收到关闭信号时优雅地关闭HTTP服务器、gRPC服务器和数据库连接，确保正在处理的请求完成后再关闭。

**详细文档**: [TASK001-44.md](TASK001-44.md)

---

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

## 参考文档

- [项目整体任务文档](../TASKS.md)
- [项目整体需求文档](../../Requirements/Overview.md)
- [核心模块需求文档](../../Requirements/Core.md)
- [API设计规范](../../../.cursor/rules/api.mdc)
- [Golang编码规范](../../../.cursor/rules/golang.mdc)
- [数据库设计规范](../../../.cursor/rules/database.mdc)

---

**文档版本**: 2.0  
**最后更新**: 2026-01-02 21:44:12 CST

