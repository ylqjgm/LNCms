# TASK001-18: 实现Redis基础缓存操作封装

## 任务信息

**任务编号**: TASK001-18  
**父任务**: TASK001  
**任务名称**: 实现Redis基础缓存操作封装  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 21:44:12 CST

## 任务描述

实现Redis基础缓存操作封装，提供Get、Set、Delete、Exists等常用缓存操作的封装函数，简化缓存使用，统一错误处理。

## 依赖任务

- TASK001-15: 实现Redis连接初始化

## 实现指南

### 1. 实现基础缓存操作函数

在 `internal/cache/redis.go` 中实现基础缓存操作函数。

### 2. 实现Get函数

实现Get函数（获取缓存值，支持字符串、JSON等格式）：

```go
// Get 获取缓存值
func Get(ctx context.Context, client *redis.Client, key string) (string, error) {
    val, err := client.Get(ctx, key).Result()
    if err == redis.Nil {
        return "", fmt.Errorf("缓存键不存在: %s", key)
    }
    if err != nil {
        return "", fmt.Errorf("获取缓存值失败: %w", err)
    }
    return val, nil
}

// GetJSON 获取JSON格式的缓存值
func GetJSON(ctx context.Context, client *redis.Client, key string, dest interface{}) error {
    val, err := client.Get(ctx, key).Result()
    if err == redis.Nil {
        return fmt.Errorf("缓存键不存在: %s", key)
    }
    if err != nil {
        return fmt.Errorf("获取缓存值失败: %w", err)
    }
    return json.Unmarshal([]byte(val), dest)
}
```

### 3. 实现Set函数

实现Set函数（设置缓存值，支持过期时间）：

```go
// Set 设置缓存值
func Set(ctx context.Context, client *redis.Client, key string, value interface{}, expiration time.Duration) error {
    if err := client.Set(ctx, key, value, expiration).Err(); err != nil {
        return fmt.Errorf("设置缓存值失败: %w", err)
    }
    return nil
}

// SetJSON 设置JSON格式的缓存值
func SetJSON(ctx context.Context, client *redis.Client, key string, value interface{}, expiration time.Duration) error {
    data, err := json.Marshal(value)
    if err != nil {
        return fmt.Errorf("序列化JSON失败: %w", err)
    }
    return Set(ctx, client, key, string(data), expiration)
}
```

### 4. 实现Delete函数

实现Delete函数（删除缓存键）：

```go
// Delete 删除缓存键
func Delete(ctx context.Context, client *redis.Client, key string) error {
    if err := client.Del(ctx, key).Err(); err != nil {
        return fmt.Errorf("删除缓存键失败: %w", err)
    }
    return nil
}
```

### 5. 实现Exists函数

实现Exists函数（检查缓存键是否存在）：

```go
// Exists 检查缓存键是否存在
func Exists(ctx context.Context, client *redis.Client, key string) (bool, error) {
    count, err := client.Exists(ctx, key).Result()
    if err != nil {
        return false, fmt.Errorf("检查缓存键是否存在失败: %w", err)
    }
    return count > 0, nil
}
```

### 6. 实现TTL函数

实现TTL函数（获取缓存键的剩余生存时间）：

```go
// TTL 获取缓存键的剩余生存时间
func TTL(ctx context.Context, client *redis.Client, key string) (time.Duration, error) {
    ttl, err := client.TTL(ctx, key).Result()
    if err != nil {
        return 0, fmt.Errorf("获取缓存键TTL失败: %w", err)
    }
    return ttl, nil
}
```

### 7. 统一错误处理

统一错误处理，所有错误信息使用中文。

### 8. 支持context传递

支持context传递（用于超时控制），所有函数都接受context参数。

## 验收标准

1. **所有基础缓存操作函数已实现**
   - Get函数已实现
   - Set函数已实现
   - Delete函数已实现
   - Exists函数已实现
   - TTL函数已实现

2. **Get、Set、Delete、Exists函数正常工作**
   - Get函数可以正确获取缓存值
   - Set函数可以正确设置缓存值
   - Delete函数可以正确删除缓存键
   - Exists函数可以正确检查缓存键是否存在

3. **支持过期时间设置**
   - Set函数支持设置过期时间
   - 过期时间设置正确

4. **错误处理统一且使用中文**
   - 所有错误信息使用中文
   - 错误信息清晰、具体
   - 错误处理统一

5. **支持context超时控制**
   - 所有函数都接受context参数
   - context超时控制正常工作

## 相关文件

- `internal/cache/redis.go` - Redis基础缓存操作封装实现（修改）

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 21:44:12 CST

