# TASK001-22: 定义错误类型结构体

## 任务信息

**任务编号**: TASK001-22  
**父任务**: TASK001  
**任务名称**: 定义错误类型结构体  
**版本信息**: v1.0.0  
**当前状态**: 计划中  
**创建时间**: 2026-01-02 21:44:12 CST

## 任务描述

定义应用错误类型结构体，包括AppError（应用错误）、ValidationError（验证错误）、NotFoundError（资源不存在错误）、UnauthorizedError（未授权错误）等常见错误类型。

## 依赖任务

- TASK001-02: 初始化Go模块和依赖管理

## 实现指南

### 1. 创建错误类型结构体文件

创建 `internal/errors/types.go` 文件，定义所有错误类型结构体。

### 2. 定义AppError结构体

定义AppError结构体（Code、Message、Err字段）：

```go
// AppError 应用错误
type AppError struct {
    Code    string // 错误码
    Message string // 错误消息（中文）
    Err     error  // 底层错误
}

// Error 实现error接口
func (e *AppError) Error() string {
    if e.Err != nil {
        return fmt.Sprintf("%s: %v", e.Message, e.Err)
    }
    return e.Message
}

// Unwrap 返回底层错误
func (e *AppError) Unwrap() error {
    return e.Err
}
```

### 3. 定义ValidationError结构体

定义ValidationError结构体（Field、Message字段）：

```go
// ValidationError 验证错误
type ValidationError struct {
    Field   string // 字段名
    Message string // 错误消息（中文）
}

// Error 实现error接口
func (e *ValidationError) Error() string {
    if e.Field != "" {
        return fmt.Sprintf("字段 %s: %s", e.Field, e.Message)
    }
    return e.Message
}
```

### 4. 定义NotFoundError结构体

定义NotFoundError结构体（Resource、ID字段）：

```go
// NotFoundError 资源不存在错误
type NotFoundError struct {
    Resource string // 资源类型
    ID       string // 资源ID
}

// Error 实现error接口
func (e *NotFoundError) Error() string {
    return fmt.Sprintf("资源不存在: %s (ID: %s)", e.Resource, e.ID)
}
```

### 5. 定义UnauthorizedError结构体

定义UnauthorizedError结构体（Message字段）：

```go
// UnauthorizedError 未授权错误
type UnauthorizedError struct {
    Message string // 错误消息（中文）
}

// Error 实现error接口
func (e *UnauthorizedError) Error() string {
    if e.Message == "" {
        return "未授权"
    }
    return e.Message
}
```

### 6. 定义ForbiddenError结构体

定义ForbiddenError结构体（Message字段）：

```go
// ForbiddenError 权限不足错误
type ForbiddenError struct {
    Message string // 错误消息（中文）
}

// Error 实现error接口
func (e *ForbiddenError) Error() string {
    if e.Message == "" {
        return "权限不足"
    }
    return e.Message
}
```

### 7. 为所有错误类型实现Error()方法

为所有错误类型实现Error()方法，使其实现error接口。

### 8. 为所有错误类型添加中文注释

为所有错误类型添加中文注释，说明错误类型的用途和使用场景。

## 验收标准

1. **所有错误类型结构体已定义**
   - AppError结构体已定义
   - ValidationError结构体已定义
   - NotFoundError结构体已定义
   - UnauthorizedError结构体已定义
   - ForbiddenError结构体已定义

2. **错误类型实现error接口**
   - 所有错误类型都实现了Error()方法
   - 可以正确转换为error类型

3. **错误类型支持错误链**
   - AppError支持Unwrap()方法
   - 可以使用errors.Is和errors.As判断错误类型

4. **所有错误类型都有中文注释**
   - 结构体有中文注释说明用途
   - 字段有中文注释说明含义

## 相关文件

- `internal/errors/types.go` - 错误类型结构体定义文件

## Git 提交信息任务

任务完成后，需要生成 Git 提交信息。请根据实际修改内容生成合适的提交信息。

---

**文档版本**: 1.0  
**最后更新**: 2026-01-02 21:44:12 CST

