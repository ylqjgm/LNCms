# 项目上下文文档

本文档记录项目开发过程中的重要对话和决策。

## 2026-01-02 19:37 CST - API 设计规范规则文件创建和修复

### 任务描述

创建通用 API 规范规则文档，要求：
- 创建在 `.cursor/rules` 目录下
- 以 Cursor 规则文件方式创建
- 文件格式为 `.mdc`
- 需要合理配置 `globs`、`description`、`alwaysApply` 元数据
- 符合 OpenAPI 3.1.1 规范
- 响应使用 Envelope 格式，包含 meta、data、errors 三个部分
- meta 中包含返回信息的元数据
- data 为返回的数据内容
- errors 为错误信息
- 若为分页，则分页信息 pagination 写在 meta 中，且还需要包含 links 数据
- 规则文件需要合理配置元数据

### 执行过程

#### 1. 创建规则文件结构

创建了 `.cursor/rules/api.mdc` 文件，包含以下元数据配置：

```yaml
---
globs: ["**/*.go", "**/api/**", "**/handler/**", "**/controller/**", "**/route/**"]
description: "API 设计规范规则 - 遵循 OpenAPI 3.1.1 规范，使用 Envelope 响应格式，包含 meta、data、errors 结构，支持分页和链接"
alwaysApply: true
---
```

#### 2. 初始规则内容

规则文件包含以下完整的 API 设计规范：

1. **OpenAPI 3.1.1 规范要求**
   - 基本要求：所有 API 必须符合 OpenAPI 3.1.1 规范
   - API 版本控制：使用 URL 路径进行版本控制（`/api/v1/...`）

2. **Envelope 响应格式**
   - 基本结构：包含 meta、data、errors 三个部分
   - Meta 结构：包含 success、code、message、timestamp、request_id、pagination（可选）
   - Pagination 结构：包含 page、limit、total、pages、has_next、has_previous
   - Links 结构：包含 self、first、last、next（可为 null）、prev（可为 null）
   - Error 结构：包含 code、message、field（可选）

3. **分页规范**
   - 分页参数：page（页码，从 1 开始）、limit（每页数量，默认 20，最大 100）
   - 分页响应：分页信息在 meta.pagination 中，链接信息在 links 中（根级别）

4. **HTTP 状态码规范**
   - 标准状态码使用：200 OK、201 Created、204 No Content、400 Bad Request、401 Unauthorized、403 Forbidden、404 Not Found、422 Unprocessable Entity、429 Too Many Requests、500 Internal Server Error、503 Service Unavailable

5. **请求规范**
   - 请求头：Content-Type、Accept、Authorization
   - 请求参数：查询参数、路径参数、请求体使用小写字母和下划线

6. **错误处理规范**
   - 错误代码规范：使用大写字母和下划线，错误消息必须使用中文
   - 错误消息规范：清晰、具体，包含足够的上下文信息

7. **元数据配置规范**
   - Request ID：使用 UUID v4 格式，每个请求必须生成唯一的 Request ID
   - 时间戳：使用 ISO 8601 格式（UTC 时区，Z 后缀）
   - 响应代码：code 为 0 表示成功，非 0 表示失败

8. **响应构建辅助函数**
   - 成功响应构建：BuildSuccessResponse、BuildPaginatedResponse
   - 错误响应构建：BuildErrorResponse、BuildMultipleErrorsResponse
   - Meta 构建：buildSuccessMeta、buildSuccessMetaWithPagination、buildErrorMeta

9. **OpenAPI 文档规范**
   - 基本结构：OpenAPI 3.1.1 格式
   - Schema 定义：Envelope、Meta、Pagination、Links、Error 的完整定义

10. **最佳实践**
    - 统一响应格式：所有 API 响应必须使用 Envelope 格式
    - 合理使用分页：列表接口应支持分页
    - 错误处理：所有错误必须使用 Envelope 格式返回
    - 元数据完整性：每个响应必须包含完整的元数据

#### 3. 修复 Envelope 响应格式

根据用户提供的正确格式要求，修复了以下内容：

1. **Meta 结构修复**
   - 添加 `success`（boolean）：表示请求是否成功
   - 添加 `code`（int）：响应代码，0 表示成功
   - `message`：响应消息，成功时为 "ok"
   - 保留 `timestamp`（UTC 格式，Z 后缀）
   - 保留 `request_id`
   - `pagination` 在 meta 中（可选）

2. **Envelope 结构修复**
   - `meta`：元数据
   - `data`：数据内容（可为 null）
   - `errors`：错误数组（空数组而非 null）
   - `links`：链接信息（在根级别，仅分页时存在）

3. **Pagination 结构修复**
   - `page`：当前页码
   - `limit`：每页数量（从 `per_page` 改为 `limit`）
   - `total`：总记录数
   - `pages`：总页数（从 `total_pages` 改为 `pages`）
   - `has_next`：是否有下一页
   - `has_previous`：是否有上一页

4. **Links 结构修复**
   - `self`：当前页链接
   - `first`：第一页链接
   - `last`：最后一页链接
   - `next`：下一页链接（可为 null）
   - `prev`：上一页链接（可为 null）

5. **时间戳格式修复**
   - 从 `+08:00` 改为 UTC 格式（Z 后缀）

6. **分页参数修复**
   - 从 `per_page` 改为 `limit`

7. **响应示例修复**
   - 更新所有 JSON 示例以符合新格式
   - 更新所有 Go 代码示例

### 最终结果

成功创建并修复了 API 设计规范规则文件，确保所有 API 接口遵循统一的 Envelope 响应格式：

- **Meta 结构**：包含 success、code、message、timestamp、request_id，分页时包含 pagination
- **Envelope 结构**：包含 meta、data、errors，分页时包含 links（根级别）
- **分页格式**：pagination 在 meta 中，links 在根级别
- **时间戳格式**：使用 UTC 时区（Z 后缀）
- **分页参数**：使用 `limit` 而不是 `per_page`

### 创建的文件

- `.cursor/rules/api.mdc` - API 设计规范规则文件（864 行）

### 相关文件

- 规则文件位置：`.cursor/rules/api.mdc`
- 规则文件会在编辑 Go 代码和 API 相关文件时自动应用（`alwaysApply: true`），确保所有 API 接口符合规范
- 匹配的文件模式：`**/*.go`、`**/api/**`、`**/handler/**`、`**/controller/**`、`**/route/**`

## 2026-01-02 19:25 CST - 通用文档编写规范规则文件创建

### 任务描述

创建通用文档编写规范规则文档，要求：
- 创建在 `.cursor/rules` 目录下
- 以 Cursor 规则文件方式创建
- 文件格式为 `.mdc`
- 需要合理配置 `globs`、`description`、`alwaysApply` 元数据
- 符合当前通用文档编写规范
- 增加特殊要求：
  1. 所有文档必须使用中文编写
  2. 所有文档涉及到的时间，必须通过本地 Asia/Shanghai 时区进行时间验证
  3. 每次完成对话后，必须将对话内容进行整理后，更新至 `docs/CONTEXT/CONTEXT.md` 文档中
  4. 每次更新 `docs/CONTEXT/CONTEXT.md` 文档时，若当前文档内容已是当日之前的内容，请将文档进行日期更名，重新创建 CONTEXT.md 文档后进行写入

### 执行过程

#### 1. 创建规则文件结构

创建了 `.cursor/rules/documentation.mdc` 文件，包含以下元数据配置：

```yaml
---
globs: ["**/*.md", "**/*.mdx", "**/docs/**", "**/README*", "**/CHANGELOG*"]
description: "通用文档编写规范规则 - 定义文档编写规范，要求所有文档使用中文编写，时间使用 Asia/Shanghai 时区，规范 CONTEXT.md 文档更新流程"
alwaysApply: true
---
```

#### 2. 规则内容

规则文件包含以下完整的通用文档编写规范：

1. **语言要求**
   - 中文编写要求：所有文档必须使用中文编写，文档标题、正文内容、代码注释等都必须使用中文
   - 语言一致性：同一文档内应保持语言风格一致，使用规范的简体中文

2. **时间处理规范**
   - 时区要求：所有文档涉及到的时间，必须通过本地 Asia/Shanghai 时区进行时间验证
   - 时间格式：统一使用 `YYYY-MM-DD HH:MM:SS CST` 或 `YYYY-MM-DD HH:MM:SS +08:00` 格式
   - 时间获取方式：使用系统命令获取 Asia/Shanghai 时区的当前时间

3. **CONTEXT.md 文档更新规范**
   - 更新要求：每次完成对话后，必须将对话内容进行整理后，更新至 `docs/CONTEXT/CONTEXT.md` 文档中
   - 文档更新格式：包含任务描述、执行过程、最终结果、创建的文件、相关文件说明
   - 日期更名规则：
     - 检查文档最后更新时间
     - 如果最后一条记录的日期不是当日，将现有文档重命名为 `CONTEXT_YYYY-MM-DD.md`
     - 创建新的 `CONTEXT.md` 文件并写入新的内容

4. **文档结构规范**
   - 文档头部：包含清晰的标题和描述
   - 章节组织：使用清晰的层次结构，章节标题应简洁明了
   - 代码示例：代码示例应清晰、完整，使用适当的代码块标记

5. **文档内容规范**
   - 准确性要求：文档内容应准确反映实际情况，及时更新过时的信息
   - 完整性要求：文档应包含必要的信息，不遗漏重要的步骤或说明
   - 可读性要求：使用清晰的表达方式，避免过长的段落
   - 一致性要求：术语使用应一致，格式风格应统一

6. **文档维护规范**
   - 版本控制：文档应与代码一起进行版本控制
   - 定期审查：定期审查文档的准确性，更新过时的内容
   - 反馈收集：收集用户对文档的反馈，根据反馈改进文档

7. **Markdown 规范**
   - 标题：使用 `#` 创建标题，从一级标题开始
   - 列表：有序列表使用数字加点，无序列表使用 `-` 或 `*`
   - 链接：使用描述性的链接文本，内部链接使用相对路径
   - 图片：使用描述性的 alt 文本，图片路径使用相对路径
   - 表格：使用 Markdown 表格语法，表格应对齐整齐
   - 代码块：使用三个反引号创建代码块，指定代码语言类型
   - 引用：使用 `>` 创建引用块

8. **特殊文档类型规范**
   - README.md：应包含项目简介、安装和运行说明、使用示例等
   - CHANGELOG.md：按时间倒序排列，使用清晰的版本号或日期
   - API 文档：包含完整的接口说明、请求和响应示例
   - 架构文档：包含清晰的架构图，说明各模块的职责

9. **文档审查清单**
   - 语言规范：所有内容都使用中文编写，技术术语有适当的中文解释
   - 时间规范：所有时间都使用 Asia/Shanghai 时区，时间格式统一
   - CONTEXT.md 更新：对话完成后已更新 CONTEXT.md，如果文档是前一日期，已进行日期更名
   - 文档结构：标题层次清晰，章节组织合理
   - 文档内容：内容准确、完整，代码示例正确，链接有效
   - 可读性：表达清晰，使用适当的格式，段落长度适当

#### 3. 代码示例

规则文件包含大量代码示例和格式说明：
- 时间格式示例（标准时间格式、日期格式、在文档中使用时间）
- 时间获取方式示例（Unix/Linux/macOS 系统命令）
- CONTEXT.md 更新格式示例（任务描述、执行过程、最终结果等）
- 日期更名规则示例（检查文档最后更新日期的流程）
- Markdown 格式示例（标题、列表、链接、图片、表格、代码块、引用）
- 文档审查清单示例

### 最终规则

**重要规则：所有文档编写操作都必须严格遵循本规范要求。始终使用中文编写所有文档内容，所有时间使用 Asia/Shanghai 时区进行验证和显示，每次对话完成后及时更新 CONTEXT.md 文档，更新 CONTEXT.md 时如果文档内容已是前一日期，应先进行日期更名，再创建新文档，保持文档结构清晰、内容准确、格式规范。**

### 创建的文件

- `.cursor/rules/documentation.mdc` - 通用文档编写规范规则文件（约 550 行）

### 相关文件

- 规则文件位置：`.cursor/rules/documentation.mdc`
- 规则文件会在编辑文档文件（`*.md`、`*.mdx`、`docs/**`、`README*`、`CHANGELOG*`）时自动应用（`alwaysApply: true`），确保文档编写符合规范
- 匹配的文件模式：`**/*.md`、`**/*.mdx`、`**/docs/**`、`**/README*`、`**/CHANGELOG*`

## 2026-01-02 19:19:25 CST - Golang 单元测试规范规则文件创建

### 任务描述

创建 Golang 单元测试规范规则文档，要求：
- 创建在 `.cursor/rules` 目录下
- 以 Cursor 规则文件方式创建
- 文件格式为 `.mdc`
- 需要合理配置 `globs`、`description`、`alwaysApply` 元数据
- 符合当前通用的 Golang 语言测试要求
- 注意合理配置规则文件的元数据

### 执行过程

#### 1. 创建规则文件结构

创建了 `.cursor/rules/testing.mdc` 文件，包含以下元数据配置：

```yaml
---
globs: ["**/*_test.go"]
description: "Golang 单元测试规范规则 - 定义测试文件组织、测试用例编写、覆盖率要求、Mock 使用等测试规范，确保测试代码的质量和可维护性"
alwaysApply: true
---
```

#### 2. 规则内容

规则文件包含以下完整的 Golang 单元测试规范：

1. **测试文件组织**
   - 测试文件命名：必须以 `_test.go` 结尾，命名格式为 `被测试文件名_test.go`
   - 测试包命名：单元测试使用相同包名，集成测试可使用独立测试包
   - 测试文件结构：包声明、导入语句、测试辅助函数和变量、测试函数、基准测试函数、示例函数

2. **测试函数命名**
   - 单元测试函数：必须以 `Test` 开头，接受 `*testing.T` 参数
   - 子测试命名：使用 `t.Run()` 创建子测试，子测试名称必须使用中文
   - 基准测试函数：必须以 `Benchmark` 开头，接受 `*testing.B` 参数
   - 示例函数：必须以 `Example` 开头，通过 `// Output:` 注释检查输出

3. **表驱动测试**
   - 基本原则：优先使用表驱动测试处理多个测试场景
   - 表驱动测试结构：包含测试用例名称（中文）、输入值、期望结果、错误消息等
   - 最佳实践：测试用例名称清晰、包含边界情况、包含异常情况、保持测试独立、使用 `t.Helper()`

4. **测试覆盖率**
   - 覆盖率要求：核心业务逻辑 80% 以上，关键功能 90% 以上，工具类和辅助函数 70% 以上
   - 生成覆盖率报告：使用 `go test -coverprofile` 生成，使用 `go tool cover` 查看
   - 覆盖率分析：关注语句覆盖率和分支覆盖率，识别未覆盖的代码，避免为了覆盖率而测试

5. **Mock 和依赖注入**
   - Mock 原则：使用接口进行依赖注入，使用 Mock 框架，避免测试真实的外部依赖
   - 接口设计：定义接口、实现接口、服务使用接口
   - 使用 testify/mock：定义 Mock、设置期望、验证结果
   - 使用 gomock：代码生成 Mock、设置期望、验证结果

6. **测试辅助函数**
   - 辅助函数命名：以 `setup`、`teardown`、`helper` 等前缀命名
   - 使用 `t.Helper()` 标记辅助函数
   - 测试 Fixture：使用 `testdata` 目录，使用 `embed` 包嵌入测试数据

7. **测试工具和断言**
   - 使用 testify：推荐使用 `testify/assert` 和 `testify/require`
   - 常用断言：相等断言、空值断言、布尔断言、错误断言、包含断言、长度断言、时间断言

8. **测试最佳实践**
   - 测试独立性：每个测试应该独立，不依赖其他测试的执行顺序
   - 测试清理：使用 `defer` 确保资源清理，使用 `t.Cleanup()` 注册清理函数
   - 错误消息：错误消息应该清晰、具体，必须使用中文，包含足够的上下文信息
   - 避免测试实现细节：测试行为而不是实现，避免测试私有函数，关注公共接口的测试
   - 测试性能关键代码：为性能关键的函数编写基准测试，记录基准测试结果

9. **测试命令和工具**
   - 基本测试命令：运行所有测试、运行指定包测试、运行匹配模式测试、显示详细输出、运行基准测试、生成覆盖率报告、检测竞态条件
   - 测试工具推荐：testify、gomock、httptest、sqlmock、testcontainers

10. **测试文件示例**
    - 完整测试文件示例：包含测试辅助变量、测试辅助函数、单元测试、基准测试、示例函数

11. **测试审查清单**
    - 测试覆盖：是否覆盖了正常情况、边界情况、异常情况，测试覆盖率是否达标
    - 测试质量：测试是否独立，测试名称是否清晰，错误消息是否清晰具体，是否使用了表驱动测试
    - 代码组织：测试文件命名是否正确，测试函数命名是否正确，是否使用了辅助函数，是否使用了 `t.Helper()`
    - Mock 和依赖：是否使用了 Mock 替代外部依赖，Mock 设置是否正确，是否验证了 Mock 的调用
    - 性能测试：是否为性能关键的函数编写了基准测试，基准测试是否正确设置

#### 3. 代码示例

规则文件包含大量代码示例，主要使用 Go 语言：
- 测试文件组织示例（单元测试和集成测试）
- 测试函数命名示例（Test、Benchmark、Example）
- 表驱动测试示例（完整的测试用例结构）
- 测试覆盖率示例（测试所有分支）
- Mock 使用示例（testify/mock 和 gomock）
- 测试辅助函数示例（setup、teardown、helper）
- 测试工具和断言示例（testify 断言库）
- 测试最佳实践示例（测试独立性、测试清理、错误消息）
- 完整测试文件示例（包含所有测试类型的完整示例）

### 最终规则

**重要规则：测试是代码质量的重要保障，应该与业务代码同等重视。所有测试代码都应该遵循本规范要求。使用表驱动测试处理多个测试场景，确保测试独立性，使用 Mock 替代外部依赖，达到覆盖率要求（核心业务逻辑 80% 以上，关键功能 90% 以上），编写清晰的测试（测试名称和错误消息使用中文），使用测试工具提高测试效率，编写基准测试，保持测试简洁易读易维护。**

### 创建的文件

- `.cursor/rules/testing.mdc` - Golang 单元测试规范规则文件（916 行）

### 相关文件

- 规则文件位置：`.cursor/rules/testing.mdc`
- 规则文件会在编辑 `*_test.go` 文件时自动应用（`alwaysApply: true`），确保测试代码符合规范
- 匹配的文件模式：`**/*_test.go`

## 2026-01-02 19:11:50 CST - Golang 代码质量规范规则文件创建

### 任务描述

创建 Golang 代码质量规范规则文档，要求：
- 创建在 `.cursor/rules` 目录下
- 以 Cursor 规则文件方式创建
- 文件格式为 `.mdc`
- 需要合理配置 `globs`、`description`、`alwaysApply` 元数据
- 符合当前通用的 Golang 开发质量要求
- 注意规则文件元数据的使用

### 执行过程

#### 1. 创建规则文件结构

创建了 `.cursor/rules/code-quality.mdc` 文件，包含以下元数据配置：

```yaml
---
globs: ["**/*.go"]
description: "Golang 代码质量规范规则 - 定义代码质量指标、测试覆盖率、代码审查标准等质量要求，确保代码的高质量和高可维护性"
alwaysApply: true
---
```

#### 2. 规则内容

规则文件包含以下完整的 Golang 代码质量规范：

1. **代码质量指标**
   - 圈复杂度（Cyclomatic Complexity）：函数圈复杂度应不超过 15，理想情况下应控制在 10 以内，使用 `gocyclo` 工具检测
   - 代码重复率：代码重复率应低于 5%，重复代码超过 3 行的必须提取为公共函数，使用 `gocopy` 或 `dupl` 工具检测
   - 函数长度：单个函数不应超过 50 行，复杂函数不应超过 100 行
   - 文件长度：单个文件不应超过 1000 行

2. **测试覆盖率**
   - 覆盖率要求：核心业务逻辑代码覆盖率应达到 80% 以上，关键功能代码覆盖率应达到 90% 以上，工具类和辅助函数覆盖率应达到 70% 以上
   - 测试用例要求：每个导出的函数都应该有对应的测试用例，覆盖正常情况、边界情况和异常情况，使用表驱动测试
   - 性能测试：对于性能关键的函数，应编写基准测试（Benchmark）

3. **代码审查标准**
   - 审查检查清单：功能正确性、代码质量、测试覆盖、性能、安全性、可维护性
   - 审查流程：提交前自检、自动化检查、同行评审、质量门禁

4. **代码质量工具**
   - 必须使用的工具：gofmt、go vet、golangci-lint、gocyclo、go test
   - 推荐使用的工具：staticcheck、errcheck、ineffassign、misspell、unused
   - 工具配置示例：提供了 `.golangci.yml` 配置示例和 CI/CD 集成示例（GitHub Actions）

5. **性能要求**
   - 响应时间要求：API 接口响应时间应控制在 500ms 以内，数据库查询响应时间应控制在 100ms 以内，缓存查询响应时间应控制在 10ms 以内
   - 资源使用要求：内存使用应合理，CPU 使用应优化，并发处理应优化
   - 性能优化原则：避免过早优化，进行性能测试，识别性能瓶颈，优化关键路径

6. **可维护性要求**
   - 代码可读性：代码应该自解释，复杂逻辑应该添加注释，函数和类型应该有清晰的注释，避免魔法数字和字符串
   - 代码组织结构：包应该职责清晰，文件应该合理组织，依赖关系应该清晰，接口应该小而专注
   - 错误处理：所有错误都应该被正确处理，错误消息应该清晰、具体，使用错误包装保留错误链，定义错误变量

7. **质量门禁标准**
   - CI/CD 质量门禁：代码格式化、静态检查、测试通过、覆盖率达标、圈复杂度、代码重复、无安全漏洞
   - 质量报告：代码覆盖率报告、静态检查报告、性能测试报告、代码质量评分

8. **代码质量评分**
   - 评分标准：测试覆盖率（30%）、代码复杂度（20%）、代码重复率（15%）、静态检查（20%）、代码审查（15%）
   - 评分等级：A 级（90-100 分）、B 级（80-89 分）、C 级（70-79 分）、D 级（60-69 分）、F 级（<60 分）

9. **持续改进**
   - 质量监控：定期审查代码质量指标，分析质量趋势，收集代码审查反馈
   - 质量改进：重构低质量代码，补充测试用例，优化性能瓶颈，更新工具配置
   - 知识分享：分享最佳实践，代码审查讨论，质量培训

#### 3. 代码示例

规则文件包含大量代码示例，主要使用 Go 语言：
- 圈复杂度示例（好的做法和不好的做法对比）
- 代码重复率示例（提取公共逻辑）
- 测试用例示例（表驱动测试）
- 基准测试示例
- 性能优化示例（预分配切片容量）
- 代码可读性示例（使用常量替代魔法数字）
- 错误处理示例（清晰的错误处理和错误包装）

### 最终规则

**重要规则：代码质量是项目长期维护的基础，所有代码都必须符合本规范要求。在代码审查和 CI/CD 流程中，不符合质量规范的代码不应合并到主分支。遵循代码质量指标、测试覆盖率、代码审查标准、性能要求、可维护性要求、质量门禁标准等规范，确保代码的高质量和高可维护性。**

### 创建的文件

- `.cursor/rules/code-quality.mdc` - Golang 代码质量规范规则文件（约 567 行）

### 相关文件

- 规则文件位置：`.cursor/rules/code-quality.mdc`
- 规则文件会在编辑 `.go` 文件时自动应用（`alwaysApply: true`），确保代码符合质量规范
- 匹配的文件模式：`**/*.go`

## 2026-01-02 13:47:49 CST - 应用安全开发规范规则文件创建

### 任务描述

创建应用安全开发规范规则文档，要求：
- 创建在 `.cursor/rules` 目录下
- 以 Cursor 规则文件方式创建
- 文件格式为 `.mdc`
- 需要合理配置 `globs`、`description`、`alwaysApply` 元数据
- 注意元数据的合理配置
- 涵盖常见安全漏洞和防护措施

### 执行过程

#### 1. 创建规则文件结构

创建了 `.cursor/rules/security.mdc` 文件，包含以下元数据配置：

```yaml
---
globs: ["**/*.go", "**/*.js", "**/*.ts", "**/*.php", "**/*.py", "**/*.java", "**/config/**", "**/.env*", "**/routes/**", "**/middleware/**"]
description: "应用安全开发规范规则 - 遵循安全开发最佳实践，防范常见安全漏洞，确保应用安全性和数据保护"
alwaysApply: true
---
```

#### 2. 规则内容

规则文件包含以下完整的应用安全开发规范：

1. **输入验证和清理**
   - 基本原则：永远不要信任用户输入，白名单验证优于黑名单
   - 字符串验证：长度、字符集、格式验证
   - 数值验证：范围验证、防止整数溢出
   - 文件上传验证：文件类型、大小、内容验证
   - 输出编码：HTML、URL、JavaScript 等不同上下文的编码

2. **身份认证和授权**
   - 密码安全：使用强密码策略，使用 bcrypt、argon2 等安全哈希算法
   - 会话管理：安全的会话标识符、会话超时、会话固定防护
   - 多因素认证（MFA）：TOTP、短信验证码、邮件验证码
   - 最小权限原则：基于角色的访问控制（RBAC）
   - 资源级授权：防止水平权限提升和垂直权限提升

3. **SQL 注入防护**
   - 基本原则：永远不要拼接 SQL 字符串，使用参数化查询
   - 参数化查询：使用 Prepared Statements
   - 动态查询构建：使用白名单验证列名和表名

4. **XSS（跨站脚本攻击）防护**
   - 存储型 XSS：对所有用户输入进行编码，输出时再次编码
   - 反射型 XSS：验证和清理 URL 参数
   - DOM 型 XSS：避免使用 innerHTML，使用内容安全策略（CSP）

5. **CSRF（跨站请求伪造）防护**
   - 基本原则：使用 CSRF Token，验证 Token 有效性
   - CSRF Token 实现：生成、验证、过期机制

6. **敏感数据处理**
   - 敏感信息识别：密码、PII、财务信息、健康信息等
   - 敏感信息存储：加密存储，使用强加密算法（AES-256）
   - 敏感信息传输：使用 HTTPS，不在 URL 中传递敏感信息
   - 敏感信息日志：不在日志中记录敏感信息，记录前进行脱敏

7. **文件上传安全**
   - 文件上传验证：验证文件类型（MIME 类型）、文件大小、文件内容
   - 安全存储：重命名上传文件，存储在 Web 根目录之外

8. **API 安全**
   - API 认证：OAuth 2.0、JWT、API Key
   - API 限流：基于 IP 和用户的限流，使用令牌桶或漏桶算法
   - API 版本控制：通过 URL 路径或请求头指定版本

9. **配置管理**
   - 敏感配置：使用环境变量，不要硬编码，使用密钥管理服务
   - 默认配置：使用安全的默认配置，最小权限默认

10. **依赖管理**
    - 依赖安全：定期更新依赖，使用依赖扫描工具
    - 依赖最小化：只安装必要的依赖，避免使用未维护的包

11. **日志和监控**
    - 安全日志：记录安全相关事件，不记录敏感信息
    - 安全监控：监控异常行为，设置告警，定期审计

12. **错误处理**
    - 错误消息安全：不泄露系统信息，记录详细错误但不返回给用户

13. **HTTPS 和传输安全**
    - HTTPS 配置：强制使用 HTTPS，使用强 TLS 配置（最低 TLS 1.2）
    - HTTP 安全头：Strict-Transport-Security、X-Content-Type-Options、X-Frame-Options、Content-Security-Policy、X-XSS-Protection

14. **安全测试**
    - 安全测试类型：静态代码分析、依赖扫描、渗透测试、安全代码审查
    - 安全测试工具：gosec、npm audit、OWASP ZAP 等

15. **安全事件响应**
    - 事件响应流程：检测、评估、响应、恢复、总结
    - 事件响应准备：建立响应团队、制定响应流程、准备响应工具、定期演练

#### 3. 代码示例

规则文件包含大量代码示例，主要使用 Go 语言，也包含 JavaScript 示例：
- 输入验证示例（白名单验证、数值验证、文件上传验证）
- 密码哈希示例（bcrypt）
- 会话管理示例（安全会话 ID 生成、安全 Cookie 设置）
- 权限检查示例（RBAC、资源级权限）
- SQL 注入防护示例（参数化查询、动态查询构建）
- XSS 防护示例（HTML 转义、URL 编码）
- CSRF 防护示例（Token 生成和验证）
- 敏感数据加密示例（AES-256）
- API 认证示例（JWT）
- API 限流示例（令牌桶算法）
- 配置管理示例（环境变量读取）
- 安全响应头示例

### 最终规则

**重要规则：安全是应用开发的核心要求，所有开发人员必须严格遵循本规范。始终验证和清理用户输入，使用参数化查询防止 SQL 注入，实施身份认证和授权，加密敏感数据，使用 HTTPS，设置安全响应头，定期更新依赖，记录安全事件，进行安全测试，建立安全事件响应机制。**

### 创建的文件

- `.cursor/rules/security.mdc` - 应用安全开发规范规则文件（约 1200 行）

### 相关文件

- 规则文件位置：`.cursor/rules/security.mdc`
- 规则文件会在编辑相关代码文件时自动应用（`alwaysApply: true`），确保代码符合安全开发规范
- 匹配的文件模式：`**/*.go`、`**/*.js`、`**/*.ts`、`**/*.php`、`**/*.py`、`**/*.java`、`**/config/**`、`**/.env*`、`**/routes/**`、`**/middleware/**`

## 2026-01-02 13:31:36 CST - PostgreSQL 数据库设计规范规则文件创建

### 任务描述

创建 PostgreSQL 数据库设计规范规则文档，要求：
- 创建在 `.cursor/rules` 目录下
- 以 Cursor 规则文件方式创建
- 文件格式为 `.mdc`
- 需要合理配置 `globs`、`description`、`alwaysApply` 元数据
- 符合当前通用的 PostgreSQL 设计规范
- 合理设计数据库性能
- 注意元数据的合理配置

### 执行过程

#### 1. 初始错误理解

最初将任务理解为创建普通文档文件，创建了 `docs/Standards/Database.md` 文档文件。用户指出需要的是 Cursor 规则文件，而非普通文档。

#### 2. 修正并创建规则文件

删除了错误创建的文档文件，在 `.cursor/rules` 目录下创建了正确的规则文件 `.cursor/rules/database.mdc`，包含以下元数据配置：

```yaml
---
globs: ["**/*.sql", "**/migrations/**", "**/schema/**", "**/database/**"]
description: "PostgreSQL 数据库设计规范规则 - 遵循 PostgreSQL 通用设计规范，合理设计数据库性能，注意元数据的合理配置"
alwaysApply: true
---
```

#### 3. 规则内容

规则文件包含以下完整的 PostgreSQL 数据库设计规范：

1. **命名规范**
   - 数据库命名：小写字母、数字和下划线，具有描述性
   - 表命名：复数形式，清晰表达用途
   - 字段命名：小写字母和下划线，布尔字段使用 `is_`、`has_` 前缀，时间戳使用 `_at` 后缀
   - 索引命名：`idx_表名_字段名`、`uk_表名_字段名`（唯一索引）
   - 约束命名：`pk_表名`、`fk_表名_关联表名`、`ck_表名_字段名`
   - 序列命名：`seq_表名_字段名`
   - 函数命名：小写字母和下划线，动词开头

2. **表结构设计**
   - 字段类型选择：数值类型（SMALLINT、INTEGER、BIGINT、NUMERIC）、字符串类型（VARCHAR、TEXT）、日期时间类型（TIMESTAMP、TIMESTAMPTZ）、布尔类型、JSON 类型（推荐 JSONB）、数组类型、UUID 类型
   - 主键设计：自增主键（BIGSERIAL）、UUID 主键、统一使用 `id` 作为主键字段名
   - 外键设计：命名格式 `关联表名_id`，必须定义外键约束，外键字段必须创建索引
   - 默认值设计：时间戳字段使用 `DEFAULT CURRENT_TIMESTAMP`，布尔字段设置合理默认值
   - 约束设计：非空约束、唯一约束、检查约束、默认值约束
   - 表注释：每个表必须添加注释

3. **索引设计**
   - 主键索引：自动创建，无需手动创建
   - 唯一索引：确保字段值唯一性
   - 普通索引：为查询条件、JOIN、ORDER BY、GROUP BY 字段创建索引
   - 复合索引：多字段组合查询，遵循最左前缀原则
   - 部分索引：只为满足特定条件的行创建索引
   - 表达式索引：为表达式或函数结果创建索引
   - 索引维护：定期分析使用情况，监控索引大小，重建索引

4. **性能优化**
   - 分区表设计：范围分区、列表分区、哈希分区
   - 表空间设计：数据表空间、索引表空间、临时表空间
   - 连接池配置：使用 PgBouncer 或应用层连接池
   - 查询优化：避免全表扫描、使用合适的 JOIN 类型、避免 SELECT *、使用 LIMIT、批量操作
   - 统计信息更新：自动更新和手动更新

5. **元数据配置**
   - 表注释：说明表的用途和业务含义
   - 字段注释：说明字段用途、取值范围、业务规则
   - 索引注释：说明索引用途和查询场景
   - 约束注释：说明约束的业务规则
   - 视图注释：说明视图用途和查询逻辑
   - 函数注释：说明函数用途、参数、返回值

6. **数据类型规范**
   - 数值类型：根据范围选择合适的整数类型，金额使用 NUMERIC
   - 字符串类型：有长度限制使用 VARCHAR，不确定长度使用 TEXT
   - 日期时间类型：需要时区使用 TIMESTAMPTZ
   - 布尔类型：使用 BOOLEAN，不要使用 INTEGER 或 CHAR(1)
   - JSON 类型：推荐使用 JSONB，支持索引和高效查询
   - 数组类型：适用于存储多个值，注意查询性能
   - UUID 类型：适用于分布式系统主键

7. **安全规范**
   - 权限管理：最小权限原则，使用角色管理权限
   - 敏感数据加密：密码使用哈希算法，敏感信息考虑加密存储
   - SQL 注入防护：使用参数化查询，输入验证，最小权限

8. **迁移管理**
   - 迁移文件命名：`YYYYMMDDHHMMSS_description.sql` 格式
   - 迁移脚本编写：可逆性、事务性、幂等性
   - 回滚策略：备份策略、测试策略、分阶段迁移、监控和日志

### 最终规则

**重要规则：遵循 PostgreSQL 通用设计规范，合理设计数据库性能，注意元数据的合理配置。所有数据库设计必须符合命名规范、表结构设计、索引设计、性能优化、元数据配置、数据类型规范、安全规范和迁移管理要求。**

### 创建的文件

- `.cursor/rules/database.mdc` - PostgreSQL 数据库设计规范规则文件（956 行）

### 相关文件

- 规则文件位置：`.cursor/rules/database.mdc`
- 规则文件会在编辑 SQL 文件或数据库相关文件时自动应用（`alwaysApply: true`），确保数据库设计符合规范
- 匹配的文件模式：`**/*.sql`、`**/migrations/**`、`**/schema/**`、`**/database/**`

## 2026-01-02 12:54:09 CST - 通用文件编写规则文件创建

### 任务描述

创建通用文件编写规则文档，要求：
- 创建在 `.cursor/rules` 目录下
- 以 Cursor 规则文件方式创建
- 文件格式为 `.mdc`
- 需要合理配置 `globs`、`description`、`alwaysApply` 元数据
- 严格禁止批量操作，所有文件编写和修改必须手动进行
- 禁止批量创建占位符形式的内容

### 执行过程

#### 1. 创建规则文件结构

创建了 `.cursor/rules/file-writing.mdc` 文件，包含以下元数据配置：

```yaml
---
globs: ["**/*"]
description: "通用文件编写规则 - 严格禁止批量操作，所有文件编写和修改必须手动逐条进行，确保操作精确性和可控性"
alwaysApply: true
---
```

#### 2. 规则内容

规则文件包含以下完整的通用文件编写规范：

1. **核心原则**
   - 禁止批量操作：严格禁止使用任何形式的批量操作工具、命令或脚本
   - 手动操作要求：所有文件编写和修改必须使用手动方式进行
   - 禁止占位符和批量创建：不允许批量创建占位符形式的内容，必须按照顺序逐条编写

2. **操作流程**
   - 文件创建流程：确定路径、手动创建、逐条编写、验证内容
   - 文件修改流程：确定范围、逐个修改、逐条修改、验证结果

3. **特殊情况处理**
   - 大量文件需要创建：不允许批量创建，按优先级顺序逐个创建，可分阶段完成
   - 文件内容很多：不允许使用占位符，逐条编写，可按功能模块分块但每块必须完整

4. **违规处理**
   - 立即停止批量操作
   - 重新进行手动操作
   - 验证所有文件内容

5. **规则的重要性**
   - 可控性：确保每一步都是可控的
   - 精确性：确保内容的精确性
   - 可追溯性：清楚追溯每个文件的创建和修改过程
   - 质量保证：确保每个文件都经过仔细检查

#### 3. 核心要求总结

规则文件明确强调以下核心要求：

1. ✅ **禁止批量操作** - 不允许使用任何形式的批量操作工具、命令或脚本
2. ✅ **必须手动操作** - 所有文件编写和修改必须手动进行
3. ✅ **禁止占位符** - 不允许批量创建占位符形式的内容
4. ✅ **逐条编写** - 必须按照顺序一条条内容编写和修改

### 最终规则

**重要规则：所有文件编写和修改操作必须严格遵循手动操作原则，禁止任何形式的批量操作，禁止使用占位符，必须按照顺序逐条编写和修改内容。**

### 创建的文件

- `.cursor/rules/file-writing.mdc` - 通用文件编写规则文件（181 行）

### 相关文件

- 规则文件位置：`.cursor/rules/file-writing.mdc`
- 规则文件会在编辑任何文件时自动应用（`alwaysApply: true`），确保所有文件操作都遵循严格的手动操作要求

## 2026-01-02 12:48:56 CST - Golang 编码规范规则文件创建

### 任务描述

创建符合 Golang 当前通用的编码规范规则文档，要求：
- 创建在 `.cursor/rules` 目录下
- 以 Cursor 规则文件方式创建
- 文件格式为 `.mdc`
- 需要合理配置 `globs`、`description`、`alwaysApply` 元数据

### 执行过程

#### 1. 创建规则文件结构

创建了 `.cursor/rules/golang.mdc` 文件，包含以下元数据配置：

```yaml
---
globs: ["**/*.go"]
description: "Golang 编码规范规则 - 遵循 Go 官方编码规范和最佳实践，确保代码风格一致性和可维护性"
alwaysApply: true
---
```

#### 2. 规范内容

规则文件包含以下完整的 Golang 编码规范：

1. **代码格式化** - gofmt 使用规范
2. **命名规范** - 包、变量、函数、常量、类型命名
3. **注释规范** - 包注释、函数注释、类型注释、行内注释
4. **导入规范** - 导入顺序和别名使用
5. **错误处理** - 错误检查和包装
6. **代码组织** - 文件结构和函数长度
7. **并发安全** - 互斥锁和 Channel 使用
8. **性能优化** - 字符串操作、切片和映射优化
9. **测试规范** - 测试文件组织和表驱动测试
10. **结构体和接口** - 结构体标签和接口设计
11. **其他规范** - 常量、变量初始化、空值检查等

#### 3. 中文注释要求

根据用户要求，将所有代码示例中的注释改为中文：

- **包注释**：`Package http provides...` → `Package http 提供 HTTP 客户端和服务器的实现。`
- **函数注释**：`GetUser retrieves...` → `GetUser 根据 ID 从数据库中获取用户。`
- **类型注释**：`User represents...` → `User 表示系统中的用户。`
- **错误消息**：所有错误消息改为中文
- **测试用例**：测试用例名称和示例数据改为中文

#### 4. 明确中文使用要求

在规则文件的多个关键位置添加了明确的中文使用要求：

1. **文档开头**：添加总体说明，强调所有注释、错误消息、日志输出、用户提示、测试用例描述等必须使用中文
2. **注释规范部分**：在注释规范开头添加说明
3. **行内注释**：明确要求所有行内注释必须使用中文
4. **错误处理部分**：在错误检查、错误包装、自定义错误三个小节中分别强调错误消息必须使用中文
5. **测试规范部分**：强调测试用例描述和测试错误消息必须使用中文
6. **总结部分**：将"使用中文"作为第一条要求，并在最后添加特别强调说明

### 最终规则

**重要规则：代码标识符（函数名、变量名、类型名、包名等）使用英文，但所有面向用户的文本内容（注释、错误消息、日志输出、用户提示、测试描述等）必须使用中文。**

### 创建的文件

- `.cursor/rules/golang.mdc` - Golang 编码规范规则文件（411 行）

### 相关文件

- 规则文件位置：`.cursor/rules/golang.mdc`
- 规则文件会在编辑 `.go` 文件时自动应用，帮助保持代码风格一致性

